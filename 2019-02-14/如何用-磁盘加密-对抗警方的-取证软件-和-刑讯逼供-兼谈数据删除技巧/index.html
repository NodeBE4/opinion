<!DOCTYPE html>
<html>
  <head>
  <title>如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧 – 觀點 – 從草根到大師 git.io/JJCxS</title>

      <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="

      如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧  
  
    
      
    
  
  
春节假期结束啦，继续来谈信息安全的话题。  先顺便说俩事儿：  1. 虽然本文与上一篇博文的间隔超过两周，但俺上一次【网络活动】是2月7日（在回复读者评论）。所以，依然属于【正常静默】。不要担心俺 :)  2. 上一篇博文发出后，经几位热心读者提醒，俺又对“社会工程学”那个章节补充了几点内容。        ★引子 
  前不久正值【开博十周年】之际，俺写了一篇《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》。  今天这篇是对前一篇进行补充，主要谈—— 
   如何对付警方
   ？看到俺写这样的东西，公安系统的“网监部门”和“技侦部门”，肯定又不爽了 :)  
       
        ★本文讨论的范围 
  为了避免某些读者来抬杠，先声明一下本文讨论范围。        ◇面向【高风险政治人士】 
  和  前一篇博文  类似，这篇也是写给“高风险政治人士”（类似俺这种反党人士）的教程。  如果你有可能成为【警方】的重点关注目标，大概就可以算是“高风险”啦。  （注：此处的“警方”包括天朝的“公安部、国安部”或类似机构；也包括其它国家的类似机构）   当然啦，所有的技术都是【双刃剑】——都可能被滥用。某些在网络上干坏事的家伙，也会从本文中受益。关于这点，俺也很无奈 :(  但是，俺不会因为技术存在被滥用的可能性，就停止对技术的传播和普及。        ◇本文只讨论【个人电脑】，【不】讨论手机或平板 
  俺已经多次谈过【移动设备的危险性】。显然，“高危人士”就【不该】在手机上进行任何危险操作。  因此，本文不打算谈“手机的话题”，只讨论【个人电脑】（桌面 PC）。  （注：本文中所说的“PC”，既包括“台式机”，也包括“笔记本电脑”）        ◇本文主要介绍【通用】的方法论 
  为了叙述方便，在涉及“操作系统”时，俺会拿 Linux 来说事儿。用 Windows 或 Mac OS 的同学，请依样画葫芦。  为了叙述方便，在谈到“磁盘加密软件”时，俺会以 TC（TrueCrypt）/VC（VeraCrypt）来举例。但本文介绍的方法，也能适用于其它磁盘加密工具（前提是——要支持【key files】这种机制）。         ★本文的特色 
  网上已经有很多关于【磁盘加密】的教程。包括俺自己，也已经写了好多这类教程。  为了避免读者说俺炒冷饭，先说说本文的【特色】。        ◇本文会更多地讨论【物理安全】 
  关于其它层面的防御，在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中已经谈了很多。所以，本文会更多地讨论：PC 的【物理安全】。  与“网上的骇客”不同，警方不光能【物理接触】你的 PC，甚至可以没收你的 PC（拿回去做“数据取证分析”）。因此，当你面对警方的时候，【物理安全】很重要！  （由于主要讨论“物理安全”）在本文中，如果没有特别注明，关于【操作系统】的讨论，针对的是【物理系统】（Host OS）。        ◇本文会更多地讨论【紧急情况】的应对 
  警方不光可以把你的电子设备（电脑、手机）拿去做“数据取证分析”，还可以限制你的行动自由（拘捕/逮捕）。  所以本文会花一些篇幅讨论——如何应对【紧急情况】。也就是说，当你即将丧失行动自由【之前】，该做哪些操作，对你最有利。  请注意：在你被捕之前， 
   你对敏感数据销毁越彻底，警方就越拿你没办法（因此也就对你越有利）。
           ★警方如何【破解】加密盘？ 
  《孙子兵法》说【知己知彼 百战不殆】。你要防范对方，首先要知道对方有哪些招数。  关于“攻击者如何破解加密盘”这个话题，俺在5年前（2013）已经写了一篇：《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》。  虽然那篇是针对 TrueCrypt 加密盘，但其中提到的几种破解手段，对其它格式的加密盘（VeraCrypt，LUKS，BitLocker ......）也适用。  考虑到某些新读者没有看到那篇旧博文，俺把那篇中提到的几种破解手段再【简述】如下。        ◇利用“加密算法本身的漏洞”——基本上【不可能】 
  【成熟的】磁盘加密软件，使用的“对称加密算法”肯定也是【成熟】滴。  以 TC（TrueCrypt）/VC（VeraCrypt）为例，它支持的“对称加密算法”是“Rijndael（AES）、Twofish、Serpent”。  当年美国国家标准局（NIST）公开招标21世纪的新一代加密算法标准（叫“高级加密标准”，简称“AES”）；经过多次淘汰，有5个算法成为【最后一批】候选者，上述的3个算法也在这5个当中；最终是 Rijndael 正式被选中成为 AES（所以，现在所说的 AES 也就是指 Rijndael）。  由于这三个算法是历经淘汰的最后一批候选者，算法本身已经被世界各国的密码学专家仔细检查过啦，【几乎不可能】出现算法层面的漏洞。  引申阅读：在如下博文中介绍了磁盘加密常用的几种“对称加密算法”。  《  TrueCrypt 使用经验[1]：关于加密算法和加密盘的类型  》        ◇对密钥的穷举——基本上【不可能】 
  刚才说啦——成熟的磁盘加密软件，使用的加密算法肯定也是【成熟】滴。  既然如此，算法使用的密钥，其“密钥空间”肯定足够大。因此在足够长时间内（几代人），并考虑到摩尔定律带来的算力增长，都【不可能】对密钥进行穷举。  以 AES256 为例，其密钥有【256 比特】，所有可能的密钥数量是【2的256次方】。这个数有多大捏？      2^256 = 115792089237316195423570985008687907853269984665640564039457584007913129639936    
       ◇对【弱】密码/口令的【暴力猜解】——常见招数 
  这是最常见的手段，专门针对【弱密码】（weak password）。  由于本文要对付的是【警方】。他们比一般的骇客具备更多的资源。比方说，天朝的警方已经建立了专门用于“暴力猜解密码”的【服务器集群】，可以大大提升密码猜解的效率。普通骇客用“单机”无法暴力猜解的密码，有可能被警方搞定。   但是， 
   这招很好对付
   ——你只需要引入【key files】作为加密盘的“认证因素”，就可以让警方的暴力猜解变得【不可能】。  在《  TrueCrypt 使用经验[2]：关于加密盘的密码认证和 KeyFiles 认证  》一文中，俺已经谈过“key files”的“用途”和“注意事项”。关于“注意事项”，再说一次：  1. key files 要使用“二进制文件”，【不要】用“文本文件”  2. key files 最好是【随机生成】（TC 和 VC 自带了“随机生成 key file”的功能）  3. key files 的文件尺寸【至少64字节】  外行的读者可能会觉得“64字节”太小了。其实“64字节”的随机文件，已经足够对抗穷举。一个字节有8比特，64字节有512比特。因此，64字节的随机内容，其可能的数量是“2的512次方”——这已经大大超过刚才提到的“AES 256 密钥空间”了。  给大伙儿秀一下这个数有多大。      2^512 = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096    
  另外，像 TC/VC 这两款磁盘加密软件，最多只提取【每个】key file 开头的一兆字节（1MB）参与密钥生成。所以，随机生成的 key file，每个都【不必】超过 1MB。        ◇【窃取】加密盘的【密钥】——常见招数，本文的重点 
  前面提到的几种攻击手法，都比较好解决（容易防御）。比较难对付的是这招——“攻击者盗取密钥”。所以，对这招的防范是本文的重点内容之一。  下面，俺分多个章节，对这个话题进行展开。        ◇用【审讯】的方式获得“密码和 key files”——常见招数，本文重点 
  前面的“攻击手法”都属于【技术手段】。如果警方尝试了技术手段而不可得，那自然会采用【审讯】的方式。  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文，俺已经谈到了【如何对付审讯】（包括酷刑）。  原理很简单——如果你的加密盘采用了【随机生成】的 key files 作为“认证因子”。你只需要在“丧失行动自由（被捕）”之前【彻底销毁】key files；如此一来，连你自己都【不可能】打开加密盘。酷刑也就失去意义啦。  原理说起来蛮简单，但落实起来会涉及到很多细节。比如说：如何【既彻底又快速】地销毁 key files？下面单列一个章节来谈。         ★为啥加密盘的【密钥】如此关键？ 
       ◇【密钥】是啥玩意儿？ 
  （考虑到大部分读者基本不懂密码学，俺尽可能通俗地解释一下【密钥】是啥玩意儿）  密钥说白了就是一段数据，可以用来加密或者解密。磁盘加密软件用的算法都是“对称加密算法”。这种算法的特点是：“加密的密钥”和“解密的密钥”是【同一个】。假设你用“密钥 K”把一段“明文 P”变成“密文 C”，那么你同样可以用 K 把 C 变为 P。  除了“对称加密算法”，还有一类算法叫做“非对称加密算法”——“加密的密钥”和“解密的密钥”是【不同】滴。这类算法与本文无关，就不展开介绍啦。        ◇“密钥”（key）与“密码/口令”（password）有啥【区别】？ 
  很多不懂技术的网友经常混淆“密钥”和“密码”，其实这两者是【完全不同】滴：  1. 密钥（key）直接参与加密/解密运算滴。  2. 密码（password）【不】参与“加密/解密”运算，它的作用是保护“密钥”。        ◇为啥说密钥【很重要】？ 
  首先，  如果攻击者能通过某种方式【窃取】密钥（key），就可以直接用密钥（key）【解密】加密盘存储的数据。  也就是说——在【不知道】你的密码和 key files 的情况下，也能打开加密盘。  其次，  一旦创建了加密盘，其密钥就固定了。即使你修改了加密盘的“认证因子”（“密码”或“key files”），密钥依然【不变】。  
   一旦攻击者拿到某个加密盘的密钥，不论你如何修改密码，攻击者依然可以打开这个加密盘。
    综上所述，  
   “密钥”的重要性【超过】“密码”和“key files”
   。        ◇密钥如何【生成和存储】？ 
  （本小节谈【技术原理】。比较懒的同学，可以跳过这个小节。不影响后续阅读）  
   密钥的生成
    简单地说，是通过某种复杂的数学运算产生出来（密码学术语叫“密钥生成函数”）。在“密钥生成函数”的生成过程中会用到【哈希运算】和【多次迭代】。（注：“哈希运算”也叫“散列运算”，洋文叫“hash”，  这篇博文  有 hash 的扫盲）  如果你用图形界面的 TC 或 VC 创建一个新的加密盘，在创建过程中，软件会提示你：尽可能快速并随机地移动鼠标。这么干是通过你随机移动鼠标，让软件能收集到足够多的随机数据（足够的【熵值】）  为啥要搞如此复杂的数学方式来创造密钥捏？（通俗地说）要达到——为了让密钥尽可能随机，使得攻击者无法猜测密钥，也无法缩小密钥的分布范围。   
   密钥的存储
    加密盘的密钥，会以【加密】的形式存储在加密盘的“头部或尾部”。而你设置的“密码”或“key files”，就是用来加密密钥的。  所以，当你要打开加密盘时，如果输错了“密码”或“key files”，加密盘的密钥解不出来，自然就打不开。         ★如何防止攻击者【窃取】密钥？ 
       ◇确保物理系统（Host OS）的【纯洁】 
  关于这点，无需多言。  如果你的物理系统本身已经中招（感染了恶意软件），那么，其它所有的防范措施皆是空中楼阁。  关于这个话题，可以参见之前的系列教程：  《  如何防止黑客入侵  》        ◇在电脑的 BIOS 设置“开机密码”和“硬盘锁密码” 
  这2点也是老调重弹了——俺刚在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》中已经提到过。  设置这两个密码，是为了防止攻击者（警方人员）在物理接触你的电脑之后，在（主引导扇区的）boot loader 中植入恶意软件，从而盗取你全盘加密的“密码或密钥”。  （注：在【不】依赖外部启动介质的情况下，主引导扇区是【不可能】加密滴。因为至少要有一个【明文】的程序，让你输入“全盘加密的”解锁密码，并执行解锁的动作）  从技术上讲，你也可以把 boot loader 放到某个外置的【可启动 U 盘】中，每次开机都先插入该 U 盘。但这么干太麻烦，而且会引来额外的风险。因为 U 盘没法像笔记本那样设置【硬盘锁】。警方的技侦人员如果能偷偷拿到你的这个启动 U 盘，同样可以植入恶意软件。        ◇【禁用】“虚拟内存” 
  现代操作系统都有“虚拟内存”的机制。对 Windows 而言，叫做“页交换文件”，对 Linux 而言就是“swap 分区”。  “虚拟内存”的作用在于——当物理内存比较紧张的时候，把一些不经常访问的“内存页”转储到硬盘，就可以腾出物理内存来存放新的内容。  一旦启用了“虚拟内存”，也就存在某种可能性——【敏感加密盘的密钥】有可能会残留在“虚拟内存”（也就是硬盘上）——显然，这增加了你的风险。   有些同学可能会问：既然已经“全盘加密”，不论是“swap 分区”还是“页交换文件”，都被加密了。为啥还要担心这个风险？  下面，俺来回答一下——   前一篇博文  之所以建议：在“全盘加密”的基础上再搞“敏感加密盘”，就是因为这两个东西的【密级不同】——“敏感加密盘”的密级【更高】。  如果你在物理系统（Host OS）中启用了“虚拟内存”，你就把“敏感加密盘”的安全等级【降低到】与“全盘加密”一样的水平。换句话说，一旦攻击者能够突破全盘加密，也就【有可能】从“虚拟内存”中找到“敏感加密盘的密钥”，从而突破“敏感加密盘”。        ◇谈谈“关机、休眠、待机”三者的安全差异 
  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中，俺提到：      
当你要【长时间】离开自己的电脑——应该【关机】（shutdown）；而【不要】“休眠”（hibernation）或“待机”（suspend，stand by）    
 现在来解释一下：   
   休眠（hibernation）
    所谓的“休眠”（hibernation），说白了就是把【整个物理内存】保存到硬盘中的“休眠文件”。 
   这非常危险！
   危险的原因参见“虚拟内存”那个小节的讨论。另外，如果你在【未卸载】“敏感加密盘”的情况下让系统休眠，那么“休眠文件”中【必定包含】“敏感加密盘”的【密钥】。   
   待机（suspend，stand by）
    如果你已经禁用了“虚拟内存”和“休眠功能”，仅仅是让系统“待机”，这种情况下，加密盘的密钥【不会】出现在硬盘上，但还是有风险——如果你在待机之前【没有】卸载加密盘，加密盘的密钥还在物理内存（RAM）中。  如今的 DRAM 内存条在断电后依然有【数据残留】。在你离开电脑的这段时间里，如果警方的技侦人员对（正在待机的）电脑进行【冷启动攻击】（洋文叫“cold boot attack”，维基百科的链接在“  这里  ”），可以直接拿到【内存条】中的数据，再从中分析出“加密盘密钥”。  （注：断电之后，内存条中的数据【不会】立即消失，会有一个残留时间。温度越低，残留时间越长。在正常的室温下，内存条的数据残留时间【不超过】10分钟）   引申阅读：  在2013年的旧博文，俺已经介绍了【冷启动攻击】的原理和手法。  《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》  “冷启动攻击”这个手法已经有10年以上的历史。很多笔记本厂商在硬件和 BIOS 方面做了一些防范措施。可惜的是：前几个月（2018年9月），国外安全研究人员曝光了“冷启动攻击”的新进展——可以突破所有主流 PC 厂商（与“待机”相关）的防御。  《  研究人员警告现代计算机都易受冷启动攻击 @ Solidot  》  《  New modification of the old cold boot attack leaves most systems vulnerable @ Ars Technica  》   
   关机（shutdown）
    既然“休眠”和“待机”都靠不住，你只剩下一个选择——【关机】。  前面提到——正常的室温下，内存条的数据残留时间【不超过】10分钟。也就是说，只要关机超过10分钟，就【不可能】进行“冷启动攻击”了——因为内存条中的数据全都消失了。   
   补充：锁定屏幕
    如果你仅仅是“锁定屏幕”，其风险情况与“待机”类似——你的 PC 会被【冷启动攻击】搞定。   
   补充：混合睡眠模式
    经热心读者提醒：Windows8 开始引入了【混合睡眠模式】。即使在“待机”状态下也会保存一部分内存到硬盘上。  因此，你应该彻底禁止“休眠功能”（具体参见微软官网的“  这个链接  ”）。        ◇禁用 FireWire DMA 
  “FireWire”是某种硬件接口规格（俗称“火线接口”，也叫“IEEE 1394 接口”）。这玩意儿支持 DMA（direct memory access）方式直接操作【物理内存】。所以攻击者如果能物理接触你的电脑，可以在你的电脑上插入某个特定 FireWire 设备，然后利用 DMA 的方式直接读取整个系统的内存。因此，这招也叫做“  DMA attack  ”  这种攻击方式不仅仅是理论上可行，前几年就已经有人搞了傻瓜化的“DMA 攻击工具”。  如果 BIOS 有 FireWire DMA 相关选项，应该禁掉；或者在操作系统层面禁用相关的功能（通过“重编译 Linux 内核”）。  由于这个方式也是针对【运行状态下】盗取内存。所以，【关机】可以对付这种攻击方式。         ★“机械硬盘”与“固态硬盘（闪存）”【删除数据】的差异——损耗均衡技术 
       ◇“损耗均衡技术”是啥玩意儿？ 
  为了介绍后面的章节，需要先扫盲一个小知识——损耗均衡技术（洋文叫“wear leveling”）。  考虑到本文的大部分读者不是 IT 硬件方面的专业人士，俺尽量通俗地扫盲一下。  所谓的“固态硬盘”（SSD），是以【闪存】作为永久性存储介质。平时咱们用的“U盘”也是以【闪存】作为介质。（为了打字省力，本文以下章节凡是提到“闪存介质”，就是指——“采用闪存作为存储介质”的各种东西的【总称】）  “闪存介质”相比“机械硬盘”的一大【缺点】是——写入次数的上限比较低。如果某个存储单元的数据反复更改（反复写入），达到上限后，这个存储单元就坏掉（变为“不可用”）。  “闪存介质”的厂商为了解决这个问题，采用了“损耗均衡技术”（详细介绍请看维基百科的“  这个链接  ”）。比如某个文件，原先存储在“a单元”，当你更改了文件内容并保存，新的内容就不在“a单元”了，而是把新内容存到一个用得最少的“b单元”。此时，“a单元”里面依然有该文件的【旧内容】。  请注意，这个技术是由【硬件层面】（闪存介质的控制器）实现的，对操作系统【不可见】。        ◇“损耗均衡技术”【不利于】彻底删除数据 
  聪明的读者，看完前一个小节，已经发现问题所在了。  很多时候，为了彻底删除文件，要用“垃圾数据（随机数据）”去覆盖文件的原有内容，从而让原有内容【不可恢复】。这个招数对“机械硬盘”是 OK 的，但对“闪存介质”就不灵了。因为“损耗均衡技术”使得你覆盖的内容存到的【别的】单元，根本【没达到】你想要的目的。  而且俺刚才也说了——“损耗均衡技术”是由硬件层面的存储控制器实现，对操作系统不可见。所以，用【软件方式】难以证明某个存储单元是否【真正被覆盖了】。        ◇对【闪存介质】，如何彻底删除文件？ 
  综上所述，要想在“闪存介质”中彻底删除文件，你需要换一种思路，大致如下：  1. 先简单删除该文件  2. 用垃圾数据（随机数据）填满该存储介质的剩余空间——要 100% 填满。  （这样才能确保——原先保存过敏感数据的单元，已经被垃圾数据覆盖掉）   注意事项：要填满的是【物理硬盘】的“剩余空间”，而不是【分区】的“剩余空间”。  举个例子：  假设你的固态硬盘有多个分区。敏感文件在“分区1”，你把敏感文件删除后，光填满“分区1”的剩余空间是【不够】滴。  正确做法是——你要把【所有】分区的剩余空间都填满，才能确保之前保存过敏感数据的单元，确实被垃圾数据覆盖掉了。        ◇闪存厂商提供的工具，是否可信/可靠？ 
  某些闪存介质的厂商会提供一些配套的工具/软件，据说可以提供【彻底删除】的功能。  对此，俺表示谨慎的怀疑。因为无法验证其效果。  所以，为了保险起见，还是老老实实去【填满剩余空间】吧。        ◇小结 
  正式因为“闪存介质”要彻底删除文件，如此之麻烦。所以那些看重隐私保护的同学，更加应该早早用上【全盘加密】。  一旦你在“闪存介质”上使用【全盘加密】，每一个物理存储单元中的数据都是【密文】——“损耗均衡技术”就不再是障碍啦。         ★如何【快速且彻底】销毁加密盘的数据？ 
       ◇为啥要强调“快速且彻底”？ 
  为啥俺强调【彻底】？——只有彻底地销毁数据，才能对付警方的【取证软件】；  为啥俺强调【迅速】？——警方想要拘捕你，当然不会留给你从容的时间。比如说：当警方人员正在撞门的时候，留给你的时间可能连1分钟都不到。        ◇“销毁”的含义 
  本章节所说的“销毁”是指——让任何人【包括你自己】再也无法得到加密盘里面的数据。        ◇为啥“哄骗”不可行？ 
  本文发出后，某些热心读者提到了“哄骗”的招数。简单说就是：你假装销毁，但其实并没有。这样做，将来你自己还能继续打开加密盘。  俺认为：这种方法【不够】可靠， 
   甚至是危险的想法
   。理由如下：  如果你是警方的重点关注对象，或者你是重大案件的关键人物，警方肯定会动用【刑侦和审讯】方面的高手来参与办案。  在这种情况下，你【别想】太容易哄骗对方。除非你自己也受过【严格的】“反侦查和反审讯”方面的训练。  但试问：有几个人具备这个条件？  基于上述理由——只有当你在紧急情况下，无法彻底销毁敏感数据，再考虑“哄骗”的招数。        ◇【错误】方式举例 
  首先来说说【反面】教材。所谓“错误的方式”指的是——【不够彻底】或者【不够快速】的方式。   
   错误方式1
   ——用“普通的删除命令”删除加密盘里面的文件  （所谓的“普通删除命令”，比如：Linux 下的 
   rm
   命令，Windows 下的 
   del
   命令）  首先，这种做法【不】彻底（会被“取证软件”恢复出来）；其次，如果加密盘中的文件很多，这种做法太慢。   
   错误方式2
   ——用“专门的【擦除】命令”彻底删除加密盘里面的文件  （所谓的“专门的擦除命令”，比如 linux 下的 
   shred
   命令）  这种方式比较彻底，但是【慢】。如果文件很多，就非常慢。  （注：shred 支持【多轮反复擦除】，可以防范专业取证人员对机械硬盘的“剩磁分析”，但也导致其速度很慢。即使你把 shred 设置为“只擦除1轮”，速度还是慢）   
   错误方式3
   ——快速格式化  这种方式速度快，但是不彻底——被“快格”的分区，数据全都在。   
   错误方式4
   ——彻底格式化  这种方式算是比较彻底，可惜【太慢】了。如果格式化的分区有好几个 GB，你就慢慢等吧。        ◇【正确】方式——彻底删除 key files 
  关于这招，已经提到过多次了。不但本文提到，之前在多篇博文中也提到。  这种方式有两种实现——“软删除”和“硬删除”。  如果 key files 存储在 PC 的硬盘上，用软件方式（比如：shred 命令）彻底擦除内容。为了讨论方便，以下称之为：“软删除 key files”。  如果 key files 放在【外部】的存储介质（比如：U盘、MMC/SD 卡、...），你可以先把存储卡插到 PC 上，然后用软件干掉 key files（依然是“软删除”）；但你还可以用【物理方式】直接破坏存储介质（这种情况称为——“硬删除 key files”）。  由于 key files 都很小（通常小于 1MB），所以“软删除 key files”肯定是【既快速又彻底】。   提醒：“软删除”的【局限性】  如果是【机械硬盘】，“软删除”是 OK 的；但如果是【固态硬盘】，“软删除”【不】保险。原因请参见本文前面章节介绍的【损耗均衡技术】。  至于“硬删除”的方式  由于存在几种不同情况，后面俺用一个单独的章节来讨论。        ◇【正确】方式——破坏加密盘的【密钥存储区】 
  前面俺聊“密钥的存储”，已经提到——磁盘加密软件为了能打开加密的数据，必须把密钥（以【加密形式】）存储在某个地方。通常是存储在加密盘的【头部或尾部】。  当你输入认证因子（“密码”和“key files”），加密软件根据“认证因子”进行一系列数学运算，然后从密钥存储区中解密出【加密盘的密钥】。如果你的认证因子输错了，密钥就解不出，加密盘自然打不开。  所以，如果你用“随机数据”把加密卷的【头部和尾部】两者都覆盖，就足以【彻底破坏】整个加密盘。  密钥存储区通常很小（不到 1KB）。为了保险起见，咱们把覆盖范围扩大一千倍（从 1KB 变为 1MB），彻底覆盖加密盘最开头的 1MB 和最末尾的 1MB，肯定就能毁掉“密钥存储区”了。  再来看“速度”——哪怕老式的机械硬盘，对头尾各写入 1MB 的数据，也可以在1秒内完成。所以这招属于【既彻底又快速】。   提醒：本招数的【局限性】  如果是【机械硬盘】，可以用这招；但如果是【固态硬盘】，这招【不】保险。原因请参见刚才介绍的“损耗均衡技术”。        ◇【运行状态】下的权衡 
  （所谓的【运行状态】指的是——出现“紧急情况”时，你的 PC 处于【开机运行】，并且你正在操作它）  在这种情况下，显然【可以用】“破坏加密盘”的方式。  至于“删除 key files”是否可用，取决于你的 key files 存储放在哪里？  1. 如果你的 key files 存储在 PC 上，也可用“【软】删除 key files”的方式。  2. 如果你的 key files 位于【外部】存储介质（比如：U盘、MMC/SD 卡、...），并且这个存储介质【没有】插在电脑上，就应该用“【硬】删除 key files”的方式。        ◇【关机状态】下的权衡 
  当你的 PC 处于【关机状态】，一旦碰到紧急情况，你已经来不及开机并启动系统。所以，“破坏加密盘”显然不可行；同样的道理，此时“软删除 key files”也不可行。  因此，在【离线状态】下，你只有唯一的选项——“硬删除 key files”。        ◇结论 
  从上述两种状态的权衡，很自然就可以得出结论—— 
   key files 必须位于你【身边】的存储介质中
   。只有这样才能保证——你在【各种情况】下都能【快速且彻底】地销毁加密数据。  为了让大伙儿一目了然，放一个对照表：       
    
     
      
      
      
       运行状态，机械硬盘
      
      
       运行状态，固态硬盘
      
      
       关机状态
      
     
     
      
       【硬】删除 key files
      
      
       YES
      
      
       YES
      
      
       YES
      
     
     
      
       【软】删除 key files
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
     
      
       破坏加密盘的【密钥存储区】
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
    
    
        ★如何【物理破坏】存储卡？ 
  好，现在来谈“硬删除 key files”的方式——也就是“从物理上毁掉存储卡”。  （注：本章节所说的“存储卡”包括：U盘、SD卡、MMC卡...）  再次唠叨：这种“物理破坏”的方式比较粗鲁，是【紧急情况下】的无奈之举。如果你的时间比较从容，应该用前面提到的软件方式——删除敏感文件后，通过填充垃圾数据，塞满整张存储卡的剩余空间。        ◇U 盘的内部结构 
  为了方便讲解，从维基百科剽窃了一张照片，并附上相应的说明。         
    
1　插头  2　存储控制器  3　测试接点  4　【 
    闪存芯片
    】  5　石英振荡器  6　发光二极管（LED）  7　写入保护开关  8　预留给第二颗存储器芯片的空间    
       ◇物理摧毁的关键——破坏【闪存芯片】 
  对存储卡而言，除了【闪存芯片】，其它的都是浮云。  因为其它所有的部件全被毁掉，只要【闪存芯片】还完好，就可以通过专用的设备，读取出里面保存的数据。        ◇破坏“闪存芯片”——【彻底】的方式 
  关于这个话题，俺看过一些资料，以及网上的讨论。权衡下来，能够在“短时间”（1分钟内）物理破坏“闪存芯片”的方式，大致有两种：   
   电磁方式——微波炉
    把存储卡放入微波炉并启动。  这么干，不但能毁掉存储芯片，可能你的微波炉也会跟着报废。但在紧急情况下，一个微波炉又算得了什么？   
   机械方式——砸烂
    如果你身边有锤子、扳手（或诸如此类的工具），对准结构图当中那个“傻大黑粗”的家伙狠狠砸下去，砸烂为止。  由于“闪存芯片”比较硬，还可以考虑用某个尖锐的东西作为辅助（学过基础物理学的应该明白——这可以增加压强）。就比如说，把一个钉子架在“闪存芯片”上，然后再用锤子敲击钉子，更容易击穿芯片的外壳。  但如今现代化的家庭或办公室中，要想找一个钉子还真不太容易。那么，啥东西可以作为钉子的替代品捏？俺列几个替代品作为参考（欢迎大伙儿补充）      
螺丝刀（尤其是【小型的十字】螺丝刀）  瑞士军刀中某些尖锐的部件（如下图）    
       （某款瑞士军刀的示意图——几乎每种款式的瑞士军刀都带有尖锐的工具） 
       ◇破坏“闪存芯片”——【不太彻底】的方式 
  现在介绍【不】那么彻底的方式。也供高风险人士参考。  在紧急情况下，如果你身边没有微波炉也没有砸烂芯片的工具，还有一招是——用冲水马桶把存储卡冲掉。如今的存储卡都比较小，至少不会卡在马桶里。  但要强调的是——这招【不彻底】，因为存储卡浸泡在普通液体（只要不是强酸），即使长达几天时间，还是有可能恢复出数据。  如果你用了这招，那主动权就转到警方这边——考验他们是否愿意到粪坑里去找存储卡了。         ★预备和演习 
  如果你确实认为自己是【高风险人士】，本文讲述的这些东西，你【不要】光看看而已。要先做好准备工作，甚至来一次演习（彩排）。  否则真的到了紧急情况，你在慌乱之中很可能会出错。（这是本文最后的忠告）    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》  《  文件加密的扫盲介绍  》  《  扫盲文件完整性校验——关于散列值和数字签名  》  《  TrueCrypt 使用经验  》（系列）  《  扫盲 VeraCrypt——跨平台的 TrueCrypt 替代品  》  《  扫盲 dm-crypt——多功能 Linux 磁盘加密工具（兼容 TrueCrypt 和 VeraCrypt）  》  《  扫盲 Linux 逻辑卷管理（LVM）——兼谈 RAID 以及“磁盘加密工具的整合”  》  《  文件备份技巧：组合“虚拟加密盘”与“网盘”  》  《  如何保护隐私  》（系列）  《  如何防止黑客入侵  》（系列）  《  扫盲 Linux＆UNIX 命令行——从“电传打字机”聊到“shell 脚本编程”  》  《  扫盲操作系统虚拟机  》（系列）      
    

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html 
    
    
  
  
    
         
    
    
    
 
    
  

" />
    <meta property="og:description" content="

      如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧  
  
    
      
    
  
  
春节假期结束啦，继续来谈信息安全的话题。  先顺便说俩事儿：  1. 虽然本文与上一篇博文的间隔超过两周，但俺上一次【网络活动】是2月7日（在回复读者评论）。所以，依然属于【正常静默】。不要担心俺 :)  2. 上一篇博文发出后，经几位热心读者提醒，俺又对“社会工程学”那个章节补充了几点内容。        ★引子 
  前不久正值【开博十周年】之际，俺写了一篇《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》。  今天这篇是对前一篇进行补充，主要谈—— 
   如何对付警方
   ？看到俺写这样的东西，公安系统的“网监部门”和“技侦部门”，肯定又不爽了 :)  
       
        ★本文讨论的范围 
  为了避免某些读者来抬杠，先声明一下本文讨论范围。        ◇面向【高风险政治人士】 
  和  前一篇博文  类似，这篇也是写给“高风险政治人士”（类似俺这种反党人士）的教程。  如果你有可能成为【警方】的重点关注目标，大概就可以算是“高风险”啦。  （注：此处的“警方”包括天朝的“公安部、国安部”或类似机构；也包括其它国家的类似机构）   当然啦，所有的技术都是【双刃剑】——都可能被滥用。某些在网络上干坏事的家伙，也会从本文中受益。关于这点，俺也很无奈 :(  但是，俺不会因为技术存在被滥用的可能性，就停止对技术的传播和普及。        ◇本文只讨论【个人电脑】，【不】讨论手机或平板 
  俺已经多次谈过【移动设备的危险性】。显然，“高危人士”就【不该】在手机上进行任何危险操作。  因此，本文不打算谈“手机的话题”，只讨论【个人电脑】（桌面 PC）。  （注：本文中所说的“PC”，既包括“台式机”，也包括“笔记本电脑”）        ◇本文主要介绍【通用】的方法论 
  为了叙述方便，在涉及“操作系统”时，俺会拿 Linux 来说事儿。用 Windows 或 Mac OS 的同学，请依样画葫芦。  为了叙述方便，在谈到“磁盘加密软件”时，俺会以 TC（TrueCrypt）/VC（VeraCrypt）来举例。但本文介绍的方法，也能适用于其它磁盘加密工具（前提是——要支持【key files】这种机制）。         ★本文的特色 
  网上已经有很多关于【磁盘加密】的教程。包括俺自己，也已经写了好多这类教程。  为了避免读者说俺炒冷饭，先说说本文的【特色】。        ◇本文会更多地讨论【物理安全】 
  关于其它层面的防御，在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中已经谈了很多。所以，本文会更多地讨论：PC 的【物理安全】。  与“网上的骇客”不同，警方不光能【物理接触】你的 PC，甚至可以没收你的 PC（拿回去做“数据取证分析”）。因此，当你面对警方的时候，【物理安全】很重要！  （由于主要讨论“物理安全”）在本文中，如果没有特别注明，关于【操作系统】的讨论，针对的是【物理系统】（Host OS）。        ◇本文会更多地讨论【紧急情况】的应对 
  警方不光可以把你的电子设备（电脑、手机）拿去做“数据取证分析”，还可以限制你的行动自由（拘捕/逮捕）。  所以本文会花一些篇幅讨论——如何应对【紧急情况】。也就是说，当你即将丧失行动自由【之前】，该做哪些操作，对你最有利。  请注意：在你被捕之前， 
   你对敏感数据销毁越彻底，警方就越拿你没办法（因此也就对你越有利）。
           ★警方如何【破解】加密盘？ 
  《孙子兵法》说【知己知彼 百战不殆】。你要防范对方，首先要知道对方有哪些招数。  关于“攻击者如何破解加密盘”这个话题，俺在5年前（2013）已经写了一篇：《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》。  虽然那篇是针对 TrueCrypt 加密盘，但其中提到的几种破解手段，对其它格式的加密盘（VeraCrypt，LUKS，BitLocker ......）也适用。  考虑到某些新读者没有看到那篇旧博文，俺把那篇中提到的几种破解手段再【简述】如下。        ◇利用“加密算法本身的漏洞”——基本上【不可能】 
  【成熟的】磁盘加密软件，使用的“对称加密算法”肯定也是【成熟】滴。  以 TC（TrueCrypt）/VC（VeraCrypt）为例，它支持的“对称加密算法”是“Rijndael（AES）、Twofish、Serpent”。  当年美国国家标准局（NIST）公开招标21世纪的新一代加密算法标准（叫“高级加密标准”，简称“AES”）；经过多次淘汰，有5个算法成为【最后一批】候选者，上述的3个算法也在这5个当中；最终是 Rijndael 正式被选中成为 AES（所以，现在所说的 AES 也就是指 Rijndael）。  由于这三个算法是历经淘汰的最后一批候选者，算法本身已经被世界各国的密码学专家仔细检查过啦，【几乎不可能】出现算法层面的漏洞。  引申阅读：在如下博文中介绍了磁盘加密常用的几种“对称加密算法”。  《  TrueCrypt 使用经验[1]：关于加密算法和加密盘的类型  》        ◇对密钥的穷举——基本上【不可能】 
  刚才说啦——成熟的磁盘加密软件，使用的加密算法肯定也是【成熟】滴。  既然如此，算法使用的密钥，其“密钥空间”肯定足够大。因此在足够长时间内（几代人），并考虑到摩尔定律带来的算力增长，都【不可能】对密钥进行穷举。  以 AES256 为例，其密钥有【256 比特】，所有可能的密钥数量是【2的256次方】。这个数有多大捏？      2^256 = 115792089237316195423570985008687907853269984665640564039457584007913129639936    
       ◇对【弱】密码/口令的【暴力猜解】——常见招数 
  这是最常见的手段，专门针对【弱密码】（weak password）。  由于本文要对付的是【警方】。他们比一般的骇客具备更多的资源。比方说，天朝的警方已经建立了专门用于“暴力猜解密码”的【服务器集群】，可以大大提升密码猜解的效率。普通骇客用“单机”无法暴力猜解的密码，有可能被警方搞定。   但是， 
   这招很好对付
   ——你只需要引入【key files】作为加密盘的“认证因素”，就可以让警方的暴力猜解变得【不可能】。  在《  TrueCrypt 使用经验[2]：关于加密盘的密码认证和 KeyFiles 认证  》一文中，俺已经谈过“key files”的“用途”和“注意事项”。关于“注意事项”，再说一次：  1. key files 要使用“二进制文件”，【不要】用“文本文件”  2. key files 最好是【随机生成】（TC 和 VC 自带了“随机生成 key file”的功能）  3. key files 的文件尺寸【至少64字节】  外行的读者可能会觉得“64字节”太小了。其实“64字节”的随机文件，已经足够对抗穷举。一个字节有8比特，64字节有512比特。因此，64字节的随机内容，其可能的数量是“2的512次方”——这已经大大超过刚才提到的“AES 256 密钥空间”了。  给大伙儿秀一下这个数有多大。      2^512 = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096    
  另外，像 TC/VC 这两款磁盘加密软件，最多只提取【每个】key file 开头的一兆字节（1MB）参与密钥生成。所以，随机生成的 key file，每个都【不必】超过 1MB。        ◇【窃取】加密盘的【密钥】——常见招数，本文的重点 
  前面提到的几种攻击手法，都比较好解决（容易防御）。比较难对付的是这招——“攻击者盗取密钥”。所以，对这招的防范是本文的重点内容之一。  下面，俺分多个章节，对这个话题进行展开。        ◇用【审讯】的方式获得“密码和 key files”——常见招数，本文重点 
  前面的“攻击手法”都属于【技术手段】。如果警方尝试了技术手段而不可得，那自然会采用【审讯】的方式。  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文，俺已经谈到了【如何对付审讯】（包括酷刑）。  原理很简单——如果你的加密盘采用了【随机生成】的 key files 作为“认证因子”。你只需要在“丧失行动自由（被捕）”之前【彻底销毁】key files；如此一来，连你自己都【不可能】打开加密盘。酷刑也就失去意义啦。  原理说起来蛮简单，但落实起来会涉及到很多细节。比如说：如何【既彻底又快速】地销毁 key files？下面单列一个章节来谈。         ★为啥加密盘的【密钥】如此关键？ 
       ◇【密钥】是啥玩意儿？ 
  （考虑到大部分读者基本不懂密码学，俺尽可能通俗地解释一下【密钥】是啥玩意儿）  密钥说白了就是一段数据，可以用来加密或者解密。磁盘加密软件用的算法都是“对称加密算法”。这种算法的特点是：“加密的密钥”和“解密的密钥”是【同一个】。假设你用“密钥 K”把一段“明文 P”变成“密文 C”，那么你同样可以用 K 把 C 变为 P。  除了“对称加密算法”，还有一类算法叫做“非对称加密算法”——“加密的密钥”和“解密的密钥”是【不同】滴。这类算法与本文无关，就不展开介绍啦。        ◇“密钥”（key）与“密码/口令”（password）有啥【区别】？ 
  很多不懂技术的网友经常混淆“密钥”和“密码”，其实这两者是【完全不同】滴：  1. 密钥（key）直接参与加密/解密运算滴。  2. 密码（password）【不】参与“加密/解密”运算，它的作用是保护“密钥”。        ◇为啥说密钥【很重要】？ 
  首先，  如果攻击者能通过某种方式【窃取】密钥（key），就可以直接用密钥（key）【解密】加密盘存储的数据。  也就是说——在【不知道】你的密码和 key files 的情况下，也能打开加密盘。  其次，  一旦创建了加密盘，其密钥就固定了。即使你修改了加密盘的“认证因子”（“密码”或“key files”），密钥依然【不变】。  
   一旦攻击者拿到某个加密盘的密钥，不论你如何修改密码，攻击者依然可以打开这个加密盘。
    综上所述，  
   “密钥”的重要性【超过】“密码”和“key files”
   。        ◇密钥如何【生成和存储】？ 
  （本小节谈【技术原理】。比较懒的同学，可以跳过这个小节。不影响后续阅读）  
   密钥的生成
    简单地说，是通过某种复杂的数学运算产生出来（密码学术语叫“密钥生成函数”）。在“密钥生成函数”的生成过程中会用到【哈希运算】和【多次迭代】。（注：“哈希运算”也叫“散列运算”，洋文叫“hash”，  这篇博文  有 hash 的扫盲）  如果你用图形界面的 TC 或 VC 创建一个新的加密盘，在创建过程中，软件会提示你：尽可能快速并随机地移动鼠标。这么干是通过你随机移动鼠标，让软件能收集到足够多的随机数据（足够的【熵值】）  为啥要搞如此复杂的数学方式来创造密钥捏？（通俗地说）要达到——为了让密钥尽可能随机，使得攻击者无法猜测密钥，也无法缩小密钥的分布范围。   
   密钥的存储
    加密盘的密钥，会以【加密】的形式存储在加密盘的“头部或尾部”。而你设置的“密码”或“key files”，就是用来加密密钥的。  所以，当你要打开加密盘时，如果输错了“密码”或“key files”，加密盘的密钥解不出来，自然就打不开。         ★如何防止攻击者【窃取】密钥？ 
       ◇确保物理系统（Host OS）的【纯洁】 
  关于这点，无需多言。  如果你的物理系统本身已经中招（感染了恶意软件），那么，其它所有的防范措施皆是空中楼阁。  关于这个话题，可以参见之前的系列教程：  《  如何防止黑客入侵  》        ◇在电脑的 BIOS 设置“开机密码”和“硬盘锁密码” 
  这2点也是老调重弹了——俺刚在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》中已经提到过。  设置这两个密码，是为了防止攻击者（警方人员）在物理接触你的电脑之后，在（主引导扇区的）boot loader 中植入恶意软件，从而盗取你全盘加密的“密码或密钥”。  （注：在【不】依赖外部启动介质的情况下，主引导扇区是【不可能】加密滴。因为至少要有一个【明文】的程序，让你输入“全盘加密的”解锁密码，并执行解锁的动作）  从技术上讲，你也可以把 boot loader 放到某个外置的【可启动 U 盘】中，每次开机都先插入该 U 盘。但这么干太麻烦，而且会引来额外的风险。因为 U 盘没法像笔记本那样设置【硬盘锁】。警方的技侦人员如果能偷偷拿到你的这个启动 U 盘，同样可以植入恶意软件。        ◇【禁用】“虚拟内存” 
  现代操作系统都有“虚拟内存”的机制。对 Windows 而言，叫做“页交换文件”，对 Linux 而言就是“swap 分区”。  “虚拟内存”的作用在于——当物理内存比较紧张的时候，把一些不经常访问的“内存页”转储到硬盘，就可以腾出物理内存来存放新的内容。  一旦启用了“虚拟内存”，也就存在某种可能性——【敏感加密盘的密钥】有可能会残留在“虚拟内存”（也就是硬盘上）——显然，这增加了你的风险。   有些同学可能会问：既然已经“全盘加密”，不论是“swap 分区”还是“页交换文件”，都被加密了。为啥还要担心这个风险？  下面，俺来回答一下——   前一篇博文  之所以建议：在“全盘加密”的基础上再搞“敏感加密盘”，就是因为这两个东西的【密级不同】——“敏感加密盘”的密级【更高】。  如果你在物理系统（Host OS）中启用了“虚拟内存”，你就把“敏感加密盘”的安全等级【降低到】与“全盘加密”一样的水平。换句话说，一旦攻击者能够突破全盘加密，也就【有可能】从“虚拟内存”中找到“敏感加密盘的密钥”，从而突破“敏感加密盘”。        ◇谈谈“关机、休眠、待机”三者的安全差异 
  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中，俺提到：      
当你要【长时间】离开自己的电脑——应该【关机】（shutdown）；而【不要】“休眠”（hibernation）或“待机”（suspend，stand by）    
 现在来解释一下：   
   休眠（hibernation）
    所谓的“休眠”（hibernation），说白了就是把【整个物理内存】保存到硬盘中的“休眠文件”。 
   这非常危险！
   危险的原因参见“虚拟内存”那个小节的讨论。另外，如果你在【未卸载】“敏感加密盘”的情况下让系统休眠，那么“休眠文件”中【必定包含】“敏感加密盘”的【密钥】。   
   待机（suspend，stand by）
    如果你已经禁用了“虚拟内存”和“休眠功能”，仅仅是让系统“待机”，这种情况下，加密盘的密钥【不会】出现在硬盘上，但还是有风险——如果你在待机之前【没有】卸载加密盘，加密盘的密钥还在物理内存（RAM）中。  如今的 DRAM 内存条在断电后依然有【数据残留】。在你离开电脑的这段时间里，如果警方的技侦人员对（正在待机的）电脑进行【冷启动攻击】（洋文叫“cold boot attack”，维基百科的链接在“  这里  ”），可以直接拿到【内存条】中的数据，再从中分析出“加密盘密钥”。  （注：断电之后，内存条中的数据【不会】立即消失，会有一个残留时间。温度越低，残留时间越长。在正常的室温下，内存条的数据残留时间【不超过】10分钟）   引申阅读：  在2013年的旧博文，俺已经介绍了【冷启动攻击】的原理和手法。  《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》  “冷启动攻击”这个手法已经有10年以上的历史。很多笔记本厂商在硬件和 BIOS 方面做了一些防范措施。可惜的是：前几个月（2018年9月），国外安全研究人员曝光了“冷启动攻击”的新进展——可以突破所有主流 PC 厂商（与“待机”相关）的防御。  《  研究人员警告现代计算机都易受冷启动攻击 @ Solidot  》  《  New modification of the old cold boot attack leaves most systems vulnerable @ Ars Technica  》   
   关机（shutdown）
    既然“休眠”和“待机”都靠不住，你只剩下一个选择——【关机】。  前面提到——正常的室温下，内存条的数据残留时间【不超过】10分钟。也就是说，只要关机超过10分钟，就【不可能】进行“冷启动攻击”了——因为内存条中的数据全都消失了。   
   补充：锁定屏幕
    如果你仅仅是“锁定屏幕”，其风险情况与“待机”类似——你的 PC 会被【冷启动攻击】搞定。   
   补充：混合睡眠模式
    经热心读者提醒：Windows8 开始引入了【混合睡眠模式】。即使在“待机”状态下也会保存一部分内存到硬盘上。  因此，你应该彻底禁止“休眠功能”（具体参见微软官网的“  这个链接  ”）。        ◇禁用 FireWire DMA 
  “FireWire”是某种硬件接口规格（俗称“火线接口”，也叫“IEEE 1394 接口”）。这玩意儿支持 DMA（direct memory access）方式直接操作【物理内存】。所以攻击者如果能物理接触你的电脑，可以在你的电脑上插入某个特定 FireWire 设备，然后利用 DMA 的方式直接读取整个系统的内存。因此，这招也叫做“  DMA attack  ”  这种攻击方式不仅仅是理论上可行，前几年就已经有人搞了傻瓜化的“DMA 攻击工具”。  如果 BIOS 有 FireWire DMA 相关选项，应该禁掉；或者在操作系统层面禁用相关的功能（通过“重编译 Linux 内核”）。  由于这个方式也是针对【运行状态下】盗取内存。所以，【关机】可以对付这种攻击方式。         ★“机械硬盘”与“固态硬盘（闪存）”【删除数据】的差异——损耗均衡技术 
       ◇“损耗均衡技术”是啥玩意儿？ 
  为了介绍后面的章节，需要先扫盲一个小知识——损耗均衡技术（洋文叫“wear leveling”）。  考虑到本文的大部分读者不是 IT 硬件方面的专业人士，俺尽量通俗地扫盲一下。  所谓的“固态硬盘”（SSD），是以【闪存】作为永久性存储介质。平时咱们用的“U盘”也是以【闪存】作为介质。（为了打字省力，本文以下章节凡是提到“闪存介质”，就是指——“采用闪存作为存储介质”的各种东西的【总称】）  “闪存介质”相比“机械硬盘”的一大【缺点】是——写入次数的上限比较低。如果某个存储单元的数据反复更改（反复写入），达到上限后，这个存储单元就坏掉（变为“不可用”）。  “闪存介质”的厂商为了解决这个问题，采用了“损耗均衡技术”（详细介绍请看维基百科的“  这个链接  ”）。比如某个文件，原先存储在“a单元”，当你更改了文件内容并保存，新的内容就不在“a单元”了，而是把新内容存到一个用得最少的“b单元”。此时，“a单元”里面依然有该文件的【旧内容】。  请注意，这个技术是由【硬件层面】（闪存介质的控制器）实现的，对操作系统【不可见】。        ◇“损耗均衡技术”【不利于】彻底删除数据 
  聪明的读者，看完前一个小节，已经发现问题所在了。  很多时候，为了彻底删除文件，要用“垃圾数据（随机数据）”去覆盖文件的原有内容，从而让原有内容【不可恢复】。这个招数对“机械硬盘”是 OK 的，但对“闪存介质”就不灵了。因为“损耗均衡技术”使得你覆盖的内容存到的【别的】单元，根本【没达到】你想要的目的。  而且俺刚才也说了——“损耗均衡技术”是由硬件层面的存储控制器实现，对操作系统不可见。所以，用【软件方式】难以证明某个存储单元是否【真正被覆盖了】。        ◇对【闪存介质】，如何彻底删除文件？ 
  综上所述，要想在“闪存介质”中彻底删除文件，你需要换一种思路，大致如下：  1. 先简单删除该文件  2. 用垃圾数据（随机数据）填满该存储介质的剩余空间——要 100% 填满。  （这样才能确保——原先保存过敏感数据的单元，已经被垃圾数据覆盖掉）   注意事项：要填满的是【物理硬盘】的“剩余空间”，而不是【分区】的“剩余空间”。  举个例子：  假设你的固态硬盘有多个分区。敏感文件在“分区1”，你把敏感文件删除后，光填满“分区1”的剩余空间是【不够】滴。  正确做法是——你要把【所有】分区的剩余空间都填满，才能确保之前保存过敏感数据的单元，确实被垃圾数据覆盖掉了。        ◇闪存厂商提供的工具，是否可信/可靠？ 
  某些闪存介质的厂商会提供一些配套的工具/软件，据说可以提供【彻底删除】的功能。  对此，俺表示谨慎的怀疑。因为无法验证其效果。  所以，为了保险起见，还是老老实实去【填满剩余空间】吧。        ◇小结 
  正式因为“闪存介质”要彻底删除文件，如此之麻烦。所以那些看重隐私保护的同学，更加应该早早用上【全盘加密】。  一旦你在“闪存介质”上使用【全盘加密】，每一个物理存储单元中的数据都是【密文】——“损耗均衡技术”就不再是障碍啦。         ★如何【快速且彻底】销毁加密盘的数据？ 
       ◇为啥要强调“快速且彻底”？ 
  为啥俺强调【彻底】？——只有彻底地销毁数据，才能对付警方的【取证软件】；  为啥俺强调【迅速】？——警方想要拘捕你，当然不会留给你从容的时间。比如说：当警方人员正在撞门的时候，留给你的时间可能连1分钟都不到。        ◇“销毁”的含义 
  本章节所说的“销毁”是指——让任何人【包括你自己】再也无法得到加密盘里面的数据。        ◇为啥“哄骗”不可行？ 
  本文发出后，某些热心读者提到了“哄骗”的招数。简单说就是：你假装销毁，但其实并没有。这样做，将来你自己还能继续打开加密盘。  俺认为：这种方法【不够】可靠， 
   甚至是危险的想法
   。理由如下：  如果你是警方的重点关注对象，或者你是重大案件的关键人物，警方肯定会动用【刑侦和审讯】方面的高手来参与办案。  在这种情况下，你【别想】太容易哄骗对方。除非你自己也受过【严格的】“反侦查和反审讯”方面的训练。  但试问：有几个人具备这个条件？  基于上述理由——只有当你在紧急情况下，无法彻底销毁敏感数据，再考虑“哄骗”的招数。        ◇【错误】方式举例 
  首先来说说【反面】教材。所谓“错误的方式”指的是——【不够彻底】或者【不够快速】的方式。   
   错误方式1
   ——用“普通的删除命令”删除加密盘里面的文件  （所谓的“普通删除命令”，比如：Linux 下的 
   rm
   命令，Windows 下的 
   del
   命令）  首先，这种做法【不】彻底（会被“取证软件”恢复出来）；其次，如果加密盘中的文件很多，这种做法太慢。   
   错误方式2
   ——用“专门的【擦除】命令”彻底删除加密盘里面的文件  （所谓的“专门的擦除命令”，比如 linux 下的 
   shred
   命令）  这种方式比较彻底，但是【慢】。如果文件很多，就非常慢。  （注：shred 支持【多轮反复擦除】，可以防范专业取证人员对机械硬盘的“剩磁分析”，但也导致其速度很慢。即使你把 shred 设置为“只擦除1轮”，速度还是慢）   
   错误方式3
   ——快速格式化  这种方式速度快，但是不彻底——被“快格”的分区，数据全都在。   
   错误方式4
   ——彻底格式化  这种方式算是比较彻底，可惜【太慢】了。如果格式化的分区有好几个 GB，你就慢慢等吧。        ◇【正确】方式——彻底删除 key files 
  关于这招，已经提到过多次了。不但本文提到，之前在多篇博文中也提到。  这种方式有两种实现——“软删除”和“硬删除”。  如果 key files 存储在 PC 的硬盘上，用软件方式（比如：shred 命令）彻底擦除内容。为了讨论方便，以下称之为：“软删除 key files”。  如果 key files 放在【外部】的存储介质（比如：U盘、MMC/SD 卡、...），你可以先把存储卡插到 PC 上，然后用软件干掉 key files（依然是“软删除”）；但你还可以用【物理方式】直接破坏存储介质（这种情况称为——“硬删除 key files”）。  由于 key files 都很小（通常小于 1MB），所以“软删除 key files”肯定是【既快速又彻底】。   提醒：“软删除”的【局限性】  如果是【机械硬盘】，“软删除”是 OK 的；但如果是【固态硬盘】，“软删除”【不】保险。原因请参见本文前面章节介绍的【损耗均衡技术】。  至于“硬删除”的方式  由于存在几种不同情况，后面俺用一个单独的章节来讨论。        ◇【正确】方式——破坏加密盘的【密钥存储区】 
  前面俺聊“密钥的存储”，已经提到——磁盘加密软件为了能打开加密的数据，必须把密钥（以【加密形式】）存储在某个地方。通常是存储在加密盘的【头部或尾部】。  当你输入认证因子（“密码”和“key files”），加密软件根据“认证因子”进行一系列数学运算，然后从密钥存储区中解密出【加密盘的密钥】。如果你的认证因子输错了，密钥就解不出，加密盘自然打不开。  所以，如果你用“随机数据”把加密卷的【头部和尾部】两者都覆盖，就足以【彻底破坏】整个加密盘。  密钥存储区通常很小（不到 1KB）。为了保险起见，咱们把覆盖范围扩大一千倍（从 1KB 变为 1MB），彻底覆盖加密盘最开头的 1MB 和最末尾的 1MB，肯定就能毁掉“密钥存储区”了。  再来看“速度”——哪怕老式的机械硬盘，对头尾各写入 1MB 的数据，也可以在1秒内完成。所以这招属于【既彻底又快速】。   提醒：本招数的【局限性】  如果是【机械硬盘】，可以用这招；但如果是【固态硬盘】，这招【不】保险。原因请参见刚才介绍的“损耗均衡技术”。        ◇【运行状态】下的权衡 
  （所谓的【运行状态】指的是——出现“紧急情况”时，你的 PC 处于【开机运行】，并且你正在操作它）  在这种情况下，显然【可以用】“破坏加密盘”的方式。  至于“删除 key files”是否可用，取决于你的 key files 存储放在哪里？  1. 如果你的 key files 存储在 PC 上，也可用“【软】删除 key files”的方式。  2. 如果你的 key files 位于【外部】存储介质（比如：U盘、MMC/SD 卡、...），并且这个存储介质【没有】插在电脑上，就应该用“【硬】删除 key files”的方式。        ◇【关机状态】下的权衡 
  当你的 PC 处于【关机状态】，一旦碰到紧急情况，你已经来不及开机并启动系统。所以，“破坏加密盘”显然不可行；同样的道理，此时“软删除 key files”也不可行。  因此，在【离线状态】下，你只有唯一的选项——“硬删除 key files”。        ◇结论 
  从上述两种状态的权衡，很自然就可以得出结论—— 
   key files 必须位于你【身边】的存储介质中
   。只有这样才能保证——你在【各种情况】下都能【快速且彻底】地销毁加密数据。  为了让大伙儿一目了然，放一个对照表：       
    
     
      
      
      
       运行状态，机械硬盘
      
      
       运行状态，固态硬盘
      
      
       关机状态
      
     
     
      
       【硬】删除 key files
      
      
       YES
      
      
       YES
      
      
       YES
      
     
     
      
       【软】删除 key files
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
     
      
       破坏加密盘的【密钥存储区】
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
    
    
        ★如何【物理破坏】存储卡？ 
  好，现在来谈“硬删除 key files”的方式——也就是“从物理上毁掉存储卡”。  （注：本章节所说的“存储卡”包括：U盘、SD卡、MMC卡...）  再次唠叨：这种“物理破坏”的方式比较粗鲁，是【紧急情况下】的无奈之举。如果你的时间比较从容，应该用前面提到的软件方式——删除敏感文件后，通过填充垃圾数据，塞满整张存储卡的剩余空间。        ◇U 盘的内部结构 
  为了方便讲解，从维基百科剽窃了一张照片，并附上相应的说明。         
    
1　插头  2　存储控制器  3　测试接点  4　【 
    闪存芯片
    】  5　石英振荡器  6　发光二极管（LED）  7　写入保护开关  8　预留给第二颗存储器芯片的空间    
       ◇物理摧毁的关键——破坏【闪存芯片】 
  对存储卡而言，除了【闪存芯片】，其它的都是浮云。  因为其它所有的部件全被毁掉，只要【闪存芯片】还完好，就可以通过专用的设备，读取出里面保存的数据。        ◇破坏“闪存芯片”——【彻底】的方式 
  关于这个话题，俺看过一些资料，以及网上的讨论。权衡下来，能够在“短时间”（1分钟内）物理破坏“闪存芯片”的方式，大致有两种：   
   电磁方式——微波炉
    把存储卡放入微波炉并启动。  这么干，不但能毁掉存储芯片，可能你的微波炉也会跟着报废。但在紧急情况下，一个微波炉又算得了什么？   
   机械方式——砸烂
    如果你身边有锤子、扳手（或诸如此类的工具），对准结构图当中那个“傻大黑粗”的家伙狠狠砸下去，砸烂为止。  由于“闪存芯片”比较硬，还可以考虑用某个尖锐的东西作为辅助（学过基础物理学的应该明白——这可以增加压强）。就比如说，把一个钉子架在“闪存芯片”上，然后再用锤子敲击钉子，更容易击穿芯片的外壳。  但如今现代化的家庭或办公室中，要想找一个钉子还真不太容易。那么，啥东西可以作为钉子的替代品捏？俺列几个替代品作为参考（欢迎大伙儿补充）      
螺丝刀（尤其是【小型的十字】螺丝刀）  瑞士军刀中某些尖锐的部件（如下图）    
       （某款瑞士军刀的示意图——几乎每种款式的瑞士军刀都带有尖锐的工具） 
       ◇破坏“闪存芯片”——【不太彻底】的方式 
  现在介绍【不】那么彻底的方式。也供高风险人士参考。  在紧急情况下，如果你身边没有微波炉也没有砸烂芯片的工具，还有一招是——用冲水马桶把存储卡冲掉。如今的存储卡都比较小，至少不会卡在马桶里。  但要强调的是——这招【不彻底】，因为存储卡浸泡在普通液体（只要不是强酸），即使长达几天时间，还是有可能恢复出数据。  如果你用了这招，那主动权就转到警方这边——考验他们是否愿意到粪坑里去找存储卡了。         ★预备和演习 
  如果你确实认为自己是【高风险人士】，本文讲述的这些东西，你【不要】光看看而已。要先做好准备工作，甚至来一次演习（彩排）。  否则真的到了紧急情况，你在慌乱之中很可能会出错。（这是本文最后的忠告）    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》  《  文件加密的扫盲介绍  》  《  扫盲文件完整性校验——关于散列值和数字签名  》  《  TrueCrypt 使用经验  》（系列）  《  扫盲 VeraCrypt——跨平台的 TrueCrypt 替代品  》  《  扫盲 dm-crypt——多功能 Linux 磁盘加密工具（兼容 TrueCrypt 和 VeraCrypt）  》  《  扫盲 Linux 逻辑卷管理（LVM）——兼谈 RAID 以及“磁盘加密工具的整合”  》  《  文件备份技巧：组合“虚拟加密盘”与“网盘”  》  《  如何保护隐私  》（系列）  《  如何防止黑客入侵  》（系列）  《  扫盲 Linux＆UNIX 命令行——从“电传打字机”聊到“shell 脚本编程”  》  《  扫盲操作系统虚拟机  》（系列）      
    

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html 
    
    
  
  
    
         
    
    
    
 
    
  

" />
    
    <meta name="author" content="觀點" />

    
    <meta property="og:title" content="如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧" />
    <meta property="twitter:title" content="如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧" />
    

  <link rel="stylesheet" type="text/css" href="/opinion/style.css" />
  <link rel="alternate" type="application/rss+xml" title="觀點 - 從草根到大師 git.io/JJCxS" href="/opinion/feed.xml" />

  <!-- Social Share Kit CSS -->
  <link rel="stylesheet" href="/opinion/assets/css/social-share-kit.css" type="text/css">
  <link rel="stylesheet" href="/opinion/assets/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="/opinion/assets/css/bootstrap.min.css" type="text/css">
  <script type="text/javascript" src="/opinion/assets/js/jquery-3.5.1.js"></script>
  <script type="text/javascript" src="/opinion/assets/js/page.js"></script>

</head>

  <body>
    <div class="wrapper-masthead">
  <div class="container">
    <header class="masthead clearfix">
      

      <div class="site-info">
        <h1 class="site-name" style="display: inline-block;"><a href="/opinion/">觀點</a></h1>
        <i class="site-description" style="font-size: 12px;">從草根到大師 git.io/JJCxS</i>
      </div>

      <nav>
        <span id="search-container" >
          <a href="/opinion/tools"><i class="fa fa-bookmark twitter" title="百宝箱"></i></a>
        <a><i class="fa fa-search" title="限前100結果"></i></a><input type="text" id="search-input" placeholder="標題 作者 來源 日期 (17489)"
          style="margin: 10px 0px 0px 0px; height: 30px;width: auto" title="本站最正確的打開方式">
        </span>
        
        
        <a href="/opinion/categories" style="color: Tomato;"><i class="fa fa-tags" title="分类"></i></a>
        
        
        
        <a href="https://be4.herokuapp.com/" style="color: #003366;"><i class="fa fa-comments" title="论坛"></i></a>
        
        
        
        <a href="/opinion/about"><i class="fa fa-info-circle" title="关于"></i></a>
        
        
        <a title="电脑热键：&larr;上一篇(页), &rarr;下一篇(页), ins同来源新一篇，del同来源旧一篇" onclick="toggle_visibility('help')"><i class="fa fa-question-circle"></i></a>
        <a id="fa-home" href="https://nodebe4.github.io" title="BE4服务列表" onclick="//toggle_visibility('site-list')"><i class="fa fa-home" aria-hidden="true"></i></a>
      </nav>

    </header>
    <div id="site-list" class="tags" style="display: block;text-align: right;border-bottom: 1px solid lightGray;"><noscript><span style="background-color: #e8e8e8;color: #d10000;font-size: 14px;">开启浏览器JavaScript以获取搜索功能和更好的浏览体验</span></noscript></div>
    <p id="help" style="font-size: 14px;display: none;text-align: right;"><span style="color:green;">电脑热键：&larr;上一篇(页), &rarr;下一篇(页), ins同来源新一篇, del同来源旧一篇</span>; <span style="color:orange">对应触屏FAB：上下右左</span>; 轉Markdown<a href="https://euangoddard.github.io/clipboard2markdown/"><i class="fa fa-file-text-o"></i></a></p>
  </div>
</div>

<script type="text/javascript" >
  function toggle_visibility(id){
    var help = document.getElementById(id)
    if (help.style.display=='none'){
      help.style.display='block';
    }else{
      help.style.display='none';
    }
  }

  const url = "https://nodebe4.github.io/sitelist.json"

  document.addEventListener("DOMContentLoaded", function(event){
    // var homebtn = document.getElementById("fa-home")
    // homebtn.removeAttribute("href")
    var content = document.getElementById("site-list");
    content.innerHTML = ''
    var ul = document.createElement("ul")
    ul.classList.add("label")
    content.appendChild(ul)
    var cnt = 0

    $.getJSON(url, function(allsites) {

      allsites.map(item =>{
        var li = document.createElement('li')
        li.classList.add("tag")
        li.id = 'site-' + cnt
        ul.appendChild(li)
        var a0 = document.createElement('a')
        li.appendChild(a0)
        a0.href = item.url[0]
        var span = document.createElement('span')
        a0.appendChild(span)
        span.innerText = item['name']
        // span.style.backgroundColor = item['background-color']
        // span.style.color='#E4CBC3'
        span.style.color = item['background-color']
        span.style['font-size'] = '14px'
        cnt += 1
        // test_alive(li.id, a0.href)
      })
    })
  })

function test_alive(id, url){
  var divstatus = document.getElementById(id)
  const base = 'https://textance.herokuapp.com/title/'
  var fullurl = base + url
  $.ajax({
      url: fullurl,
      complete: function(data) {
        if (data.responseText.includes('502')){
          // divstatus.style.color='#FBB7B7'
          // divstatus.style.color='gray'
          // divstatus.title = "服务器无响应"
          divstatus.parentNode.removeChild(divstatus)
        }else{
          // divstatus.style.color='#B6FAC8'
          divstatus.title = data.responseText
        }
      }
  });
  return divstatus
}
</script>



    <!-- Left & centered positioning -->

<div class="ssk-sticky ssk-right ssk-center ssk-sticky-hide-xs ssk-group ssk-round">
  
    <a href="https://be4news.pythonanywhere.com/archivenow/ia/https%3A%2F%2Fprogram-think.blogspot.com%2F2019%2F02%2FUse-Disk-Encryption-Anti-Computer-Forensics.html" class="ssk ssk-link" title="存到互联网档案馆" target="_blank"></a>
    <a href="https://www.facebook.com/sharer.php?u=https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html" class="ssk ssk-facebook"></a>
    <a href="https://twitter.com/intent/tweet?url=https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html&text=如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧&hashtags=觀點" class="ssk ssk-twitter"></a>
    <a href="https://reddit.com/submit?url=https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html&title=如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧" class="ssk ssk-reddit"></a>
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html&title=如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧" class="ssk ssk-linkedin"></a>
    <a href="mailto:{email_address}?subject=如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧&body=

      如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧  
  
    
      
    
  
  
春节假期结束啦，继续来谈信息安全的话题。  先顺便说俩事儿：  1. 虽然本文与上一篇博文的间隔超过两周，但俺上一次【网络活动】是2月7日（在回复读者评论）。所以，依然属于【正常静默】。不要担心俺 :)  2. 上一篇博文发出后，经几位热心读者提醒，俺又对“社会工程学”那个章节补充了几点内容。        ★引子 
  前不久正值【开博十周年】之际，俺写了一篇《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》。  今天这篇是对前一篇进行补充，主要谈—— 
   如何对付警方
   ？看到俺写这样的东西，公安系统的“网监部门”和“技侦部门”，肯定又不爽了 :)  
       
        ★本文讨论的范围 
  为了避免某些读者来抬杠，先声明一下本文讨论范围。        ◇面向【高风险政治人士】 
  和  前一篇博文  类似，这篇也是写给“高风险政治人士”（类似俺这种反党人士）的教程。  如果你有可能成为【警方】的重点关注目标，大概就可以算是“高风险”啦。  （注：此处的“警方”包括天朝的“公安部、国安部”或类似机构；也包括其它国家的类似机构）   当然啦，所有的技术都是【双刃剑】——都可能被滥用。某些在网络上干坏事的家伙，也会从本文中受益。关于这点，俺也很无奈 :(  但是，俺不会因为技术存在被滥用的可能性，就停止对技术的传播和普及。        ◇本文只讨论【个人电脑】，【不】讨论手机或平板 
  俺已经多次谈过【移动设备的危险性】。显然，“高危人士”就【不该】在手机上进行任何危险操作。  因此，本文不打算谈“手机的话题”，只讨论【个人电脑】（桌面 PC）。  （注：本文中所说的“PC”，既包括“台式机”，也包括“笔记本电脑”）        ◇本文主要介绍【通用】的方法论 
  为了叙述方便，在涉及“操作系统”时，俺会拿 Linux 来说事儿。用 Windows 或 Mac OS 的同学，请依样画葫芦。  为了叙述方便，在谈到“磁盘加密软件”时，俺会以 TC（TrueCrypt）/VC（VeraCrypt）来举例。但本文介绍的方法，也能适用于其它磁盘加密工具（前提是——要支持【key files】这种机制）。         ★本文的特色 
  网上已经有很多关于【磁盘加密】的教程。包括俺自己，也已经写了好多这类教程。  为了避免读者说俺炒冷饭，先说说本文的【特色】。        ◇本文会更多地讨论【物理安全】 
  关于其它层面的防御，在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中已经谈了很多。所以，本文会更多地讨论：PC 的【物理安全】。  与“网上的骇客”不同，警方不光能【物理接触】你的 PC，甚至可以没收你的 PC（拿回去做“数据取证分析”）。因此，当你面对警方的时候，【物理安全】很重要！  （由于主要讨论“物理安全”）在本文中，如果没有特别注明，关于【操作系统】的讨论，针对的是【物理系统】（Host OS）。        ◇本文会更多地讨论【紧急情况】的应对 
  警方不光可以把你的电子设备（电脑、手机）拿去做“数据取证分析”，还可以限制你的行动自由（拘捕/逮捕）。  所以本文会花一些篇幅讨论——如何应对【紧急情况】。也就是说，当你即将丧失行动自由【之前】，该做哪些操作，对你最有利。  请注意：在你被捕之前， 
   你对敏感数据销毁越彻底，警方就越拿你没办法（因此也就对你越有利）。
           ★警方如何【破解】加密盘？ 
  《孙子兵法》说【知己知彼 百战不殆】。你要防范对方，首先要知道对方有哪些招数。  关于“攻击者如何破解加密盘”这个话题，俺在5年前（2013）已经写了一篇：《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》。  虽然那篇是针对 TrueCrypt 加密盘，但其中提到的几种破解手段，对其它格式的加密盘（VeraCrypt，LUKS，BitLocker ......）也适用。  考虑到某些新读者没有看到那篇旧博文，俺把那篇中提到的几种破解手段再【简述】如下。        ◇利用“加密算法本身的漏洞”——基本上【不可能】 
  【成熟的】磁盘加密软件，使用的“对称加密算法”肯定也是【成熟】滴。  以 TC（TrueCrypt）/VC（VeraCrypt）为例，它支持的“对称加密算法”是“Rijndael（AES）、Twofish、Serpent”。  当年美国国家标准局（NIST）公开招标21世纪的新一代加密算法标准（叫“高级加密标准”，简称“AES”）；经过多次淘汰，有5个算法成为【最后一批】候选者，上述的3个算法也在这5个当中；最终是 Rijndael 正式被选中成为 AES（所以，现在所说的 AES 也就是指 Rijndael）。  由于这三个算法是历经淘汰的最后一批候选者，算法本身已经被世界各国的密码学专家仔细检查过啦，【几乎不可能】出现算法层面的漏洞。  引申阅读：在如下博文中介绍了磁盘加密常用的几种“对称加密算法”。  《  TrueCrypt 使用经验[1]：关于加密算法和加密盘的类型  》        ◇对密钥的穷举——基本上【不可能】 
  刚才说啦——成熟的磁盘加密软件，使用的加密算法肯定也是【成熟】滴。  既然如此，算法使用的密钥，其“密钥空间”肯定足够大。因此在足够长时间内（几代人），并考虑到摩尔定律带来的算力增长，都【不可能】对密钥进行穷举。  以 AES256 为例，其密钥有【256 比特】，所有可能的密钥数量是【2的256次方】。这个数有多大捏？      2^256 = 115792089237316195423570985008687907853269984665640564039457584007913129639936    
       ◇对【弱】密码/口令的【暴力猜解】——常见招数 
  这是最常见的手段，专门针对【弱密码】（weak password）。  由于本文要对付的是【警方】。他们比一般的骇客具备更多的资源。比方说，天朝的警方已经建立了专门用于“暴力猜解密码”的【服务器集群】，可以大大提升密码猜解的效率。普通骇客用“单机”无法暴力猜解的密码，有可能被警方搞定。   但是， 
   这招很好对付
   ——你只需要引入【key files】作为加密盘的“认证因素”，就可以让警方的暴力猜解变得【不可能】。  在《  TrueCrypt 使用经验[2]：关于加密盘的密码认证和 KeyFiles 认证  》一文中，俺已经谈过“key files”的“用途”和“注意事项”。关于“注意事项”，再说一次：  1. key files 要使用“二进制文件”，【不要】用“文本文件”  2. key files 最好是【随机生成】（TC 和 VC 自带了“随机生成 key file”的功能）  3. key files 的文件尺寸【至少64字节】  外行的读者可能会觉得“64字节”太小了。其实“64字节”的随机文件，已经足够对抗穷举。一个字节有8比特，64字节有512比特。因此，64字节的随机内容，其可能的数量是“2的512次方”——这已经大大超过刚才提到的“AES 256 密钥空间”了。  给大伙儿秀一下这个数有多大。      2^512 = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096    
  另外，像 TC/VC 这两款磁盘加密软件，最多只提取【每个】key file 开头的一兆字节（1MB）参与密钥生成。所以，随机生成的 key file，每个都【不必】超过 1MB。        ◇【窃取】加密盘的【密钥】——常见招数，本文的重点 
  前面提到的几种攻击手法，都比较好解决（容易防御）。比较难对付的是这招——“攻击者盗取密钥”。所以，对这招的防范是本文的重点内容之一。  下面，俺分多个章节，对这个话题进行展开。        ◇用【审讯】的方式获得“密码和 key files”——常见招数，本文重点 
  前面的“攻击手法”都属于【技术手段】。如果警方尝试了技术手段而不可得，那自然会采用【审讯】的方式。  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文，俺已经谈到了【如何对付审讯】（包括酷刑）。  原理很简单——如果你的加密盘采用了【随机生成】的 key files 作为“认证因子”。你只需要在“丧失行动自由（被捕）”之前【彻底销毁】key files；如此一来，连你自己都【不可能】打开加密盘。酷刑也就失去意义啦。  原理说起来蛮简单，但落实起来会涉及到很多细节。比如说：如何【既彻底又快速】地销毁 key files？下面单列一个章节来谈。         ★为啥加密盘的【密钥】如此关键？ 
       ◇【密钥】是啥玩意儿？ 
  （考虑到大部分读者基本不懂密码学，俺尽可能通俗地解释一下【密钥】是啥玩意儿）  密钥说白了就是一段数据，可以用来加密或者解密。磁盘加密软件用的算法都是“对称加密算法”。这种算法的特点是：“加密的密钥”和“解密的密钥”是【同一个】。假设你用“密钥 K”把一段“明文 P”变成“密文 C”，那么你同样可以用 K 把 C 变为 P。  除了“对称加密算法”，还有一类算法叫做“非对称加密算法”——“加密的密钥”和“解密的密钥”是【不同】滴。这类算法与本文无关，就不展开介绍啦。        ◇“密钥”（key）与“密码/口令”（password）有啥【区别】？ 
  很多不懂技术的网友经常混淆“密钥”和“密码”，其实这两者是【完全不同】滴：  1. 密钥（key）直接参与加密/解密运算滴。  2. 密码（password）【不】参与“加密/解密”运算，它的作用是保护“密钥”。        ◇为啥说密钥【很重要】？ 
  首先，  如果攻击者能通过某种方式【窃取】密钥（key），就可以直接用密钥（key）【解密】加密盘存储的数据。  也就是说——在【不知道】你的密码和 key files 的情况下，也能打开加密盘。  其次，  一旦创建了加密盘，其密钥就固定了。即使你修改了加密盘的“认证因子”（“密码”或“key files”），密钥依然【不变】。  
   一旦攻击者拿到某个加密盘的密钥，不论你如何修改密码，攻击者依然可以打开这个加密盘。
    综上所述，  
   “密钥”的重要性【超过】“密码”和“key files”
   。        ◇密钥如何【生成和存储】？ 
  （本小节谈【技术原理】。比较懒的同学，可以跳过这个小节。不影响后续阅读）  
   密钥的生成
    简单地说，是通过某种复杂的数学运算产生出来（密码学术语叫“密钥生成函数”）。在“密钥生成函数”的生成过程中会用到【哈希运算】和【多次迭代】。（注：“哈希运算”也叫“散列运算”，洋文叫“hash”，  这篇博文  有 hash 的扫盲）  如果你用图形界面的 TC 或 VC 创建一个新的加密盘，在创建过程中，软件会提示你：尽可能快速并随机地移动鼠标。这么干是通过你随机移动鼠标，让软件能收集到足够多的随机数据（足够的【熵值】）  为啥要搞如此复杂的数学方式来创造密钥捏？（通俗地说）要达到——为了让密钥尽可能随机，使得攻击者无法猜测密钥，也无法缩小密钥的分布范围。   
   密钥的存储
    加密盘的密钥，会以【加密】的形式存储在加密盘的“头部或尾部”。而你设置的“密码”或“key files”，就是用来加密密钥的。  所以，当你要打开加密盘时，如果输错了“密码”或“key files”，加密盘的密钥解不出来，自然就打不开。         ★如何防止攻击者【窃取】密钥？ 
       ◇确保物理系统（Host OS）的【纯洁】 
  关于这点，无需多言。  如果你的物理系统本身已经中招（感染了恶意软件），那么，其它所有的防范措施皆是空中楼阁。  关于这个话题，可以参见之前的系列教程：  《  如何防止黑客入侵  》        ◇在电脑的 BIOS 设置“开机密码”和“硬盘锁密码” 
  这2点也是老调重弹了——俺刚在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》中已经提到过。  设置这两个密码，是为了防止攻击者（警方人员）在物理接触你的电脑之后，在（主引导扇区的）boot loader 中植入恶意软件，从而盗取你全盘加密的“密码或密钥”。  （注：在【不】依赖外部启动介质的情况下，主引导扇区是【不可能】加密滴。因为至少要有一个【明文】的程序，让你输入“全盘加密的”解锁密码，并执行解锁的动作）  从技术上讲，你也可以把 boot loader 放到某个外置的【可启动 U 盘】中，每次开机都先插入该 U 盘。但这么干太麻烦，而且会引来额外的风险。因为 U 盘没法像笔记本那样设置【硬盘锁】。警方的技侦人员如果能偷偷拿到你的这个启动 U 盘，同样可以植入恶意软件。        ◇【禁用】“虚拟内存” 
  现代操作系统都有“虚拟内存”的机制。对 Windows 而言，叫做“页交换文件”，对 Linux 而言就是“swap 分区”。  “虚拟内存”的作用在于——当物理内存比较紧张的时候，把一些不经常访问的“内存页”转储到硬盘，就可以腾出物理内存来存放新的内容。  一旦启用了“虚拟内存”，也就存在某种可能性——【敏感加密盘的密钥】有可能会残留在“虚拟内存”（也就是硬盘上）——显然，这增加了你的风险。   有些同学可能会问：既然已经“全盘加密”，不论是“swap 分区”还是“页交换文件”，都被加密了。为啥还要担心这个风险？  下面，俺来回答一下——   前一篇博文  之所以建议：在“全盘加密”的基础上再搞“敏感加密盘”，就是因为这两个东西的【密级不同】——“敏感加密盘”的密级【更高】。  如果你在物理系统（Host OS）中启用了“虚拟内存”，你就把“敏感加密盘”的安全等级【降低到】与“全盘加密”一样的水平。换句话说，一旦攻击者能够突破全盘加密，也就【有可能】从“虚拟内存”中找到“敏感加密盘的密钥”，从而突破“敏感加密盘”。        ◇谈谈“关机、休眠、待机”三者的安全差异 
  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中，俺提到：      
当你要【长时间】离开自己的电脑——应该【关机】（shutdown）；而【不要】“休眠”（hibernation）或“待机”（suspend，stand by）    
 现在来解释一下：   
   休眠（hibernation）
    所谓的“休眠”（hibernation），说白了就是把【整个物理内存】保存到硬盘中的“休眠文件”。 
   这非常危险！
   危险的原因参见“虚拟内存”那个小节的讨论。另外，如果你在【未卸载】“敏感加密盘”的情况下让系统休眠，那么“休眠文件”中【必定包含】“敏感加密盘”的【密钥】。   
   待机（suspend，stand by）
    如果你已经禁用了“虚拟内存”和“休眠功能”，仅仅是让系统“待机”，这种情况下，加密盘的密钥【不会】出现在硬盘上，但还是有风险——如果你在待机之前【没有】卸载加密盘，加密盘的密钥还在物理内存（RAM）中。  如今的 DRAM 内存条在断电后依然有【数据残留】。在你离开电脑的这段时间里，如果警方的技侦人员对（正在待机的）电脑进行【冷启动攻击】（洋文叫“cold boot attack”，维基百科的链接在“  这里  ”），可以直接拿到【内存条】中的数据，再从中分析出“加密盘密钥”。  （注：断电之后，内存条中的数据【不会】立即消失，会有一个残留时间。温度越低，残留时间越长。在正常的室温下，内存条的数据残留时间【不超过】10分钟）   引申阅读：  在2013年的旧博文，俺已经介绍了【冷启动攻击】的原理和手法。  《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》  “冷启动攻击”这个手法已经有10年以上的历史。很多笔记本厂商在硬件和 BIOS 方面做了一些防范措施。可惜的是：前几个月（2018年9月），国外安全研究人员曝光了“冷启动攻击”的新进展——可以突破所有主流 PC 厂商（与“待机”相关）的防御。  《  研究人员警告现代计算机都易受冷启动攻击 @ Solidot  》  《  New modification of the old cold boot attack leaves most systems vulnerable @ Ars Technica  》   
   关机（shutdown）
    既然“休眠”和“待机”都靠不住，你只剩下一个选择——【关机】。  前面提到——正常的室温下，内存条的数据残留时间【不超过】10分钟。也就是说，只要关机超过10分钟，就【不可能】进行“冷启动攻击”了——因为内存条中的数据全都消失了。   
   补充：锁定屏幕
    如果你仅仅是“锁定屏幕”，其风险情况与“待机”类似——你的 PC 会被【冷启动攻击】搞定。   
   补充：混合睡眠模式
    经热心读者提醒：Windows8 开始引入了【混合睡眠模式】。即使在“待机”状态下也会保存一部分内存到硬盘上。  因此，你应该彻底禁止“休眠功能”（具体参见微软官网的“  这个链接  ”）。        ◇禁用 FireWire DMA 
  “FireWire”是某种硬件接口规格（俗称“火线接口”，也叫“IEEE 1394 接口”）。这玩意儿支持 DMA（direct memory access）方式直接操作【物理内存】。所以攻击者如果能物理接触你的电脑，可以在你的电脑上插入某个特定 FireWire 设备，然后利用 DMA 的方式直接读取整个系统的内存。因此，这招也叫做“  DMA attack  ”  这种攻击方式不仅仅是理论上可行，前几年就已经有人搞了傻瓜化的“DMA 攻击工具”。  如果 BIOS 有 FireWire DMA 相关选项，应该禁掉；或者在操作系统层面禁用相关的功能（通过“重编译 Linux 内核”）。  由于这个方式也是针对【运行状态下】盗取内存。所以，【关机】可以对付这种攻击方式。         ★“机械硬盘”与“固态硬盘（闪存）”【删除数据】的差异——损耗均衡技术 
       ◇“损耗均衡技术”是啥玩意儿？ 
  为了介绍后面的章节，需要先扫盲一个小知识——损耗均衡技术（洋文叫“wear leveling”）。  考虑到本文的大部分读者不是 IT 硬件方面的专业人士，俺尽量通俗地扫盲一下。  所谓的“固态硬盘”（SSD），是以【闪存】作为永久性存储介质。平时咱们用的“U盘”也是以【闪存】作为介质。（为了打字省力，本文以下章节凡是提到“闪存介质”，就是指——“采用闪存作为存储介质”的各种东西的【总称】）  “闪存介质”相比“机械硬盘”的一大【缺点】是——写入次数的上限比较低。如果某个存储单元的数据反复更改（反复写入），达到上限后，这个存储单元就坏掉（变为“不可用”）。  “闪存介质”的厂商为了解决这个问题，采用了“损耗均衡技术”（详细介绍请看维基百科的“  这个链接  ”）。比如某个文件，原先存储在“a单元”，当你更改了文件内容并保存，新的内容就不在“a单元”了，而是把新内容存到一个用得最少的“b单元”。此时，“a单元”里面依然有该文件的【旧内容】。  请注意，这个技术是由【硬件层面】（闪存介质的控制器）实现的，对操作系统【不可见】。        ◇“损耗均衡技术”【不利于】彻底删除数据 
  聪明的读者，看完前一个小节，已经发现问题所在了。  很多时候，为了彻底删除文件，要用“垃圾数据（随机数据）”去覆盖文件的原有内容，从而让原有内容【不可恢复】。这个招数对“机械硬盘”是 OK 的，但对“闪存介质”就不灵了。因为“损耗均衡技术”使得你覆盖的内容存到的【别的】单元，根本【没达到】你想要的目的。  而且俺刚才也说了——“损耗均衡技术”是由硬件层面的存储控制器实现，对操作系统不可见。所以，用【软件方式】难以证明某个存储单元是否【真正被覆盖了】。        ◇对【闪存介质】，如何彻底删除文件？ 
  综上所述，要想在“闪存介质”中彻底删除文件，你需要换一种思路，大致如下：  1. 先简单删除该文件  2. 用垃圾数据（随机数据）填满该存储介质的剩余空间——要 100% 填满。  （这样才能确保——原先保存过敏感数据的单元，已经被垃圾数据覆盖掉）   注意事项：要填满的是【物理硬盘】的“剩余空间”，而不是【分区】的“剩余空间”。  举个例子：  假设你的固态硬盘有多个分区。敏感文件在“分区1”，你把敏感文件删除后，光填满“分区1”的剩余空间是【不够】滴。  正确做法是——你要把【所有】分区的剩余空间都填满，才能确保之前保存过敏感数据的单元，确实被垃圾数据覆盖掉了。        ◇闪存厂商提供的工具，是否可信/可靠？ 
  某些闪存介质的厂商会提供一些配套的工具/软件，据说可以提供【彻底删除】的功能。  对此，俺表示谨慎的怀疑。因为无法验证其效果。  所以，为了保险起见，还是老老实实去【填满剩余空间】吧。        ◇小结 
  正式因为“闪存介质”要彻底删除文件，如此之麻烦。所以那些看重隐私保护的同学，更加应该早早用上【全盘加密】。  一旦你在“闪存介质”上使用【全盘加密】，每一个物理存储单元中的数据都是【密文】——“损耗均衡技术”就不再是障碍啦。         ★如何【快速且彻底】销毁加密盘的数据？ 
       ◇为啥要强调“快速且彻底”？ 
  为啥俺强调【彻底】？——只有彻底地销毁数据，才能对付警方的【取证软件】；  为啥俺强调【迅速】？——警方想要拘捕你，当然不会留给你从容的时间。比如说：当警方人员正在撞门的时候，留给你的时间可能连1分钟都不到。        ◇“销毁”的含义 
  本章节所说的“销毁”是指——让任何人【包括你自己】再也无法得到加密盘里面的数据。        ◇为啥“哄骗”不可行？ 
  本文发出后，某些热心读者提到了“哄骗”的招数。简单说就是：你假装销毁，但其实并没有。这样做，将来你自己还能继续打开加密盘。  俺认为：这种方法【不够】可靠， 
   甚至是危险的想法
   。理由如下：  如果你是警方的重点关注对象，或者你是重大案件的关键人物，警方肯定会动用【刑侦和审讯】方面的高手来参与办案。  在这种情况下，你【别想】太容易哄骗对方。除非你自己也受过【严格的】“反侦查和反审讯”方面的训练。  但试问：有几个人具备这个条件？  基于上述理由——只有当你在紧急情况下，无法彻底销毁敏感数据，再考虑“哄骗”的招数。        ◇【错误】方式举例 
  首先来说说【反面】教材。所谓“错误的方式”指的是——【不够彻底】或者【不够快速】的方式。   
   错误方式1
   ——用“普通的删除命令”删除加密盘里面的文件  （所谓的“普通删除命令”，比如：Linux 下的 
   rm
   命令，Windows 下的 
   del
   命令）  首先，这种做法【不】彻底（会被“取证软件”恢复出来）；其次，如果加密盘中的文件很多，这种做法太慢。   
   错误方式2
   ——用“专门的【擦除】命令”彻底删除加密盘里面的文件  （所谓的“专门的擦除命令”，比如 linux 下的 
   shred
   命令）  这种方式比较彻底，但是【慢】。如果文件很多，就非常慢。  （注：shred 支持【多轮反复擦除】，可以防范专业取证人员对机械硬盘的“剩磁分析”，但也导致其速度很慢。即使你把 shred 设置为“只擦除1轮”，速度还是慢）   
   错误方式3
   ——快速格式化  这种方式速度快，但是不彻底——被“快格”的分区，数据全都在。   
   错误方式4
   ——彻底格式化  这种方式算是比较彻底，可惜【太慢】了。如果格式化的分区有好几个 GB，你就慢慢等吧。        ◇【正确】方式——彻底删除 key files 
  关于这招，已经提到过多次了。不但本文提到，之前在多篇博文中也提到。  这种方式有两种实现——“软删除”和“硬删除”。  如果 key files 存储在 PC 的硬盘上，用软件方式（比如：shred 命令）彻底擦除内容。为了讨论方便，以下称之为：“软删除 key files”。  如果 key files 放在【外部】的存储介质（比如：U盘、MMC/SD 卡、...），你可以先把存储卡插到 PC 上，然后用软件干掉 key files（依然是“软删除”）；但你还可以用【物理方式】直接破坏存储介质（这种情况称为——“硬删除 key files”）。  由于 key files 都很小（通常小于 1MB），所以“软删除 key files”肯定是【既快速又彻底】。   提醒：“软删除”的【局限性】  如果是【机械硬盘】，“软删除”是 OK 的；但如果是【固态硬盘】，“软删除”【不】保险。原因请参见本文前面章节介绍的【损耗均衡技术】。  至于“硬删除”的方式  由于存在几种不同情况，后面俺用一个单独的章节来讨论。        ◇【正确】方式——破坏加密盘的【密钥存储区】 
  前面俺聊“密钥的存储”，已经提到——磁盘加密软件为了能打开加密的数据，必须把密钥（以【加密形式】）存储在某个地方。通常是存储在加密盘的【头部或尾部】。  当你输入认证因子（“密码”和“key files”），加密软件根据“认证因子”进行一系列数学运算，然后从密钥存储区中解密出【加密盘的密钥】。如果你的认证因子输错了，密钥就解不出，加密盘自然打不开。  所以，如果你用“随机数据”把加密卷的【头部和尾部】两者都覆盖，就足以【彻底破坏】整个加密盘。  密钥存储区通常很小（不到 1KB）。为了保险起见，咱们把覆盖范围扩大一千倍（从 1KB 变为 1MB），彻底覆盖加密盘最开头的 1MB 和最末尾的 1MB，肯定就能毁掉“密钥存储区”了。  再来看“速度”——哪怕老式的机械硬盘，对头尾各写入 1MB 的数据，也可以在1秒内完成。所以这招属于【既彻底又快速】。   提醒：本招数的【局限性】  如果是【机械硬盘】，可以用这招；但如果是【固态硬盘】，这招【不】保险。原因请参见刚才介绍的“损耗均衡技术”。        ◇【运行状态】下的权衡 
  （所谓的【运行状态】指的是——出现“紧急情况”时，你的 PC 处于【开机运行】，并且你正在操作它）  在这种情况下，显然【可以用】“破坏加密盘”的方式。  至于“删除 key files”是否可用，取决于你的 key files 存储放在哪里？  1. 如果你的 key files 存储在 PC 上，也可用“【软】删除 key files”的方式。  2. 如果你的 key files 位于【外部】存储介质（比如：U盘、MMC/SD 卡、...），并且这个存储介质【没有】插在电脑上，就应该用“【硬】删除 key files”的方式。        ◇【关机状态】下的权衡 
  当你的 PC 处于【关机状态】，一旦碰到紧急情况，你已经来不及开机并启动系统。所以，“破坏加密盘”显然不可行；同样的道理，此时“软删除 key files”也不可行。  因此，在【离线状态】下，你只有唯一的选项——“硬删除 key files”。        ◇结论 
  从上述两种状态的权衡，很自然就可以得出结论—— 
   key files 必须位于你【身边】的存储介质中
   。只有这样才能保证——你在【各种情况】下都能【快速且彻底】地销毁加密数据。  为了让大伙儿一目了然，放一个对照表：       
    
     
      
      
      
       运行状态，机械硬盘
      
      
       运行状态，固态硬盘
      
      
       关机状态
      
     
     
      
       【硬】删除 key files
      
      
       YES
      
      
       YES
      
      
       YES
      
     
     
      
       【软】删除 key files
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
     
      
       破坏加密盘的【密钥存储区】
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
    
    
        ★如何【物理破坏】存储卡？ 
  好，现在来谈“硬删除 key files”的方式——也就是“从物理上毁掉存储卡”。  （注：本章节所说的“存储卡”包括：U盘、SD卡、MMC卡...）  再次唠叨：这种“物理破坏”的方式比较粗鲁，是【紧急情况下】的无奈之举。如果你的时间比较从容，应该用前面提到的软件方式——删除敏感文件后，通过填充垃圾数据，塞满整张存储卡的剩余空间。        ◇U 盘的内部结构 
  为了方便讲解，从维基百科剽窃了一张照片，并附上相应的说明。         
    
1　插头  2　存储控制器  3　测试接点  4　【 
    闪存芯片
    】  5　石英振荡器  6　发光二极管（LED）  7　写入保护开关  8　预留给第二颗存储器芯片的空间    
       ◇物理摧毁的关键——破坏【闪存芯片】 
  对存储卡而言，除了【闪存芯片】，其它的都是浮云。  因为其它所有的部件全被毁掉，只要【闪存芯片】还完好，就可以通过专用的设备，读取出里面保存的数据。        ◇破坏“闪存芯片”——【彻底】的方式 
  关于这个话题，俺看过一些资料，以及网上的讨论。权衡下来，能够在“短时间”（1分钟内）物理破坏“闪存芯片”的方式，大致有两种：   
   电磁方式——微波炉
    把存储卡放入微波炉并启动。  这么干，不但能毁掉存储芯片，可能你的微波炉也会跟着报废。但在紧急情况下，一个微波炉又算得了什么？   
   机械方式——砸烂
    如果你身边有锤子、扳手（或诸如此类的工具），对准结构图当中那个“傻大黑粗”的家伙狠狠砸下去，砸烂为止。  由于“闪存芯片”比较硬，还可以考虑用某个尖锐的东西作为辅助（学过基础物理学的应该明白——这可以增加压强）。就比如说，把一个钉子架在“闪存芯片”上，然后再用锤子敲击钉子，更容易击穿芯片的外壳。  但如今现代化的家庭或办公室中，要想找一个钉子还真不太容易。那么，啥东西可以作为钉子的替代品捏？俺列几个替代品作为参考（欢迎大伙儿补充）      
螺丝刀（尤其是【小型的十字】螺丝刀）  瑞士军刀中某些尖锐的部件（如下图）    
       （某款瑞士军刀的示意图——几乎每种款式的瑞士军刀都带有尖锐的工具） 
       ◇破坏“闪存芯片”——【不太彻底】的方式 
  现在介绍【不】那么彻底的方式。也供高风险人士参考。  在紧急情况下，如果你身边没有微波炉也没有砸烂芯片的工具，还有一招是——用冲水马桶把存储卡冲掉。如今的存储卡都比较小，至少不会卡在马桶里。  但要强调的是——这招【不彻底】，因为存储卡浸泡在普通液体（只要不是强酸），即使长达几天时间，还是有可能恢复出数据。  如果你用了这招，那主动权就转到警方这边——考验他们是否愿意到粪坑里去找存储卡了。         ★预备和演习 
  如果你确实认为自己是【高风险人士】，本文讲述的这些东西，你【不要】光看看而已。要先做好准备工作，甚至来一次演习（彩排）。  否则真的到了紧急情况，你在慌乱之中很可能会出错。（这是本文最后的忠告）    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》  《  文件加密的扫盲介绍  》  《  扫盲文件完整性校验——关于散列值和数字签名  》  《  TrueCrypt 使用经验  》（系列）  《  扫盲 VeraCrypt——跨平台的 TrueCrypt 替代品  》  《  扫盲 dm-crypt——多功能 Linux 磁盘加密工具（兼容 TrueCrypt 和 VeraCrypt）  》  《  扫盲 Linux 逻辑卷管理（LVM）——兼谈 RAID 以及“磁盘加密工具的整合”  》  《  文件备份技巧：组合“虚拟加密盘”与“网盘”  》  《  如何保护隐私  》（系列）  《  如何防止黑客入侵  》（系列）  《  扫盲 Linux＆UNIX 命令行——从“电传打字机”聊到“shell 脚本编程”  》  《  扫盲操作系统虚拟机  》（系列）      
    

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html 
    
    
  
  
    
         
    
    
    
 
    
  

" class="ssk ssk-email"></a>
    <a href="http://pinterest.com/pin/create/link/?url=https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html" class="ssk ssk-pinterest"></a>
    <a href="https://www.tumblr.com/widgets/share/tool?canonicalUrl=https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html&title=如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧&caption=

      如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧  
  
    
      
    
  
  
春节假期结束啦，继续来谈信息安全的话题。  先顺便说俩事儿：  1. 虽然本文与上一篇博文的间隔超过两周，但俺上一次【网络活动】是2月7日（在回复读者评论）。所以，依然属于【正常静默】。不要担心俺 :)  2. 上一篇博文发出后，经几位热心读者提醒，俺又对“社会工程学”那个章节补充了几点内容。        ★引子 
  前不久正值【开博十周年】之际，俺写了一篇《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》。  今天这篇是对前一篇进行补充，主要谈—— 
   如何对付警方
   ？看到俺写这样的东西，公安系统的“网监部门”和“技侦部门”，肯定又不爽了 :)  
       
        ★本文讨论的范围 
  为了避免某些读者来抬杠，先声明一下本文讨论范围。        ◇面向【高风险政治人士】 
  和  前一篇博文  类似，这篇也是写给“高风险政治人士”（类似俺这种反党人士）的教程。  如果你有可能成为【警方】的重点关注目标，大概就可以算是“高风险”啦。  （注：此处的“警方”包括天朝的“公安部、国安部”或类似机构；也包括其它国家的类似机构）   当然啦，所有的技术都是【双刃剑】——都可能被滥用。某些在网络上干坏事的家伙，也会从本文中受益。关于这点，俺也很无奈 :(  但是，俺不会因为技术存在被滥用的可能性，就停止对技术的传播和普及。        ◇本文只讨论【个人电脑】，【不】讨论手机或平板 
  俺已经多次谈过【移动设备的危险性】。显然，“高危人士”就【不该】在手机上进行任何危险操作。  因此，本文不打算谈“手机的话题”，只讨论【个人电脑】（桌面 PC）。  （注：本文中所说的“PC”，既包括“台式机”，也包括“笔记本电脑”）        ◇本文主要介绍【通用】的方法论 
  为了叙述方便，在涉及“操作系统”时，俺会拿 Linux 来说事儿。用 Windows 或 Mac OS 的同学，请依样画葫芦。  为了叙述方便，在谈到“磁盘加密软件”时，俺会以 TC（TrueCrypt）/VC（VeraCrypt）来举例。但本文介绍的方法，也能适用于其它磁盘加密工具（前提是——要支持【key files】这种机制）。         ★本文的特色 
  网上已经有很多关于【磁盘加密】的教程。包括俺自己，也已经写了好多这类教程。  为了避免读者说俺炒冷饭，先说说本文的【特色】。        ◇本文会更多地讨论【物理安全】 
  关于其它层面的防御，在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中已经谈了很多。所以，本文会更多地讨论：PC 的【物理安全】。  与“网上的骇客”不同，警方不光能【物理接触】你的 PC，甚至可以没收你的 PC（拿回去做“数据取证分析”）。因此，当你面对警方的时候，【物理安全】很重要！  （由于主要讨论“物理安全”）在本文中，如果没有特别注明，关于【操作系统】的讨论，针对的是【物理系统】（Host OS）。        ◇本文会更多地讨论【紧急情况】的应对 
  警方不光可以把你的电子设备（电脑、手机）拿去做“数据取证分析”，还可以限制你的行动自由（拘捕/逮捕）。  所以本文会花一些篇幅讨论——如何应对【紧急情况】。也就是说，当你即将丧失行动自由【之前】，该做哪些操作，对你最有利。  请注意：在你被捕之前， 
   你对敏感数据销毁越彻底，警方就越拿你没办法（因此也就对你越有利）。
           ★警方如何【破解】加密盘？ 
  《孙子兵法》说【知己知彼 百战不殆】。你要防范对方，首先要知道对方有哪些招数。  关于“攻击者如何破解加密盘”这个话题，俺在5年前（2013）已经写了一篇：《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》。  虽然那篇是针对 TrueCrypt 加密盘，但其中提到的几种破解手段，对其它格式的加密盘（VeraCrypt，LUKS，BitLocker ......）也适用。  考虑到某些新读者没有看到那篇旧博文，俺把那篇中提到的几种破解手段再【简述】如下。        ◇利用“加密算法本身的漏洞”——基本上【不可能】 
  【成熟的】磁盘加密软件，使用的“对称加密算法”肯定也是【成熟】滴。  以 TC（TrueCrypt）/VC（VeraCrypt）为例，它支持的“对称加密算法”是“Rijndael（AES）、Twofish、Serpent”。  当年美国国家标准局（NIST）公开招标21世纪的新一代加密算法标准（叫“高级加密标准”，简称“AES”）；经过多次淘汰，有5个算法成为【最后一批】候选者，上述的3个算法也在这5个当中；最终是 Rijndael 正式被选中成为 AES（所以，现在所说的 AES 也就是指 Rijndael）。  由于这三个算法是历经淘汰的最后一批候选者，算法本身已经被世界各国的密码学专家仔细检查过啦，【几乎不可能】出现算法层面的漏洞。  引申阅读：在如下博文中介绍了磁盘加密常用的几种“对称加密算法”。  《  TrueCrypt 使用经验[1]：关于加密算法和加密盘的类型  》        ◇对密钥的穷举——基本上【不可能】 
  刚才说啦——成熟的磁盘加密软件，使用的加密算法肯定也是【成熟】滴。  既然如此，算法使用的密钥，其“密钥空间”肯定足够大。因此在足够长时间内（几代人），并考虑到摩尔定律带来的算力增长，都【不可能】对密钥进行穷举。  以 AES256 为例，其密钥有【256 比特】，所有可能的密钥数量是【2的256次方】。这个数有多大捏？      2^256 = 115792089237316195423570985008687907853269984665640564039457584007913129639936    
       ◇对【弱】密码/口令的【暴力猜解】——常见招数 
  这是最常见的手段，专门针对【弱密码】（weak password）。  由于本文要对付的是【警方】。他们比一般的骇客具备更多的资源。比方说，天朝的警方已经建立了专门用于“暴力猜解密码”的【服务器集群】，可以大大提升密码猜解的效率。普通骇客用“单机”无法暴力猜解的密码，有可能被警方搞定。   但是， 
   这招很好对付
   ——你只需要引入【key files】作为加密盘的“认证因素”，就可以让警方的暴力猜解变得【不可能】。  在《  TrueCrypt 使用经验[2]：关于加密盘的密码认证和 KeyFiles 认证  》一文中，俺已经谈过“key files”的“用途”和“注意事项”。关于“注意事项”，再说一次：  1. key files 要使用“二进制文件”，【不要】用“文本文件”  2. key files 最好是【随机生成】（TC 和 VC 自带了“随机生成 key file”的功能）  3. key files 的文件尺寸【至少64字节】  外行的读者可能会觉得“64字节”太小了。其实“64字节”的随机文件，已经足够对抗穷举。一个字节有8比特，64字节有512比特。因此，64字节的随机内容，其可能的数量是“2的512次方”——这已经大大超过刚才提到的“AES 256 密钥空间”了。  给大伙儿秀一下这个数有多大。      2^512 = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096    
  另外，像 TC/VC 这两款磁盘加密软件，最多只提取【每个】key file 开头的一兆字节（1MB）参与密钥生成。所以，随机生成的 key file，每个都【不必】超过 1MB。        ◇【窃取】加密盘的【密钥】——常见招数，本文的重点 
  前面提到的几种攻击手法，都比较好解决（容易防御）。比较难对付的是这招——“攻击者盗取密钥”。所以，对这招的防范是本文的重点内容之一。  下面，俺分多个章节，对这个话题进行展开。        ◇用【审讯】的方式获得“密码和 key files”——常见招数，本文重点 
  前面的“攻击手法”都属于【技术手段】。如果警方尝试了技术手段而不可得，那自然会采用【审讯】的方式。  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文，俺已经谈到了【如何对付审讯】（包括酷刑）。  原理很简单——如果你的加密盘采用了【随机生成】的 key files 作为“认证因子”。你只需要在“丧失行动自由（被捕）”之前【彻底销毁】key files；如此一来，连你自己都【不可能】打开加密盘。酷刑也就失去意义啦。  原理说起来蛮简单，但落实起来会涉及到很多细节。比如说：如何【既彻底又快速】地销毁 key files？下面单列一个章节来谈。         ★为啥加密盘的【密钥】如此关键？ 
       ◇【密钥】是啥玩意儿？ 
  （考虑到大部分读者基本不懂密码学，俺尽可能通俗地解释一下【密钥】是啥玩意儿）  密钥说白了就是一段数据，可以用来加密或者解密。磁盘加密软件用的算法都是“对称加密算法”。这种算法的特点是：“加密的密钥”和“解密的密钥”是【同一个】。假设你用“密钥 K”把一段“明文 P”变成“密文 C”，那么你同样可以用 K 把 C 变为 P。  除了“对称加密算法”，还有一类算法叫做“非对称加密算法”——“加密的密钥”和“解密的密钥”是【不同】滴。这类算法与本文无关，就不展开介绍啦。        ◇“密钥”（key）与“密码/口令”（password）有啥【区别】？ 
  很多不懂技术的网友经常混淆“密钥”和“密码”，其实这两者是【完全不同】滴：  1. 密钥（key）直接参与加密/解密运算滴。  2. 密码（password）【不】参与“加密/解密”运算，它的作用是保护“密钥”。        ◇为啥说密钥【很重要】？ 
  首先，  如果攻击者能通过某种方式【窃取】密钥（key），就可以直接用密钥（key）【解密】加密盘存储的数据。  也就是说——在【不知道】你的密码和 key files 的情况下，也能打开加密盘。  其次，  一旦创建了加密盘，其密钥就固定了。即使你修改了加密盘的“认证因子”（“密码”或“key files”），密钥依然【不变】。  
   一旦攻击者拿到某个加密盘的密钥，不论你如何修改密码，攻击者依然可以打开这个加密盘。
    综上所述，  
   “密钥”的重要性【超过】“密码”和“key files”
   。        ◇密钥如何【生成和存储】？ 
  （本小节谈【技术原理】。比较懒的同学，可以跳过这个小节。不影响后续阅读）  
   密钥的生成
    简单地说，是通过某种复杂的数学运算产生出来（密码学术语叫“密钥生成函数”）。在“密钥生成函数”的生成过程中会用到【哈希运算】和【多次迭代】。（注：“哈希运算”也叫“散列运算”，洋文叫“hash”，  这篇博文  有 hash 的扫盲）  如果你用图形界面的 TC 或 VC 创建一个新的加密盘，在创建过程中，软件会提示你：尽可能快速并随机地移动鼠标。这么干是通过你随机移动鼠标，让软件能收集到足够多的随机数据（足够的【熵值】）  为啥要搞如此复杂的数学方式来创造密钥捏？（通俗地说）要达到——为了让密钥尽可能随机，使得攻击者无法猜测密钥，也无法缩小密钥的分布范围。   
   密钥的存储
    加密盘的密钥，会以【加密】的形式存储在加密盘的“头部或尾部”。而你设置的“密码”或“key files”，就是用来加密密钥的。  所以，当你要打开加密盘时，如果输错了“密码”或“key files”，加密盘的密钥解不出来，自然就打不开。         ★如何防止攻击者【窃取】密钥？ 
       ◇确保物理系统（Host OS）的【纯洁】 
  关于这点，无需多言。  如果你的物理系统本身已经中招（感染了恶意软件），那么，其它所有的防范措施皆是空中楼阁。  关于这个话题，可以参见之前的系列教程：  《  如何防止黑客入侵  》        ◇在电脑的 BIOS 设置“开机密码”和“硬盘锁密码” 
  这2点也是老调重弹了——俺刚在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》中已经提到过。  设置这两个密码，是为了防止攻击者（警方人员）在物理接触你的电脑之后，在（主引导扇区的）boot loader 中植入恶意软件，从而盗取你全盘加密的“密码或密钥”。  （注：在【不】依赖外部启动介质的情况下，主引导扇区是【不可能】加密滴。因为至少要有一个【明文】的程序，让你输入“全盘加密的”解锁密码，并执行解锁的动作）  从技术上讲，你也可以把 boot loader 放到某个外置的【可启动 U 盘】中，每次开机都先插入该 U 盘。但这么干太麻烦，而且会引来额外的风险。因为 U 盘没法像笔记本那样设置【硬盘锁】。警方的技侦人员如果能偷偷拿到你的这个启动 U 盘，同样可以植入恶意软件。        ◇【禁用】“虚拟内存” 
  现代操作系统都有“虚拟内存”的机制。对 Windows 而言，叫做“页交换文件”，对 Linux 而言就是“swap 分区”。  “虚拟内存”的作用在于——当物理内存比较紧张的时候，把一些不经常访问的“内存页”转储到硬盘，就可以腾出物理内存来存放新的内容。  一旦启用了“虚拟内存”，也就存在某种可能性——【敏感加密盘的密钥】有可能会残留在“虚拟内存”（也就是硬盘上）——显然，这增加了你的风险。   有些同学可能会问：既然已经“全盘加密”，不论是“swap 分区”还是“页交换文件”，都被加密了。为啥还要担心这个风险？  下面，俺来回答一下——   前一篇博文  之所以建议：在“全盘加密”的基础上再搞“敏感加密盘”，就是因为这两个东西的【密级不同】——“敏感加密盘”的密级【更高】。  如果你在物理系统（Host OS）中启用了“虚拟内存”，你就把“敏感加密盘”的安全等级【降低到】与“全盘加密”一样的水平。换句话说，一旦攻击者能够突破全盘加密，也就【有可能】从“虚拟内存”中找到“敏感加密盘的密钥”，从而突破“敏感加密盘”。        ◇谈谈“关机、休眠、待机”三者的安全差异 
  在《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》一文中，俺提到：      
当你要【长时间】离开自己的电脑——应该【关机】（shutdown）；而【不要】“休眠”（hibernation）或“待机”（suspend，stand by）    
 现在来解释一下：   
   休眠（hibernation）
    所谓的“休眠”（hibernation），说白了就是把【整个物理内存】保存到硬盘中的“休眠文件”。 
   这非常危险！
   危险的原因参见“虚拟内存”那个小节的讨论。另外，如果你在【未卸载】“敏感加密盘”的情况下让系统休眠，那么“休眠文件”中【必定包含】“敏感加密盘”的【密钥】。   
   待机（suspend，stand by）
    如果你已经禁用了“虚拟内存”和“休眠功能”，仅仅是让系统“待机”，这种情况下，加密盘的密钥【不会】出现在硬盘上，但还是有风险——如果你在待机之前【没有】卸载加密盘，加密盘的密钥还在物理内存（RAM）中。  如今的 DRAM 内存条在断电后依然有【数据残留】。在你离开电脑的这段时间里，如果警方的技侦人员对（正在待机的）电脑进行【冷启动攻击】（洋文叫“cold boot attack”，维基百科的链接在“  这里  ”），可以直接拿到【内存条】中的数据，再从中分析出“加密盘密钥”。  （注：断电之后，内存条中的数据【不会】立即消失，会有一个残留时间。温度越低，残留时间越长。在正常的室温下，内存条的数据残留时间【不超过】10分钟）   引申阅读：  在2013年的旧博文，俺已经介绍了【冷启动攻击】的原理和手法。  《  TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施  》  “冷启动攻击”这个手法已经有10年以上的历史。很多笔记本厂商在硬件和 BIOS 方面做了一些防范措施。可惜的是：前几个月（2018年9月），国外安全研究人员曝光了“冷启动攻击”的新进展——可以突破所有主流 PC 厂商（与“待机”相关）的防御。  《  研究人员警告现代计算机都易受冷启动攻击 @ Solidot  》  《  New modification of the old cold boot attack leaves most systems vulnerable @ Ars Technica  》   
   关机（shutdown）
    既然“休眠”和“待机”都靠不住，你只剩下一个选择——【关机】。  前面提到——正常的室温下，内存条的数据残留时间【不超过】10分钟。也就是说，只要关机超过10分钟，就【不可能】进行“冷启动攻击”了——因为内存条中的数据全都消失了。   
   补充：锁定屏幕
    如果你仅仅是“锁定屏幕”，其风险情况与“待机”类似——你的 PC 会被【冷启动攻击】搞定。   
   补充：混合睡眠模式
    经热心读者提醒：Windows8 开始引入了【混合睡眠模式】。即使在“待机”状态下也会保存一部分内存到硬盘上。  因此，你应该彻底禁止“休眠功能”（具体参见微软官网的“  这个链接  ”）。        ◇禁用 FireWire DMA 
  “FireWire”是某种硬件接口规格（俗称“火线接口”，也叫“IEEE 1394 接口”）。这玩意儿支持 DMA（direct memory access）方式直接操作【物理内存】。所以攻击者如果能物理接触你的电脑，可以在你的电脑上插入某个特定 FireWire 设备，然后利用 DMA 的方式直接读取整个系统的内存。因此，这招也叫做“  DMA attack  ”  这种攻击方式不仅仅是理论上可行，前几年就已经有人搞了傻瓜化的“DMA 攻击工具”。  如果 BIOS 有 FireWire DMA 相关选项，应该禁掉；或者在操作系统层面禁用相关的功能（通过“重编译 Linux 内核”）。  由于这个方式也是针对【运行状态下】盗取内存。所以，【关机】可以对付这种攻击方式。         ★“机械硬盘”与“固态硬盘（闪存）”【删除数据】的差异——损耗均衡技术 
       ◇“损耗均衡技术”是啥玩意儿？ 
  为了介绍后面的章节，需要先扫盲一个小知识——损耗均衡技术（洋文叫“wear leveling”）。  考虑到本文的大部分读者不是 IT 硬件方面的专业人士，俺尽量通俗地扫盲一下。  所谓的“固态硬盘”（SSD），是以【闪存】作为永久性存储介质。平时咱们用的“U盘”也是以【闪存】作为介质。（为了打字省力，本文以下章节凡是提到“闪存介质”，就是指——“采用闪存作为存储介质”的各种东西的【总称】）  “闪存介质”相比“机械硬盘”的一大【缺点】是——写入次数的上限比较低。如果某个存储单元的数据反复更改（反复写入），达到上限后，这个存储单元就坏掉（变为“不可用”）。  “闪存介质”的厂商为了解决这个问题，采用了“损耗均衡技术”（详细介绍请看维基百科的“  这个链接  ”）。比如某个文件，原先存储在“a单元”，当你更改了文件内容并保存，新的内容就不在“a单元”了，而是把新内容存到一个用得最少的“b单元”。此时，“a单元”里面依然有该文件的【旧内容】。  请注意，这个技术是由【硬件层面】（闪存介质的控制器）实现的，对操作系统【不可见】。        ◇“损耗均衡技术”【不利于】彻底删除数据 
  聪明的读者，看完前一个小节，已经发现问题所在了。  很多时候，为了彻底删除文件，要用“垃圾数据（随机数据）”去覆盖文件的原有内容，从而让原有内容【不可恢复】。这个招数对“机械硬盘”是 OK 的，但对“闪存介质”就不灵了。因为“损耗均衡技术”使得你覆盖的内容存到的【别的】单元，根本【没达到】你想要的目的。  而且俺刚才也说了——“损耗均衡技术”是由硬件层面的存储控制器实现，对操作系统不可见。所以，用【软件方式】难以证明某个存储单元是否【真正被覆盖了】。        ◇对【闪存介质】，如何彻底删除文件？ 
  综上所述，要想在“闪存介质”中彻底删除文件，你需要换一种思路，大致如下：  1. 先简单删除该文件  2. 用垃圾数据（随机数据）填满该存储介质的剩余空间——要 100% 填满。  （这样才能确保——原先保存过敏感数据的单元，已经被垃圾数据覆盖掉）   注意事项：要填满的是【物理硬盘】的“剩余空间”，而不是【分区】的“剩余空间”。  举个例子：  假设你的固态硬盘有多个分区。敏感文件在“分区1”，你把敏感文件删除后，光填满“分区1”的剩余空间是【不够】滴。  正确做法是——你要把【所有】分区的剩余空间都填满，才能确保之前保存过敏感数据的单元，确实被垃圾数据覆盖掉了。        ◇闪存厂商提供的工具，是否可信/可靠？ 
  某些闪存介质的厂商会提供一些配套的工具/软件，据说可以提供【彻底删除】的功能。  对此，俺表示谨慎的怀疑。因为无法验证其效果。  所以，为了保险起见，还是老老实实去【填满剩余空间】吧。        ◇小结 
  正式因为“闪存介质”要彻底删除文件，如此之麻烦。所以那些看重隐私保护的同学，更加应该早早用上【全盘加密】。  一旦你在“闪存介质”上使用【全盘加密】，每一个物理存储单元中的数据都是【密文】——“损耗均衡技术”就不再是障碍啦。         ★如何【快速且彻底】销毁加密盘的数据？ 
       ◇为啥要强调“快速且彻底”？ 
  为啥俺强调【彻底】？——只有彻底地销毁数据，才能对付警方的【取证软件】；  为啥俺强调【迅速】？——警方想要拘捕你，当然不会留给你从容的时间。比如说：当警方人员正在撞门的时候，留给你的时间可能连1分钟都不到。        ◇“销毁”的含义 
  本章节所说的“销毁”是指——让任何人【包括你自己】再也无法得到加密盘里面的数据。        ◇为啥“哄骗”不可行？ 
  本文发出后，某些热心读者提到了“哄骗”的招数。简单说就是：你假装销毁，但其实并没有。这样做，将来你自己还能继续打开加密盘。  俺认为：这种方法【不够】可靠， 
   甚至是危险的想法
   。理由如下：  如果你是警方的重点关注对象，或者你是重大案件的关键人物，警方肯定会动用【刑侦和审讯】方面的高手来参与办案。  在这种情况下，你【别想】太容易哄骗对方。除非你自己也受过【严格的】“反侦查和反审讯”方面的训练。  但试问：有几个人具备这个条件？  基于上述理由——只有当你在紧急情况下，无法彻底销毁敏感数据，再考虑“哄骗”的招数。        ◇【错误】方式举例 
  首先来说说【反面】教材。所谓“错误的方式”指的是——【不够彻底】或者【不够快速】的方式。   
   错误方式1
   ——用“普通的删除命令”删除加密盘里面的文件  （所谓的“普通删除命令”，比如：Linux 下的 
   rm
   命令，Windows 下的 
   del
   命令）  首先，这种做法【不】彻底（会被“取证软件”恢复出来）；其次，如果加密盘中的文件很多，这种做法太慢。   
   错误方式2
   ——用“专门的【擦除】命令”彻底删除加密盘里面的文件  （所谓的“专门的擦除命令”，比如 linux 下的 
   shred
   命令）  这种方式比较彻底，但是【慢】。如果文件很多，就非常慢。  （注：shred 支持【多轮反复擦除】，可以防范专业取证人员对机械硬盘的“剩磁分析”，但也导致其速度很慢。即使你把 shred 设置为“只擦除1轮”，速度还是慢）   
   错误方式3
   ——快速格式化  这种方式速度快，但是不彻底——被“快格”的分区，数据全都在。   
   错误方式4
   ——彻底格式化  这种方式算是比较彻底，可惜【太慢】了。如果格式化的分区有好几个 GB，你就慢慢等吧。        ◇【正确】方式——彻底删除 key files 
  关于这招，已经提到过多次了。不但本文提到，之前在多篇博文中也提到。  这种方式有两种实现——“软删除”和“硬删除”。  如果 key files 存储在 PC 的硬盘上，用软件方式（比如：shred 命令）彻底擦除内容。为了讨论方便，以下称之为：“软删除 key files”。  如果 key files 放在【外部】的存储介质（比如：U盘、MMC/SD 卡、...），你可以先把存储卡插到 PC 上，然后用软件干掉 key files（依然是“软删除”）；但你还可以用【物理方式】直接破坏存储介质（这种情况称为——“硬删除 key files”）。  由于 key files 都很小（通常小于 1MB），所以“软删除 key files”肯定是【既快速又彻底】。   提醒：“软删除”的【局限性】  如果是【机械硬盘】，“软删除”是 OK 的；但如果是【固态硬盘】，“软删除”【不】保险。原因请参见本文前面章节介绍的【损耗均衡技术】。  至于“硬删除”的方式  由于存在几种不同情况，后面俺用一个单独的章节来讨论。        ◇【正确】方式——破坏加密盘的【密钥存储区】 
  前面俺聊“密钥的存储”，已经提到——磁盘加密软件为了能打开加密的数据，必须把密钥（以【加密形式】）存储在某个地方。通常是存储在加密盘的【头部或尾部】。  当你输入认证因子（“密码”和“key files”），加密软件根据“认证因子”进行一系列数学运算，然后从密钥存储区中解密出【加密盘的密钥】。如果你的认证因子输错了，密钥就解不出，加密盘自然打不开。  所以，如果你用“随机数据”把加密卷的【头部和尾部】两者都覆盖，就足以【彻底破坏】整个加密盘。  密钥存储区通常很小（不到 1KB）。为了保险起见，咱们把覆盖范围扩大一千倍（从 1KB 变为 1MB），彻底覆盖加密盘最开头的 1MB 和最末尾的 1MB，肯定就能毁掉“密钥存储区”了。  再来看“速度”——哪怕老式的机械硬盘，对头尾各写入 1MB 的数据，也可以在1秒内完成。所以这招属于【既彻底又快速】。   提醒：本招数的【局限性】  如果是【机械硬盘】，可以用这招；但如果是【固态硬盘】，这招【不】保险。原因请参见刚才介绍的“损耗均衡技术”。        ◇【运行状态】下的权衡 
  （所谓的【运行状态】指的是——出现“紧急情况”时，你的 PC 处于【开机运行】，并且你正在操作它）  在这种情况下，显然【可以用】“破坏加密盘”的方式。  至于“删除 key files”是否可用，取决于你的 key files 存储放在哪里？  1. 如果你的 key files 存储在 PC 上，也可用“【软】删除 key files”的方式。  2. 如果你的 key files 位于【外部】存储介质（比如：U盘、MMC/SD 卡、...），并且这个存储介质【没有】插在电脑上，就应该用“【硬】删除 key files”的方式。        ◇【关机状态】下的权衡 
  当你的 PC 处于【关机状态】，一旦碰到紧急情况，你已经来不及开机并启动系统。所以，“破坏加密盘”显然不可行；同样的道理，此时“软删除 key files”也不可行。  因此，在【离线状态】下，你只有唯一的选项——“硬删除 key files”。        ◇结论 
  从上述两种状态的权衡，很自然就可以得出结论—— 
   key files 必须位于你【身边】的存储介质中
   。只有这样才能保证——你在【各种情况】下都能【快速且彻底】地销毁加密数据。  为了让大伙儿一目了然，放一个对照表：       
    
     
      
      
      
       运行状态，机械硬盘
      
      
       运行状态，固态硬盘
      
      
       关机状态
      
     
     
      
       【硬】删除 key files
      
      
       YES
      
      
       YES
      
      
       YES
      
     
     
      
       【软】删除 key files
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
     
      
       破坏加密盘的【密钥存储区】
      
      
       YES
      
      
       不保险
      
      
       NO
      
     
    
    
        ★如何【物理破坏】存储卡？ 
  好，现在来谈“硬删除 key files”的方式——也就是“从物理上毁掉存储卡”。  （注：本章节所说的“存储卡”包括：U盘、SD卡、MMC卡...）  再次唠叨：这种“物理破坏”的方式比较粗鲁，是【紧急情况下】的无奈之举。如果你的时间比较从容，应该用前面提到的软件方式——删除敏感文件后，通过填充垃圾数据，塞满整张存储卡的剩余空间。        ◇U 盘的内部结构 
  为了方便讲解，从维基百科剽窃了一张照片，并附上相应的说明。         
    
1　插头  2　存储控制器  3　测试接点  4　【 
    闪存芯片
    】  5　石英振荡器  6　发光二极管（LED）  7　写入保护开关  8　预留给第二颗存储器芯片的空间    
       ◇物理摧毁的关键——破坏【闪存芯片】 
  对存储卡而言，除了【闪存芯片】，其它的都是浮云。  因为其它所有的部件全被毁掉，只要【闪存芯片】还完好，就可以通过专用的设备，读取出里面保存的数据。        ◇破坏“闪存芯片”——【彻底】的方式 
  关于这个话题，俺看过一些资料，以及网上的讨论。权衡下来，能够在“短时间”（1分钟内）物理破坏“闪存芯片”的方式，大致有两种：   
   电磁方式——微波炉
    把存储卡放入微波炉并启动。  这么干，不但能毁掉存储芯片，可能你的微波炉也会跟着报废。但在紧急情况下，一个微波炉又算得了什么？   
   机械方式——砸烂
    如果你身边有锤子、扳手（或诸如此类的工具），对准结构图当中那个“傻大黑粗”的家伙狠狠砸下去，砸烂为止。  由于“闪存芯片”比较硬，还可以考虑用某个尖锐的东西作为辅助（学过基础物理学的应该明白——这可以增加压强）。就比如说，把一个钉子架在“闪存芯片”上，然后再用锤子敲击钉子，更容易击穿芯片的外壳。  但如今现代化的家庭或办公室中，要想找一个钉子还真不太容易。那么，啥东西可以作为钉子的替代品捏？俺列几个替代品作为参考（欢迎大伙儿补充）      
螺丝刀（尤其是【小型的十字】螺丝刀）  瑞士军刀中某些尖锐的部件（如下图）    
       （某款瑞士军刀的示意图——几乎每种款式的瑞士军刀都带有尖锐的工具） 
       ◇破坏“闪存芯片”——【不太彻底】的方式 
  现在介绍【不】那么彻底的方式。也供高风险人士参考。  在紧急情况下，如果你身边没有微波炉也没有砸烂芯片的工具，还有一招是——用冲水马桶把存储卡冲掉。如今的存储卡都比较小，至少不会卡在马桶里。  但要强调的是——这招【不彻底】，因为存储卡浸泡在普通液体（只要不是强酸），即使长达几天时间，还是有可能恢复出数据。  如果你用了这招，那主动权就转到警方这边——考验他们是否愿意到粪坑里去找存储卡了。         ★预备和演习 
  如果你确实认为自己是【高风险人士】，本文讲述的这些东西，你【不要】光看看而已。要先做好准备工作，甚至来一次演习（彩排）。  否则真的到了紧急情况，你在慌乱之中很可能会出错。（这是本文最后的忠告）    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  为啥朝廷总抓不到俺——十年反党活动的安全经验汇总  》  《  文件加密的扫盲介绍  》  《  扫盲文件完整性校验——关于散列值和数字签名  》  《  TrueCrypt 使用经验  》（系列）  《  扫盲 VeraCrypt——跨平台的 TrueCrypt 替代品  》  《  扫盲 dm-crypt——多功能 Linux 磁盘加密工具（兼容 TrueCrypt 和 VeraCrypt）  》  《  扫盲 Linux 逻辑卷管理（LVM）——兼谈 RAID 以及“磁盘加密工具的整合”  》  《  文件备份技巧：组合“虚拟加密盘”与“网盘”  》  《  如何保护隐私  》（系列）  《  如何防止黑客入侵  》（系列）  《  扫盲 Linux＆UNIX 命令行——从“电传打字机”聊到“shell 脚本编程”  》  《  扫盲操作系统虚拟机  》（系列）      
    

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html 
    
    
  
  
    
         
    
    
    
 
    
  

&tags=觀點" class="ssk ssk-tumblr"></a>
    <a href="https://buffer.com/add?text=如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧&url=https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html" class="ssk ssk-buffer"></a>
</div>


    <div id="main" role="main" class="container">
      
  <!-- Html Elements for Search -->
  <ul id="results-container" class="searched" style="color: #2980B9;"></ul>

  <script src="/opinion/assets/js/simple-jekyll-search.min.js"></script>

  <!-- Configuration -->
  <script>
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/opinion/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a><time>{date}</time><a class="tag">{category}</a></li>',
    noResultsText: '没找到',
    limit: 100,
    fuzzy: false,
    exclude: ['Welcome']
  })

  </script>

      







  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
    


  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
    



<article class="post">
  <h1>如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧</h1>
  <!-- Look the author details up from the site config. -->
  

  <div>
    <span class="date">
      2019-02-14
    </span>

    <!-- Output author details if some exist. -->
    
      
    


    <ul class="tag">
      <li>
        <a href="https://nodebe4.github.io/opinion/categories/#编程随想">
          编程随想
        </a>
      </li>
    </ul>

    
        <span>
            <!-- Personal Info. -->
            <a href="https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html" style="font-size:14px;">原文</a>
        </span>
    

    <span style="float: right;" title="编程随想的其它文章">
      <a style="font-size: 14px;" rel="nofollow" href="#sametag" class="tags">#编程随想 的其它文章</a>
    </span>

  </div>

  <div class="entry">
    
    
    
    <div class="post hentry uncustomized-post-template">
<a name="573421185532363513">
 </a>   <h1 class="post-title entry-title" id="section"> <a href="https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html"> 如何用“磁盘加密”对抗警方的【取证软件】和【刑讯逼供】，兼谈数据删除技巧 </a> </h1>
  <div class="post-header">
    <div class="post-header-line-1">
      <div class="post-inner-index"></div>
    </div>
  </div>
  <div class="post-body entry-content">
春节假期结束啦，继续来谈信息安全的话题。 <br /> 先顺便说俩事儿： <br /> 1. 虽然本文与上一篇博文的间隔超过两周，但俺上一次【网络活动】是2月7日（在回复读者评论）。所以，依然属于【正常静默】。不要担心俺 :) <br /> 2. 上一篇博文发出后，经几位热心读者提醒，俺又对“社会工程学”那个章节补充了几点内容。 <br /> <br />     <h2 id="section-1"> ★引子 </h2>
 <br /> 前不久正值【开博十周年】之际，俺写了一篇《 <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 为啥朝廷总抓不到俺——十年反党活动的安全经验汇总 </a> 》。 <br /> 今天这篇是对前一篇进行补充，主要谈—— <b>
   如何对付警方
  </b> ？看到俺写这样的东西，公安系统的“网监部门”和“技侦部门”，肯定又不爽了 :) <br /> <a name="more">
  </a>     <!--program-think-->
 <br /> <br />     <h2 id="section-2"> ★本文讨论的范围 </h2>
 <br /> 为了避免某些读者来抬杠，先声明一下本文讨论范围。 <br /> <br />     <h3 id="section-3"> ◇面向【高风险政治人士】 </h3>
 <br /> 和 <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 前一篇博文 </a> 类似，这篇也是写给“高风险政治人士”（类似俺这种反党人士）的教程。 <br /> 如果你有可能成为【警方】的重点关注目标，大概就可以算是“高风险”啦。 <br /> （注：此处的“警方”包括天朝的“公安部、国安部”或类似机构；也包括其它国家的类似机构） <br /> <br /> 当然啦，所有的技术都是【双刃剑】——都可能被滥用。某些在网络上干坏事的家伙，也会从本文中受益。关于这点，俺也很无奈 :( <br /> 但是，俺不会因为技术存在被滥用的可能性，就停止对技术的传播和普及。 <br /> <br />     <h3 id="section-4"> ◇本文只讨论【个人电脑】，【不】讨论手机或平板 </h3>
 <br /> 俺已经多次谈过【移动设备的危险性】。显然，“高危人士”就【不该】在手机上进行任何危险操作。 <br /> 因此，本文不打算谈“手机的话题”，只讨论【个人电脑】（桌面 PC）。 <br /> （注：本文中所说的“PC”，既包括“台式机”，也包括“笔记本电脑”） <br /> <br />     <h3 id="section-5"> ◇本文主要介绍【通用】的方法论 </h3>
 <br /> 为了叙述方便，在涉及“操作系统”时，俺会拿 Linux 来说事儿。用 Windows 或 Mac OS 的同学，请依样画葫芦。 <br /> 为了叙述方便，在谈到“磁盘加密软件”时，俺会以 TC（TrueCrypt）/VC（VeraCrypt）来举例。但本文介绍的方法，也能适用于其它磁盘加密工具（前提是——要支持【key files】这种机制）。 <br /> <br /> <br />     <h2 id="section-6"> ★本文的特色 </h2>
 <br /> 网上已经有很多关于【磁盘加密】的教程。包括俺自己，也已经写了好多这类教程。 <br /> 为了避免读者说俺炒冷饭，先说说本文的【特色】。 <br /> <br />     <h3 id="section-7"> ◇本文会更多地讨论【物理安全】 </h3>
 <br /> 关于其它层面的防御，在《 <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 为啥朝廷总抓不到俺——十年反党活动的安全经验汇总 </a> 》一文中已经谈了很多。所以，本文会更多地讨论：PC 的【物理安全】。 <br /> 与“网上的骇客”不同，警方不光能【物理接触】你的 PC，甚至可以没收你的 PC（拿回去做“数据取证分析”）。因此，当你面对警方的时候，【物理安全】很重要！ <br /> （由于主要讨论“物理安全”）在本文中，如果没有特别注明，关于【操作系统】的讨论，针对的是【物理系统】（Host OS）。 <br /> <br />     <h3 id="section-8"> ◇本文会更多地讨论【紧急情况】的应对 </h3>
 <br /> 警方不光可以把你的电子设备（电脑、手机）拿去做“数据取证分析”，还可以限制你的行动自由（拘捕/逮捕）。 <br /> 所以本文会花一些篇幅讨论——如何应对【紧急情况】。也就是说，当你即将丧失行动自由【之前】，该做哪些操作，对你最有利。 <br /> 请注意：在你被捕之前， <b>
   你对敏感数据销毁越彻底，警方就越拿你没办法（因此也就对你越有利）。
  </b> <br /> <br /> <br />     <h2 id="section-9"> ★警方如何【破解】加密盘？ </h2>
 <br /> 《孙子兵法》说【知己知彼 百战不殆】。你要防范对方，首先要知道对方有哪些招数。 <br /> 关于“攻击者如何破解加密盘”这个话题，俺在5年前（2013）已经写了一篇：《 <a href="https://program-think.blogspot.com/2013/08/truecrypt-3.html"> TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施 </a> 》。 <br /> 虽然那篇是针对 TrueCrypt 加密盘，但其中提到的几种破解手段，对其它格式的加密盘（VeraCrypt，LUKS，BitLocker ......）也适用。 <br /> 考虑到某些新读者没有看到那篇旧博文，俺把那篇中提到的几种破解手段再【简述】如下。 <br /> <br />     <h3 id="section-10"> ◇利用“加密算法本身的漏洞”——基本上【不可能】 </h3>
 <br /> 【成熟的】磁盘加密软件，使用的“对称加密算法”肯定也是【成熟】滴。 <br /> 以 TC（TrueCrypt）/VC（VeraCrypt）为例，它支持的“对称加密算法”是“Rijndael（AES）、Twofish、Serpent”。 <br /> 当年美国国家标准局（NIST）公开招标21世纪的新一代加密算法标准（叫“高级加密标准”，简称“AES”）；经过多次淘汰，有5个算法成为【最后一批】候选者，上述的3个算法也在这5个当中；最终是 Rijndael 正式被选中成为 AES（所以，现在所说的 AES 也就是指 Rijndael）。 <br /> 由于这三个算法是历经淘汰的最后一批候选者，算法本身已经被世界各国的密码学专家仔细检查过啦，【几乎不可能】出现算法层面的漏洞。 <br /> 引申阅读：在如下博文中介绍了磁盘加密常用的几种“对称加密算法”。 <br /> 《 <a href="https://program-think.blogspot.com/2013/08/truecrypt-1.html"> TrueCrypt 使用经验[1]：关于加密算法和加密盘的类型 </a> 》 <br /> <br />     <h3 id="section-11"> ◇对密钥的穷举——基本上【不可能】 </h3>
 <br /> 刚才说啦——成熟的磁盘加密软件，使用的加密算法肯定也是【成熟】滴。 <br /> 既然如此，算法使用的密钥，其“密钥空间”肯定足够大。因此在足够长时间内（几代人），并考虑到摩尔定律带来的算力增长，都【不可能】对密钥进行穷举。 <br /> 以 AES256 为例，其密钥有【256 比特】，所有可能的密钥数量是【2的256次方】。这个数有多大捏？ <br />     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2^256 = 115792089237316195423570985008687907853269984665640564039457584007913129639936</code></pre></div>    </div>
 <br />     <h3 id="section-12"> ◇对【弱】密码/口令的【暴力猜解】——常见招数 </h3>
 <br /> 这是最常见的手段，专门针对【弱密码】（weak password）。 <br /> 由于本文要对付的是【警方】。他们比一般的骇客具备更多的资源。比方说，天朝的警方已经建立了专门用于“暴力猜解密码”的【服务器集群】，可以大大提升密码猜解的效率。普通骇客用“单机”无法暴力猜解的密码，有可能被警方搞定。 <br /> <br /> 但是， <b>
   这招很好对付
  </b> ——你只需要引入【key files】作为加密盘的“认证因素”，就可以让警方的暴力猜解变得【不可能】。 <br /> 在《 <a href="https://program-think.blogspot.com/2013/08/truecrypt-2.html"> TrueCrypt 使用经验[2]：关于加密盘的密码认证和 KeyFiles 认证 </a> 》一文中，俺已经谈过“key files”的“用途”和“注意事项”。关于“注意事项”，再说一次： <br /> 1. key files 要使用“二进制文件”，【不要】用“文本文件” <br /> 2. key files 最好是【随机生成】（TC 和 VC 自带了“随机生成 key file”的功能） <br /> 3. key files 的文件尺寸【至少64字节】 <br /> 外行的读者可能会觉得“64字节”太小了。其实“64字节”的随机文件，已经足够对抗穷举。一个字节有8比特，64字节有512比特。因此，64字节的随机内容，其可能的数量是“2的512次方”——这已经大大超过刚才提到的“AES 256 密钥空间”了。 <br /> 给大伙儿秀一下这个数有多大。 <br />     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2^512 = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096</code></pre></div>    </div>
 <br /> 另外，像 TC/VC 这两款磁盘加密软件，最多只提取【每个】key file 开头的一兆字节（1MB）参与密钥生成。所以，随机生成的 key file，每个都【不必】超过 1MB。 <br /> <br />     <h3 id="section-13"> ◇【窃取】加密盘的【密钥】——常见招数，本文的重点 </h3>
 <br /> 前面提到的几种攻击手法，都比较好解决（容易防御）。比较难对付的是这招——“攻击者盗取密钥”。所以，对这招的防范是本文的重点内容之一。 <br /> 下面，俺分多个章节，对这个话题进行展开。 <br /> <br />     <h3 id="key-files-"> ◇用【审讯】的方式获得“密码和 key files”——常见招数，本文重点 </h3>
 <br /> 前面的“攻击手法”都属于【技术手段】。如果警方尝试了技术手段而不可得，那自然会采用【审讯】的方式。 <br /> 在《 <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 为啥朝廷总抓不到俺——十年反党活动的安全经验汇总 </a> 》一文，俺已经谈到了【如何对付审讯】（包括酷刑）。 <br /> 原理很简单——如果你的加密盘采用了【随机生成】的 key files 作为“认证因子”。你只需要在“丧失行动自由（被捕）”之前【彻底销毁】key files；如此一来，连你自己都【不可能】打开加密盘。酷刑也就失去意义啦。 <br /> 原理说起来蛮简单，但落实起来会涉及到很多细节。比如说：如何【既彻底又快速】地销毁 key files？下面单列一个章节来谈。 <br /> <br /> <br />     <h2 id="section-14"> ★为啥加密盘的【密钥】如此关键？ </h2>
 <br />     <h3 id="section-15"> ◇【密钥】是啥玩意儿？ </h3>
 <br /> （考虑到大部分读者基本不懂密码学，俺尽可能通俗地解释一下【密钥】是啥玩意儿） <br /> 密钥说白了就是一段数据，可以用来加密或者解密。磁盘加密软件用的算法都是“对称加密算法”。这种算法的特点是：“加密的密钥”和“解密的密钥”是【同一个】。假设你用“密钥 K”把一段“明文 P”变成“密文 C”，那么你同样可以用 K 把 C 变为 P。 <br /> 除了“对称加密算法”，还有一类算法叫做“非对称加密算法”——“加密的密钥”和“解密的密钥”是【不同】滴。这类算法与本文无关，就不展开介绍啦。 <br /> <br />     <h3 id="keypassword-"> ◇“密钥”（key）与“密码/口令”（password）有啥【区别】？ </h3>
 <br /> 很多不懂技术的网友经常混淆“密钥”和“密码”，其实这两者是【完全不同】滴： <br /> 1. 密钥（key）直接参与加密/解密运算滴。 <br /> 2. 密码（password）【不】参与“加密/解密”运算，它的作用是保护“密钥”。 <br /> <br />     <h3 id="section-16"> ◇为啥说密钥【很重要】？ </h3>
 <br /> 首先， <br /> 如果攻击者能通过某种方式【窃取】密钥（key），就可以直接用密钥（key）【解密】加密盘存储的数据。 <br /> 也就是说——在【不知道】你的密码和 key files 的情况下，也能打开加密盘。 <br /> 其次， <br /> 一旦创建了加密盘，其密钥就固定了。即使你修改了加密盘的“认证因子”（“密码”或“key files”），密钥依然【不变】。 <br /> <b>
   一旦攻击者拿到某个加密盘的密钥，不论你如何修改密码，攻击者依然可以打开这个加密盘。
  </b> <br /> 综上所述， <br /> <b>
   “密钥”的重要性【超过】“密码”和“key files”
  </b> 。 <br /> <br />     <h3 id="section-17"> ◇密钥如何【生成和存储】？ </h3>
 <br /> （本小节谈【技术原理】。比较懒的同学，可以跳过这个小节。不影响后续阅读） <br /> <b>
   密钥的生成
  </b> <br /> 简单地说，是通过某种复杂的数学运算产生出来（密码学术语叫“密钥生成函数”）。在“密钥生成函数”的生成过程中会用到【哈希运算】和【多次迭代】。（注：“哈希运算”也叫“散列运算”，洋文叫“hash”， <a href="https://program-think.blogspot.com/2013/02/file-integrity-check.html"> 这篇博文 </a> 有 hash 的扫盲） <br /> 如果你用图形界面的 TC 或 VC 创建一个新的加密盘，在创建过程中，软件会提示你：尽可能快速并随机地移动鼠标。这么干是通过你随机移动鼠标，让软件能收集到足够多的随机数据（足够的【熵值】） <br /> 为啥要搞如此复杂的数学方式来创造密钥捏？（通俗地说）要达到——为了让密钥尽可能随机，使得攻击者无法猜测密钥，也无法缩小密钥的分布范围。 <br /> <br /> <b>
   密钥的存储
  </b> <br /> 加密盘的密钥，会以【加密】的形式存储在加密盘的“头部或尾部”。而你设置的“密码”或“key files”，就是用来加密密钥的。 <br /> 所以，当你要打开加密盘时，如果输错了“密码”或“key files”，加密盘的密钥解不出来，自然就打不开。 <br /> <br /> <br />     <h2 id="section-18"> ★如何防止攻击者【窃取】密钥？ </h2>
 <br />     <h3 id="host-os-"> ◇确保物理系统（Host OS）的【纯洁】 </h3>
 <br /> 关于这点，无需多言。 <br /> 如果你的物理系统本身已经中招（感染了恶意软件），那么，其它所有的防范措施皆是空中楼阁。 <br /> 关于这个话题，可以参见之前的系列教程： <br /> 《 <a href="https://program-think.blogspot.com/2010/06/howto-prevent-hacker-attack-0.html"> 如何防止黑客入侵 </a> 》 <br /> <br />     <h3 id="bios--"> ◇在电脑的 BIOS 设置“开机密码”和“硬盘锁密码” </h3>
 <br /> 这2点也是老调重弹了——俺刚在《 <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 为啥朝廷总抓不到俺——十年反党活动的安全经验汇总 </a> 》中已经提到过。 <br /> 设置这两个密码，是为了防止攻击者（警方人员）在物理接触你的电脑之后，在（主引导扇区的）boot loader 中植入恶意软件，从而盗取你全盘加密的“密码或密钥”。 <br /> （注：在【不】依赖外部启动介质的情况下，主引导扇区是【不可能】加密滴。因为至少要有一个【明文】的程序，让你输入“全盘加密的”解锁密码，并执行解锁的动作） <br /> 从技术上讲，你也可以把 boot loader 放到某个外置的【可启动 U 盘】中，每次开机都先插入该 U 盘。但这么干太麻烦，而且会引来额外的风险。因为 U 盘没法像笔记本那样设置【硬盘锁】。警方的技侦人员如果能偷偷拿到你的这个启动 U 盘，同样可以植入恶意软件。 <br /> <br />     <h3 id="section-19"> ◇【禁用】“虚拟内存” </h3>
 <br /> 现代操作系统都有“虚拟内存”的机制。对 Windows 而言，叫做“页交换文件”，对 Linux 而言就是“swap 分区”。 <br /> “虚拟内存”的作用在于——当物理内存比较紧张的时候，把一些不经常访问的“内存页”转储到硬盘，就可以腾出物理内存来存放新的内容。 <br /> 一旦启用了“虚拟内存”，也就存在某种可能性——【敏感加密盘的密钥】有可能会残留在“虚拟内存”（也就是硬盘上）——显然，这增加了你的风险。 <br /> <br /> 有些同学可能会问：既然已经“全盘加密”，不论是“swap 分区”还是“页交换文件”，都被加密了。为啥还要担心这个风险？ <br /> 下面，俺来回答一下—— <br /> <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 前一篇博文 </a> 之所以建议：在“全盘加密”的基础上再搞“敏感加密盘”，就是因为这两个东西的【密级不同】——“敏感加密盘”的密级【更高】。 <br /> 如果你在物理系统（Host OS）中启用了“虚拟内存”，你就把“敏感加密盘”的安全等级【降低到】与“全盘加密”一样的水平。换句话说，一旦攻击者能够突破全盘加密，也就【有可能】从“虚拟内存”中找到“敏感加密盘的密钥”，从而突破“敏感加密盘”。 <br /> <br />     <h3 id="section-20"> ◇谈谈“关机、休眠、待机”三者的安全差异 </h3>
 <br /> 在《 <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 为啥朝廷总抓不到俺——十年反党活动的安全经验汇总 </a> 》一文中，俺提到： <br />     <blockquote>
当你要【长时间】离开自己的电脑——应该【关机】（shutdown）；而【不要】“休眠”（hibernation）或“待机”（suspend，stand by）    </blockquote>
 现在来解释一下： <br /> <br /> <b>
   休眠（hibernation）
  </b> <br /> 所谓的“休眠”（hibernation），说白了就是把【整个物理内存】保存到硬盘中的“休眠文件”。 <b>
   这非常危险！
  </b> 危险的原因参见“虚拟内存”那个小节的讨论。另外，如果你在【未卸载】“敏感加密盘”的情况下让系统休眠，那么“休眠文件”中【必定包含】“敏感加密盘”的【密钥】。 <br /> <br /> <b>
   待机（suspend，stand by）
  </b> <br /> 如果你已经禁用了“虚拟内存”和“休眠功能”，仅仅是让系统“待机”，这种情况下，加密盘的密钥【不会】出现在硬盘上，但还是有风险——如果你在待机之前【没有】卸载加密盘，加密盘的密钥还在物理内存（RAM）中。 <br /> 如今的 DRAM 内存条在断电后依然有【数据残留】。在你离开电脑的这段时间里，如果警方的技侦人员对（正在待机的）电脑进行【冷启动攻击】（洋文叫“cold boot attack”，维基百科的链接在“ <a href="https://en.wikipedia.org/wiki/Cold_boot_attack" rel="nofollow" target="_blank"> 这里 </a> ”），可以直接拿到【内存条】中的数据，再从中分析出“加密盘密钥”。 <br /> （注：断电之后，内存条中的数据【不会】立即消失，会有一个残留时间。温度越低，残留时间越长。在正常的室温下，内存条的数据残留时间【不超过】10分钟） <br /> <br /> 引申阅读： <br /> 在2013年的旧博文，俺已经介绍了【冷启动攻击】的原理和手法。 <br /> 《 <a href="https://program-think.blogspot.com/2013/08/truecrypt-3.html"> TrueCrypt 使用经验[3]：关于加密盘的破解和防范措施 </a> 》 <br /> “冷启动攻击”这个手法已经有10年以上的历史。很多笔记本厂商在硬件和 BIOS 方面做了一些防范措施。可惜的是：前几个月（2018年9月），国外安全研究人员曝光了“冷启动攻击”的新进展——可以突破所有主流 PC 厂商（与“待机”相关）的防御。 <br /> 《 <a href="https://www.solidot.org/story?sid=57941" rel="nofollow" target="_blank"> 研究人员警告现代计算机都易受冷启动攻击 @ Solidot </a> 》 <br /> 《 <a href="https://arstechnica.com/gadgets/2018/09/cold-boot-attacks-given-new-life-with-firmware-attack/" rel="nofollow" target="_blank"> New modification of the old cold boot attack leaves most systems vulnerable @ Ars Technica </a> 》 <br /> <br /> <b>
   关机（shutdown）
  </b> <br /> 既然“休眠”和“待机”都靠不住，你只剩下一个选择——【关机】。 <br /> 前面提到——正常的室温下，内存条的数据残留时间【不超过】10分钟。也就是说，只要关机超过10分钟，就【不可能】进行“冷启动攻击”了——因为内存条中的数据全都消失了。 <br /> <br /> <b>
   补充：锁定屏幕
  </b> <br /> 如果你仅仅是“锁定屏幕”，其风险情况与“待机”类似——你的 PC 会被【冷启动攻击】搞定。 <br /> <br /> <b>
   补充：混合睡眠模式
  </b> <br /> 经热心读者提醒：Windows8 开始引入了【混合睡眠模式】。即使在“待机”状态下也会保存一部分内存到硬盘上。 <br /> 因此，你应该彻底禁止“休眠功能”（具体参见微软官网的“ <a href="https://support.microsoft.com/help/920730/" rel="nofollow" target="_blank"> 这个链接 </a> ”）。 <br /> <br />     <h3 id="firewire-dma-"> ◇禁用 FireWire DMA </h3>
 <br /> “FireWire”是某种硬件接口规格（俗称“火线接口”，也叫“IEEE 1394 接口”）。这玩意儿支持 DMA（direct memory access）方式直接操作【物理内存】。所以攻击者如果能物理接触你的电脑，可以在你的电脑上插入某个特定 FireWire 设备，然后利用 DMA 的方式直接读取整个系统的内存。因此，这招也叫做“ <a href="https://en.wikipedia.org/wiki/DMA_attack" rel="nofollow" target="_blank"> DMA attack </a> ” <br /> 这种攻击方式不仅仅是理论上可行，前几年就已经有人搞了傻瓜化的“DMA 攻击工具”。 <br /> 如果 BIOS 有 FireWire DMA 相关选项，应该禁掉；或者在操作系统层面禁用相关的功能（通过“重编译 Linux 内核”）。 <br /> 由于这个方式也是针对【运行状态下】盗取内存。所以，【关机】可以对付这种攻击方式。 <br /> <br /> <br />     <h2 id="section-21"> ★“机械硬盘”与“固态硬盘（闪存）”【删除数据】的差异——损耗均衡技术 </h2>
 <br />     <h3 id="section-22"> ◇“损耗均衡技术”是啥玩意儿？ </h3>
 <br /> 为了介绍后面的章节，需要先扫盲一个小知识——损耗均衡技术（洋文叫“wear leveling”）。 <br /> 考虑到本文的大部分读者不是 IT 硬件方面的专业人士，俺尽量通俗地扫盲一下。 <br /> 所谓的“固态硬盘”（SSD），是以【闪存】作为永久性存储介质。平时咱们用的“U盘”也是以【闪存】作为介质。（为了打字省力，本文以下章节凡是提到“闪存介质”，就是指——“采用闪存作为存储介质”的各种东西的【总称】） <br /> “闪存介质”相比“机械硬盘”的一大【缺点】是——写入次数的上限比较低。如果某个存储单元的数据反复更改（反复写入），达到上限后，这个存储单元就坏掉（变为“不可用”）。 <br /> “闪存介质”的厂商为了解决这个问题，采用了“损耗均衡技术”（详细介绍请看维基百科的“ <a href="https://en.wikipedia.org/wiki/Wear_leveling" rel="nofollow" target="_blank"> 这个链接 </a> ”）。比如某个文件，原先存储在“a单元”，当你更改了文件内容并保存，新的内容就不在“a单元”了，而是把新内容存到一个用得最少的“b单元”。此时，“a单元”里面依然有该文件的【旧内容】。 <br /> 请注意，这个技术是由【硬件层面】（闪存介质的控制器）实现的，对操作系统【不可见】。 <br /> <br />     <h3 id="section-23"> ◇“损耗均衡技术”【不利于】彻底删除数据 </h3>
 <br /> 聪明的读者，看完前一个小节，已经发现问题所在了。 <br /> 很多时候，为了彻底删除文件，要用“垃圾数据（随机数据）”去覆盖文件的原有内容，从而让原有内容【不可恢复】。这个招数对“机械硬盘”是 OK 的，但对“闪存介质”就不灵了。因为“损耗均衡技术”使得你覆盖的内容存到的【别的】单元，根本【没达到】你想要的目的。 <br /> 而且俺刚才也说了——“损耗均衡技术”是由硬件层面的存储控制器实现，对操作系统不可见。所以，用【软件方式】难以证明某个存储单元是否【真正被覆盖了】。 <br /> <br />     <h3 id="section-24"> ◇对【闪存介质】，如何彻底删除文件？ </h3>
 <br /> 综上所述，要想在“闪存介质”中彻底删除文件，你需要换一种思路，大致如下： <br /> 1. 先简单删除该文件 <br /> 2. 用垃圾数据（随机数据）填满该存储介质的剩余空间——要 100% 填满。 <br /> （这样才能确保——原先保存过敏感数据的单元，已经被垃圾数据覆盖掉） <br /> <br /> 注意事项：要填满的是【物理硬盘】的“剩余空间”，而不是【分区】的“剩余空间”。 <br /> 举个例子： <br /> 假设你的固态硬盘有多个分区。敏感文件在“分区1”，你把敏感文件删除后，光填满“分区1”的剩余空间是【不够】滴。 <br /> 正确做法是——你要把【所有】分区的剩余空间都填满，才能确保之前保存过敏感数据的单元，确实被垃圾数据覆盖掉了。 <br /> <br />     <h3 id="section-25"> ◇闪存厂商提供的工具，是否可信/可靠？ </h3>
 <br /> 某些闪存介质的厂商会提供一些配套的工具/软件，据说可以提供【彻底删除】的功能。 <br /> 对此，俺表示谨慎的怀疑。因为无法验证其效果。 <br /> 所以，为了保险起见，还是老老实实去【填满剩余空间】吧。 <br /> <br />     <h3 id="section-26"> ◇小结 </h3>
 <br /> 正式因为“闪存介质”要彻底删除文件，如此之麻烦。所以那些看重隐私保护的同学，更加应该早早用上【全盘加密】。 <br /> 一旦你在“闪存介质”上使用【全盘加密】，每一个物理存储单元中的数据都是【密文】——“损耗均衡技术”就不再是障碍啦。 <br /> <br /> <br />     <h2 id="section-27"> ★如何【快速且彻底】销毁加密盘的数据？ </h2>
 <br />     <h3 id="section-28"> ◇为啥要强调“快速且彻底”？ </h3>
 <br /> 为啥俺强调【彻底】？——只有彻底地销毁数据，才能对付警方的【取证软件】； <br /> 为啥俺强调【迅速】？——警方想要拘捕你，当然不会留给你从容的时间。比如说：当警方人员正在撞门的时候，留给你的时间可能连1分钟都不到。 <br /> <br />     <h3 id="section-29"> ◇“销毁”的含义 </h3>
 <br /> 本章节所说的“销毁”是指——让任何人【包括你自己】再也无法得到加密盘里面的数据。 <br /> <br />     <h3 id="section-30"> ◇为啥“哄骗”不可行？ </h3>
 <br /> 本文发出后，某些热心读者提到了“哄骗”的招数。简单说就是：你假装销毁，但其实并没有。这样做，将来你自己还能继续打开加密盘。 <br /> 俺认为：这种方法【不够】可靠， <b>
   甚至是危险的想法
  </b> 。理由如下： <br /> 如果你是警方的重点关注对象，或者你是重大案件的关键人物，警方肯定会动用【刑侦和审讯】方面的高手来参与办案。 <br /> 在这种情况下，你【别想】太容易哄骗对方。除非你自己也受过【严格的】“反侦查和反审讯”方面的训练。 <br /> 但试问：有几个人具备这个条件？ <br /> 基于上述理由——只有当你在紧急情况下，无法彻底销毁敏感数据，再考虑“哄骗”的招数。 <br /> <br />     <h3 id="section-31"> ◇【错误】方式举例 </h3>
 <br /> 首先来说说【反面】教材。所谓“错误的方式”指的是——【不够彻底】或者【不够快速】的方式。 <br /> <br /> <b>
   错误方式1
  </b> ——用“普通的删除命令”删除加密盘里面的文件 <br /> （所谓的“普通删除命令”，比如：Linux 下的 <code class="language-plaintext highlighter-rouge">
   rm
  </code> 命令，Windows 下的 <code class="language-plaintext highlighter-rouge">
   del
  </code> 命令） <br /> 首先，这种做法【不】彻底（会被“取证软件”恢复出来）；其次，如果加密盘中的文件很多，这种做法太慢。 <br /> <br /> <b>
   错误方式2
  </b> ——用“专门的【擦除】命令”彻底删除加密盘里面的文件 <br /> （所谓的“专门的擦除命令”，比如 linux 下的 <code class="language-plaintext highlighter-rouge">
   shred
  </code> 命令） <br /> 这种方式比较彻底，但是【慢】。如果文件很多，就非常慢。 <br /> （注：shred 支持【多轮反复擦除】，可以防范专业取证人员对机械硬盘的“剩磁分析”，但也导致其速度很慢。即使你把 shred 设置为“只擦除1轮”，速度还是慢） <br /> <br /> <b>
   错误方式3
  </b> ——快速格式化 <br /> 这种方式速度快，但是不彻底——被“快格”的分区，数据全都在。 <br /> <br /> <b>
   错误方式4
  </b> ——彻底格式化 <br /> 这种方式算是比较彻底，可惜【太慢】了。如果格式化的分区有好几个 GB，你就慢慢等吧。 <br /> <br />     <h3 id="key-files--1"> ◇【正确】方式——彻底删除 key files </h3>
 <br /> 关于这招，已经提到过多次了。不但本文提到，之前在多篇博文中也提到。 <br /> 这种方式有两种实现——“软删除”和“硬删除”。 <br /> 如果 key files 存储在 PC 的硬盘上，用软件方式（比如：shred 命令）彻底擦除内容。为了讨论方便，以下称之为：“软删除 key files”。 <br /> 如果 key files 放在【外部】的存储介质（比如：U盘、MMC/SD 卡、...），你可以先把存储卡插到 PC 上，然后用软件干掉 key files（依然是“软删除”）；但你还可以用【物理方式】直接破坏存储介质（这种情况称为——“硬删除 key files”）。 <br /> 由于 key files 都很小（通常小于 1MB），所以“软删除 key files”肯定是【既快速又彻底】。 <br /> <br /> 提醒：“软删除”的【局限性】 <br /> 如果是【机械硬盘】，“软删除”是 OK 的；但如果是【固态硬盘】，“软删除”【不】保险。原因请参见本文前面章节介绍的【损耗均衡技术】。 <br /> 至于“硬删除”的方式 <br /> 由于存在几种不同情况，后面俺用一个单独的章节来讨论。 <br /> <br />     <h3 id="section-32"> ◇【正确】方式——破坏加密盘的【密钥存储区】 </h3>
 <br /> 前面俺聊“密钥的存储”，已经提到——磁盘加密软件为了能打开加密的数据，必须把密钥（以【加密形式】）存储在某个地方。通常是存储在加密盘的【头部或尾部】。 <br /> 当你输入认证因子（“密码”和“key files”），加密软件根据“认证因子”进行一系列数学运算，然后从密钥存储区中解密出【加密盘的密钥】。如果你的认证因子输错了，密钥就解不出，加密盘自然打不开。 <br /> 所以，如果你用“随机数据”把加密卷的【头部和尾部】两者都覆盖，就足以【彻底破坏】整个加密盘。 <br /> 密钥存储区通常很小（不到 1KB）。为了保险起见，咱们把覆盖范围扩大一千倍（从 1KB 变为 1MB），彻底覆盖加密盘最开头的 1MB 和最末尾的 1MB，肯定就能毁掉“密钥存储区”了。 <br /> 再来看“速度”——哪怕老式的机械硬盘，对头尾各写入 1MB 的数据，也可以在1秒内完成。所以这招属于【既彻底又快速】。 <br /> <br /> 提醒：本招数的【局限性】 <br /> 如果是【机械硬盘】，可以用这招；但如果是【固态硬盘】，这招【不】保险。原因请参见刚才介绍的“损耗均衡技术”。 <br /> <br />     <h3 id="section-33"> ◇【运行状态】下的权衡 </h3>
 <br /> （所谓的【运行状态】指的是——出现“紧急情况”时，你的 PC 处于【开机运行】，并且你正在操作它） <br /> 在这种情况下，显然【可以用】“破坏加密盘”的方式。 <br /> 至于“删除 key files”是否可用，取决于你的 key files 存储放在哪里？ <br /> 1. 如果你的 key files 存储在 PC 上，也可用“【软】删除 key files”的方式。 <br /> 2. 如果你的 key files 位于【外部】存储介质（比如：U盘、MMC/SD 卡、...），并且这个存储介质【没有】插在电脑上，就应该用“【硬】删除 key files”的方式。 <br /> <br />     <h3 id="section-34"> ◇【关机状态】下的权衡 </h3>
 <br /> 当你的 PC 处于【关机状态】，一旦碰到紧急情况，你已经来不及开机并启动系统。所以，“破坏加密盘”显然不可行；同样的道理，此时“软删除 key files”也不可行。 <br /> 因此，在【离线状态】下，你只有唯一的选项——“硬删除 key files”。 <br /> <br />     <h3 id="section-35"> ◇结论 </h3>
 <br /> 从上述两种状态的权衡，很自然就可以得出结论—— <b>
   key files 必须位于你【身边】的存储介质中
  </b> 。只有这样才能保证——你在【各种情况】下都能【快速且彻底】地销毁加密数据。 <br /> 为了让大伙儿一目了然，放一个对照表： <br />     <center> <table align="center" border="1" cellpadding="3" cellspacing="0">
    <tbody>
     <tr style="background:lightgrey;">
      <th>
      </th>
      <th>
       运行状态，机械硬盘
      </th>
      <th>
       运行状态，固态硬盘
      </th>
      <th>
       关机状态
      </th>
     </tr>
     <tr>
      <td>
       【硬】删除 key files
      </td>
      <td>
       YES
      </td>
      <td>
       YES
      </td>
      <td>
       YES
      </td>
     </tr>
     <tr>
      <td>
       【软】删除 key files
      </td>
      <td>
       YES
      </td>
      <td>
       不保险
      </td>
      <td>
       NO
      </td>
     </tr>
     <tr>
      <td>
       破坏加密盘的【密钥存储区】
      </td>
      <td>
       YES
      </td>
      <td>
       不保险
      </td>
      <td>
       NO
      </td>
     </tr>
    </tbody>
   </table> </center>
 <br /> <br />     <h2 id="section-36"> ★如何【物理破坏】存储卡？ </h2>
 <br /> 好，现在来谈“硬删除 key files”的方式——也就是“从物理上毁掉存储卡”。 <br /> （注：本章节所说的“存储卡”包括：U盘、SD卡、MMC卡...） <br /> 再次唠叨：这种“物理破坏”的方式比较粗鲁，是【紧急情况下】的无奈之举。如果你的时间比较从容，应该用前面提到的软件方式——删除敏感文件后，通过填充垃圾数据，塞满整张存储卡的剩余空间。 <br /> <br />     <h3 id="u--"> ◇U 盘的内部结构 </h3>
 <br /> 为了方便讲解，从维基百科剽窃了一张照片，并附上相应的说明。 <br /> <br />     <center> <img alt="不见图 请翻墙" src="https://lh6.googleusercontent.com/N4fHnlQpbhyGEmKlYa8xWL9bkfEYVF9X-SKmnlWNP7rVGathJK2O4WuCki6lxV6YLHDdK9ZKluwy3HhaWQML_e3FMbrcFlgSRW3lsr9rXCpabURK8tWjqKP-LWRtBB_5eBfZjCt4c3w" /> </center>
    <blockquote>
1　插头 <br /> 2　存储控制器 <br /> 3　测试接点 <br /> 4　【 <b>
    闪存芯片
   </b> 】 <br /> 5　石英振荡器 <br /> 6　发光二极管（LED） <br /> 7　写入保护开关 <br /> 8　预留给第二颗存储器芯片的空间    </blockquote>
 <br />     <h3 id="section-37"> ◇物理摧毁的关键——破坏【闪存芯片】 </h3>
 <br /> 对存储卡而言，除了【闪存芯片】，其它的都是浮云。 <br /> 因为其它所有的部件全被毁掉，只要【闪存芯片】还完好，就可以通过专用的设备，读取出里面保存的数据。 <br /> <br />     <h3 id="section-38"> ◇破坏“闪存芯片”——【彻底】的方式 </h3>
 <br /> 关于这个话题，俺看过一些资料，以及网上的讨论。权衡下来，能够在“短时间”（1分钟内）物理破坏“闪存芯片”的方式，大致有两种： <br /> <br /> <b>
   电磁方式——微波炉
  </b> <br /> 把存储卡放入微波炉并启动。 <br /> 这么干，不但能毁掉存储芯片，可能你的微波炉也会跟着报废。但在紧急情况下，一个微波炉又算得了什么？ <br /> <br /> <b>
   机械方式——砸烂
  </b> <br /> 如果你身边有锤子、扳手（或诸如此类的工具），对准结构图当中那个“傻大黑粗”的家伙狠狠砸下去，砸烂为止。 <br /> 由于“闪存芯片”比较硬，还可以考虑用某个尖锐的东西作为辅助（学过基础物理学的应该明白——这可以增加压强）。就比如说，把一个钉子架在“闪存芯片”上，然后再用锤子敲击钉子，更容易击穿芯片的外壳。 <br /> 但如今现代化的家庭或办公室中，要想找一个钉子还真不太容易。那么，啥东西可以作为钉子的替代品捏？俺列几个替代品作为参考（欢迎大伙儿补充） <br />     <blockquote>
螺丝刀（尤其是【小型的十字】螺丝刀） <br /> 瑞士军刀中某些尖锐的部件（如下图）    </blockquote>
    <center> <img alt="不见图 请翻墙" src="https://lh3.googleusercontent.com/vnY5rjSiZnNrArD0tAhApwMbteDe1EOz9IUaWr0mnFvz7XGHUa5rg9aQumGjssgk3jCpQn10t6c-9UgNXUsJRCrWr9Fgqk5TJ45JnYKI0Bv2l8DnQdV0lq9pLAlIrfNFwT6ogbBbR4o" /> <br /> （某款瑞士军刀的示意图——几乎每种款式的瑞士军刀都带有尖锐的工具） </center>
 <br />     <h3 id="section-39"> ◇破坏“闪存芯片”——【不太彻底】的方式 </h3>
 <br /> 现在介绍【不】那么彻底的方式。也供高风险人士参考。 <br /> 在紧急情况下，如果你身边没有微波炉也没有砸烂芯片的工具，还有一招是——用冲水马桶把存储卡冲掉。如今的存储卡都比较小，至少不会卡在马桶里。 <br /> 但要强调的是——这招【不彻底】，因为存储卡浸泡在普通液体（只要不是强酸），即使长达几天时间，还是有可能恢复出数据。 <br /> 如果你用了这招，那主动权就转到警方这边——考验他们是否愿意到粪坑里去找存储卡了。 <br /> <br /> <br />     <h2 id="section-40"> ★预备和演习 </h2>
 <br /> 如果你确实认为自己是【高风险人士】，本文讲述的这些东西，你【不要】光看看而已。要先做好准备工作，甚至来一次演习（彩排）。 <br /> 否则真的到了紧急情况，你在慌乱之中很可能会出错。（这是本文最后的忠告） <br /> <br /> <br /> <b>
   俺博客上，和本文相关的帖子（需翻墙）
  </b> ： <br /> 《 <a href="https://program-think.blogspot.com/2019/01/Security-Guide-for-Political-Activists.html"> 为啥朝廷总抓不到俺——十年反党活动的安全经验汇总 </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2011/05/file-encryption-overview.html"> 文件加密的扫盲介绍 </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2013/02/file-integrity-check.html"> 扫盲文件完整性校验——关于散列值和数字签名 </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2011/05/recommend-truecrypt.html#index"> TrueCrypt 使用经验 </a> 》（系列） <br /> 《 <a href="https://program-think.blogspot.com/2015/10/VeraCrypt.html"> 扫盲 VeraCrypt——跨平台的 TrueCrypt 替代品 </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2015/10/dm-crypt-cryptsetup.html"> 扫盲 dm-crypt——多功能 Linux 磁盘加密工具（兼容 TrueCrypt 和 VeraCrypt） </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2020/06/Linux-Logical-Volume-Manager.html"> 扫盲 Linux 逻辑卷管理（LVM）——兼谈 RAID 以及“磁盘加密工具的整合” </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2013/07/online-backup-virtual-encrypted-disk.html"> 文件备份技巧：组合“虚拟加密盘”与“网盘” </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2013/06/privacy-protection-0.html"> 如何保护隐私 </a> 》（系列） <br /> 《 <a href="https://program-think.blogspot.com/2010/06/howto-prevent-hacker-attack-0.html"> 如何防止黑客入侵 </a> 》（系列） <br /> 《 <a href="https://program-think.blogspot.com/2019/11/POSIX-TUI-from-TTY-to-Shell-Programming.html"> 扫盲 Linux＆UNIX 命令行——从“电传打字机”聊到“shell 脚本编程” </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2012/10/system-vm-0.html"> 扫盲操作系统虚拟机 </a> 》（系列） <br />     <!--BANNED
[1550248584253,1550276465989,1550276968774,1550277886309,1550278351032,1550739652865]
-->
    <div class="post-copyright">
<b>
    版权声明
   </b> <br /> 本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者 <a href="mailto:program.think@gmail.com"> 编程随想 </a> 和本文原始地址： <br /> <a href="https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html" id="OriginalPostUrl"> https://program-think.blogspot.com/2019/02/Use-Disk-Encryption-Anti-Computer-Forensics.html </a>
    </div>
    <div style="clear: both;"></div>
  </div>
  <div class="post-footer" style="margin-bottom:50px;">
    <div class="post-footer-line post-footer-line-1" style="display:none;">
<span class="post-author vcard"> </span> <span class="reaction-buttons"> </span> <span class="star-ratings"> </span> <span class="post-icons"> </span> <span class="post-backlinks post-comment-link"> </span>
    </div>
    <div class="post-footer-line post-footer-line-2 post-toolbar"></div>
    <div class="post-footer-line post-footer-line-3">
<span class="post-location"> </span>
    </div>
  </div>
</div>


  </div>

  <hr style="border-top:1px solid #28323C;"/>

<font size=2px>
  文章版权归原作者所有。
</font>

<div style="text-align:center"><img width="1px" src="https://i.imgur.com/HSw56Ez.png" alt="二维码分享本站" style="text-align:center"/></div>

  <div id="sametag">
    <h4 style="display: inline-block;">#编程随想 的其它文章</h4>
    <span>--<a href="https://nodebe4.github.io/opinion/2021-05-09/%E5%88%86%E4%BA%AB%E5%90%84%E7%B1%BB%E7%94%B5%E5%AD%90%E4%B9%A6-%E6%94%BF%E6%B2%BB-IT-%E7%A7%91%E6%99%AE-%E5%8E%86%E5%8F%B2-%E7%AD%89-97%E6%9C%AC/">最新</a>-</span>
    <span>-<a href="https://nodebe4.github.io/opinion/2009-01-15/%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%BC%A0%E5%8F%8A%E6%9C%AC%E5%8D%9A%E5%AE%A2%E5%86%85%E5%AE%B9%E7%AE%80%E4%BB%8B/">最早</a>--</span>
    
      <li>
        <time>2019-03-10</time>
        <a href="https://nodebe4.github.io/opinion/2019-03-10/%E6%BE%84%E6%B8%85-%E8%87%AA%E7%94%B1%E8%BD%AF%E4%BB%B6-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6-%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E8%AE%B8%E5%8F%AF%E8%AF%81%E7%9A%84%E8%AF%AF%E8%A7%A3/">
          澄清“自由软件、开源软件”相关概念及许可证的误解
        </a>
      </li>
    
    
      <li>
        <time>2019-02-25</time>
        <a href="https://nodebe4.github.io/opinion/2019-02-25/%E5%88%86%E4%BA%AB%E5%90%84%E7%B1%BB%E7%94%B5%E5%AD%90%E4%B9%A6-%E6%94%BF%E6%B2%BB-%E5%93%B2%E5%AD%A6-%E7%AD%89-63%E6%9C%AC/">
          分享各类电子书（政治、哲学 等，63本）
        </a>
      </li>
    
    
      <li>
        <time>2019-01-30</time>
        <a href="https://nodebe4.github.io/opinion/2019-01-30/%E4%B8%BA%E5%95%A5%E6%9C%9D%E5%BB%B7%E6%80%BB%E6%8A%93%E4%B8%8D%E5%88%B0%E4%BF%BA-%E5%8D%81%E5%B9%B4%E5%8F%8D%E5%85%9A%E6%B4%BB%E5%8A%A8%E7%9A%84%E5%AE%89%E5%85%A8%E7%BB%8F%E9%AA%8C%E6%B1%87%E6%80%BB/">
          为啥朝廷总抓不到俺——十年反党活动的安全经验汇总
        </a>
      </li>
    
    
      <li>
        <time>2019-01-15</time>
        <a href="https://nodebe4.github.io/opinion/2019-01-15/%E5%BC%80%E5%8D%9A%E5%8D%81%E5%91%A8%E5%B9%B4%E5%BA%86-%E5%8D%9A%E6%96%87%E5%88%86%E7%B1%BB%E6%B1%87%E6%80%BB/">
          开博十周年庆，博文分类汇总
        </a>
      </li>
    
  </div>


  <hr>
  <div class="pagination">
    
      <span class="prev" >
          <a href="https://nodebe4.github.io/opinion/2019-02-14/%E8%BE%BE%E8%B5%96%E5%96%87%E5%98%9B-%E4%B8%AD%E5%85%B1%E5%AE%98%E5%91%98%E6%AE%8B%E6%9A%B4%E9%9D%9E%E5%A4%A9%E6%80%A7%E8%80%8C%E6%98%AF%E8%99%9A%E5%81%87%E4%BF%A1%E6%81%AF%E6%B4%97%E8%84%91%E6%89%80%E8%87%B4/">
            前一篇：达赖喇嘛：中共官员残暴非天性而是虚假信息洗脑所致
          </a>
      </span>
    
    
      <span class="next" >
          <a href="https://nodebe4.github.io/opinion/2019-02-15/%E6%92%A4%E5%8E%BF%E8%AE%BE%E5%8C%BA-%E8%BF%98%E6%98%AF-%E7%9C%81%E7%9B%B4%E7%AE%A1%E5%8E%BF/">
            後一篇：撤县设区”还是“省直管县”？
          </a>
      </span>
    

    <script>
    /* post pagination keyboard shortcuts */
    document.body.onkeyup = function(e){
      if (e.keyCode == '37') { window.location = 'https://nodebe4.github.io/opinion/2019-02-14/%E8%BE%BE%E8%B5%96%E5%96%87%E5%98%9B-%E4%B8%AD%E5%85%B1%E5%AE%98%E5%91%98%E6%AE%8B%E6%9A%B4%E9%9D%9E%E5%A4%A9%E6%80%A7%E8%80%8C%E6%98%AF%E8%99%9A%E5%81%87%E4%BF%A1%E6%81%AF%E6%B4%97%E8%84%91%E6%89%80%E8%87%B4/'; } // left arrow key
      if (e.keyCode == '39') { window.location = 'https://nodebe4.github.io/opinion/2019-02-15/%E6%92%A4%E5%8E%BF%E8%AE%BE%E5%8C%BA-%E8%BF%98%E6%98%AF-%E7%9C%81%E7%9B%B4%E7%AE%A1%E5%8E%BF/'; } // right arrow key
      if (e.keyCode == '45') { window.location = 'https://nodebe4.github.io/opinion/2019-02-25/%E5%88%86%E4%BA%AB%E5%90%84%E7%B1%BB%E7%94%B5%E5%AD%90%E4%B9%A6-%E6%94%BF%E6%B2%BB-%E5%93%B2%E5%AD%A6-%E7%AD%89-63%E6%9C%AC/'; } // insert key
      if (e.keyCode == '46') { window.location = 'https://nodebe4.github.io/opinion/2019-01-30/%E4%B8%BA%E5%95%A5%E6%9C%9D%E5%BB%B7%E6%80%BB%E6%8A%93%E4%B8%8D%E5%88%B0%E4%BF%BA-%E5%8D%81%E5%B9%B4%E5%8F%8D%E5%85%9A%E6%B4%BB%E5%8A%A8%E7%9A%84%E5%AE%89%E5%85%A8%E7%BB%8F%E9%AA%8C%E6%B1%87%E6%80%BB/'; } // delete key
    };
    </script>
    <link rel="stylesheet" type="text/css" href="/opinion/assets/css/fab.css" />

<div class="fab-wrapper">
  <div class="fab-wheel">
    
    
    
    <a class="fab-action fab-action-1" title="上一篇(热键 &#8594;)" href="https://nodebe4.github.io/opinion/2019-02-14/%E8%BE%BE%E8%B5%96%E5%96%87%E5%98%9B-%E4%B8%AD%E5%85%B1%E5%AE%98%E5%91%98%E6%AE%8B%E6%9A%B4%E9%9D%9E%E5%A4%A9%E6%80%A7%E8%80%8C%E6%98%AF%E8%99%9A%E5%81%87%E4%BF%A1%E6%81%AF%E6%B4%97%E8%84%91%E6%89%80%E8%87%B4/">
      <i>后</i>
    </a>
    
    
    <a class="fab-action fab-action-2" title="下一篇(热键 &#8592;)" href="https://nodebe4.github.io/opinion/2019-02-15/%E6%92%A4%E5%8E%BF%E8%AE%BE%E5%8C%BA-%E8%BF%98%E6%98%AF-%E7%9C%81%E7%9B%B4%E7%AE%A1%E5%8E%BF/">
      <i>前</i>
    </a>
    
    
    <a class="fab-action fab-action-3" title="<编程随想>上一篇(热键 ins)" href="https://nodebe4.github.io/opinion/2019-02-25/%E5%88%86%E4%BA%AB%E5%90%84%E7%B1%BB%E7%94%B5%E5%AD%90%E4%B9%A6-%E6%94%BF%E6%B2%BB-%E5%93%B2%E5%AD%A6-%E7%AD%89-63%E6%9C%AC/">
      <i>左</i>
    </a>
    
    
    <a class="fab-action fab-action-4" title="<编程随想>下一篇(热键 del)" href="https://nodebe4.github.io/opinion/2019-01-30/%E4%B8%BA%E5%95%A5%E6%9C%9D%E5%BB%B7%E6%80%BB%E6%8A%93%E4%B8%8D%E5%88%B0%E4%BF%BA-%E5%8D%81%E5%B9%B4%E5%8F%8D%E5%85%9A%E6%B4%BB%E5%8A%A8%E7%9A%84%E5%AE%89%E5%85%A8%E7%BB%8F%E9%AA%8C%E6%B1%87%E6%80%BB/">
      <i>右</i>
    </a>
    
  </div>
</div>


  </div>


  

</article>

    </div>

    <div style="z-index:2;">
<script src="/opinion/assets/js/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 56,
  cornerOffset: 20, // px
  id: 'back-to-top',
  backgroundColor: '#ddd',
  textColor: 'red'
})</script>
</div>


    <div class="wrapper-footer" id="footer">
      <div class="container">
        <footer class="footer">
          <img width="200px" src="https://i.imgur.com/HSw56Ez.png" alt="二维码分享本站"/>
<font size=2px>二维码分享本站</font>

<!-- Refer to https://codepen.io/ruandre/pen/howFi -->
<ul class="svg-icon">

  

  

  
  <li><a href="mailto:beauti4@protonmail.com" class="icon-8 email" title="Email"><svg viewBox="0 0 512 512"><path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://github.com/NodeBE4/opinion" class="icon-13 github" title="GitHub"><svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li>
  

  

  

  

  

  
  <li><a href="/opinion/feed.xml" class="icon-21 rss" title="RSS"><svg viewBox="0 0 512 512"><path d="M201.8 347.2c0 20.3-16.5 36.8-36.8 36.8 -20.3 0-36.8-16.5-36.8-36.8s16.5-36.8 36.8-36.8C185.3 310.4 201.8 326.8 201.8 347.2zM128.2 204.7v54.5c68.5 0.7 124 56.3 124.7 124.7h54.5C306.7 285.3 226.9 205.4 128.2 204.7zM128.2 166.6c57.9 0.3 112.3 22.9 153.2 63.9 41 41 63.7 95.5 63.9 153.5h54.5c-0.3-149.9-121.7-271.4-271.6-271.9V166.6L128.2 166.6z"/></svg><!--[if lt IE 9]><em>RSS</em><![endif]--></a></li>
  

  

  

  

  

    
</ul>





<p><span style="color:blue">内容每小时更新一次.</span> Powered by <a href="https://github.com/AWEEKJ/kiko-now">Kiko Now</a> & <a href="https://github.com/gitalk/gitalk">Gitalk</a> & <a href="https://github.com/duty-machine/news">duty-machine</a>, 站务 <a href="https://be4.herokuapp.com">NodeBE4</a>（<span style="color:red">被墙</span>）</p>





        </footer>
      </div>
    </div>

    



  </body>
</html>
