<!DOCTYPE html>
<html>
  <head>
  <title>对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS – 觀點 – 從草根到大師 git.io/JJCxS</title>

      <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="

      对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS  
  
    
      
    
  
  
      
       ★引子 
  俺在写前一篇博文（也就是  Firefox PK Chrome 那篇  ）的时候，碰巧看到 Mozilla 官方博客提到说：目前最新的 Firefox 62 版本开始支持【DNS over HTTPS】这一特性（链接在“  这里  ”）。  本来想顺便聊一下“DNS over HTTPS”这个玩意儿。但是查了一下，发现它的 RFC 目前还只是【草案】，尚未正式发布。  所以俺就把本文的主题改成——对比4种强化 DNS 安全的网络协议（顺便也普及一些信息安全知识）。  
       
        ★传统的 DNS 有啥问题？ 
  传统的 DNS 是一个【比较古老】的协议。最早的草案可以追溯到1983年。1987年定稿之后，基本上没啥变化。算起来，它的年龄比俺博客的很多读者都要大。  设计 DNS 的时候，互联网基本上还是个玩具。那年头的互联网协议，压根儿都没考虑安全性，DNS 当然也不例外。所以 DNS 的交互过程全都是【明文】滴，既无法做到“保密性”，也无法实现“完整性”。  缺乏“保密性”就意味着——任何一个能【监视】你上网流量的人，都可以【看到】你查询了哪些域名。直接引发的问题就是隐私风险。  缺乏“完整性”就意味着——任何一个能【修改】你上网流量的人，都可以【篡改】你的查询结果。直接引发的问题就是“DNS 欺骗”（也叫“DNS 污染”或“DNS 缓存投毒”）  关于“域名欺骗/域名污染”，可以参见俺的另一篇博文《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》（注：4年前的那篇博文，不光讲了“域名欺骗”，还扫盲了 DNS 的基本原理）   为了解决传统 DNS 的这些弊端，后来诞生了好几个网络协议，以强化域名系统的安全性。俺今天挑选其中4个来介绍。除了这4个，其它一些协议的名气和影响力太小，不值一提。  下面俺以出场时间的先后，分别介绍这4个协议。         ★DNSSEC 
       ◇历史 
  这玩意儿是“Domain Name System Security Extensions”的缩写。在今天介绍的4个协议中，DNSSEC 是最早诞生的（1997）。从最先的  RFC 2065  进化为  RFC 2535  ，再到  RFC 4033  、  RFC 4034  、  RFC 4035  。  在今天介绍的4个协议中，DNSSEC 也是最早大规模部署的。在2010年的时候，所有  根域名服务器  都已经部署了 DNSSEC。到了2011年，若干顶级域名（.org 和 .com 和 .net 和 .edu）也部署了 DNSSEC。        ◇协议栈 
      --------
 DNSSEC
--------
  UDP
--------
  IP
--------    
       ◇安全性的原理 
  当初设计 DNSSEC 的一个考虑是“尽可能兼容 DNS 协议”。所以 DNSSEC 只是在 DNS 协议的基础上增加了一个【数字签名机制】。  有了数字签名，如果域名查询的结果被人篡改了，DNSSEC 客户端就可以通过【校验签名】，判断查询结果是假的。套用信息安全的行话——DNSSEC 实现了【完整性】（也叫“不可篡改性”）。  由于 DNSSEC 引入了【数字签名】，就需要有【公私钥对】。私钥是保密的，用来生成签名；公钥是公开的，用来验证签名。DNSSEC 客户端可以向 DNSSEC 服务器发出请求，获得一个 DNSKEY 记录，里面含公钥；然后用这个公钥校验每次的查询结果。        ◇信任链的实现 
  有些聪明的读者会问了：DESSEC 客户端在向服务器请求公钥的过程中，如果被攻击者篡改了，得到一个假的公钥，那该如何是好？  为了解决此问题，DNSSEC 体系要求【上级域】来担保。比如想要证明 program-think.blogspot.com 这个域名的公钥是否可信，就依靠 blogspot.com 这个域名的公钥来验证。通过层层追溯，最后达到【根域名服务器】。而“根域名服务器的公钥”是事先就部署在客户端的——这玩意儿就是整个信任链的根源，称之为“信任锚”（洋文叫“Trust Anchor”）。        ◇优点 
  在今天聊的4个协议中，DNSSEC 应该是最成熟的。除了前面提到的广泛部署，大多数公共的域名服务器也都支持它。维基百科上有一个对照表（链接在“  这里  ”），对比了有名气的几个公共域名服务系统。在今天聊的4个协议中，支持 DNSSEC 的最多。        ◇缺点 
  虽然 DNSSEC 最成熟，但它有个天生的缺陷——【没有】考虑到【保密性】。  DNSSEC 虽然对传输的数据做了数字签名，但是【没有】进行加密。这就意味着——任何能监视你网络流量的人，也可以看到你通过 DNSSEC 查询了哪些域名。 
   隐私风险大大滴！
    Chrome 曾经在 14 版本支持过 DNSSEC，后来又【移除】了；而 Firefox 官方从未支持过 DNSSEC 协议。俺猜测：大概就是这个缺点给闹的。         ★DNSCrypt 
       ◇历史 
  第2个出场的是 DNSCrypt。这个协议是由 Frank Denis 和 Yecheng Fu（付业成）两人设计的。  这个协议从来【没有】提交过 RFC（征求意见稿），要想看它的协议实现，只能去它的官网（链接在“  这里  ”）。  历史上有过两个版本，分别称：Version 1 和 Version 2。如今主要使用“版本2”        ◇协议栈 
      ----------------
    DNSCrypt
----------------
   TCP or UDP
----------------
       IP
----------------    
       ◇安全性的原理 
  前面俺提到 DNSSEC 协议强调兼容性。而 DNSCrypt 则完全是另起炉灶搞出来的协议。在这个协议中，域名的“查询请求”与“响应结果”都是加密的。这就是它比 DNSSEC 高级的地方。  换句话说，DNSCrypt 既能做到【完整性】，也能做到【保密性】；相比之下，DNSSEC 只能做到【完整性】。        ◇信任链的实现 
  DNSCrypt 的信任链比较简单——客户端要想使用哪个 DNSCrypt 服务器，就需要预先部署该服务器的公钥。  另外，DNSCrypt 还支持客户端认证（作为可选项）。如果需要的话，可以在服务器上部署客户端的公钥。此时，服务器只接受可信的客户端的查询请求。        ◇优点 
  如前所述，DNSCrypt 同时支持【完整性】与【保密性】。在隐私方面完胜 DNSSEC。  在下层协议方面，DNSCrypt 同时支持 TCP 和 UDP，显然比 DNSSEC 灵活（DNSSEC 只支持 UDP）。  顺便提醒一下：虽然 DNSCrypt 协议默认使用 443 这个端口号，但该协议与 HTTPS 毫无关系。        ◇缺点 
  （俺个人认为）DNSCrypt 最大的缺点就是前面提到的：【从未】提交过 RFC。没有 RFC 也就无法通过 IETF（互联网工程任务组）进行标准化。一个无法标准化的协议，其生命力要打很大的折扣。  另一个比较小的缺点是——虽然 DNSCrypt 协议是加密的，但可以被识别出来。换句话说：如果有人监控你的流量，可以识别出哪些流量属于 DNSCrypt 协议。为啥说这是个缺点捏？在本文末尾讨论 “DNSCrypt 与 TLS 的安全性对比” 的时候，会详细加以说明。  再来说说【公共 DNS 系统】。截至俺写本文时，Google 和 Cloudflare 的公共域名系统【尚未】支持 DNSCrypt（参见  这个页面  的对照表）。这也是一个缺点。         ★DNS over TLS 
  “DNS over TLS”有时也被简称为【DoT】。为了打字省力，本文以下部分用 DoT 来称呼之。        ◇历史 
  DoT 已经正式发布了 RFC（参见  RFC 7858  和  RFC 8310  ）。  从时间上看，RFC7858 是2016年发布的，RFC8310 是今年（2018）发布的；显然，这个协议出现得比较晚（相比前面提到的 DNSSEC 和 DNSCrypt）。        ◇协议栈 
      --------
  DoT
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over TLS 就是基于 TLS 隧道之上的域名协议。由于 TLS 本身已经实现了【保密性】与【完整性】，因此 DoT 自然也就具有这两项特性。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇信任链的实现 
  DoT 的信任链依赖于 TLS，而 TLS 的信任链靠的是 CA 证书体系。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  相比 DNSSEC，DoT 具备了【保密性】；相比 DNSCrypt，DoT 已经标准化。  另外，由于 DoT 协议是完全包裹在 TLS 里面，即使有人监视你的上网流量，也无法判断——哪些 TLS 流量是用于域名查询，哪些 TLS 用于网页传输。换句话说，DoT 协议的流量无法被【单独识别】出来。        ◇缺点 
  支持 DoT 的客户端还不够多。尤其是主流的浏览器还没有计划增加 DoT 的支持。         ★DNS over HTTPS 
  “DNS over HTTPS”有时也被简称为【DoH】。为了打字省力，本文以下部分用 DoH 来称呼之。        ◇历史 
  在今天介绍的4个协议中，DoH 是最新的（最晚出现的）。RFC 方面，它已经有了相应的草案，但还【没有】正式发布。截至俺写本文时，DoH 的草案已经发了 15 个版本（从 00 到 14），最新版的链接在“  这里  ”。  很多人把 DoH 与 DoT 混为一谈，实际上这是两种不同的协议。你可以对比这两者的协议栈，（只要你眼睛不瞎）就可看出其中的差别。        ◇协议栈 
      --------
  DoH
--------
  HTTP
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over HTTPS 就是基于 HTTPS 隧道之上的域名协议。而 HTTPS 又是“HTTP over TLS”。所以 DoH 相当于是【双重隧道】的协议。  与 DoT 类似，DoH 最终也是依靠 TLS 来实现了【保密性】与【完整性】。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇【信任链】的实现 
  DoH 类似于 DoT，最终是靠 TLS 所使用的“CA 证书体系”来实现信任链。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  基本上，DoT 具备的优点，DoH 也具备。  相比 DoT，DoH 还多了一个优点：  由于 DoH 是基于 HTTP 之上。而主流的编程语言都有成熟的 HTTP 协议封装库；再加上 HTTP 协议的使用本身很简单。因此，要想用各种主流编程语言开发一个 DoH 的客户端，是非常容易滴。        ◇缺点 
  如前所述，DoH 目前还只有 RFC 的草案，尚未正式发布。这算是一个缺点。  相比 DoT，DoH 还有一个小缺点——由于 DoH 比 DoT 多了一层（请对比两者的协议栈），所以在性能方面，DoH 会比 DoT 略差。为啥说这是个【小】缺点捏？因为域名的查询并【不】频繁，而且客户端软件可以很容易地对域名的查询结果进行【缓存】（以降低查询次数）。所以 DoH 比 DoT 性能略差，无伤大雅。         ★4种协议的综合对照表 
  为了给列位看官一个直观的印象，放一个综合的对照表。        
    
     
      
       协议类型
      
      
       标准化
      
      
       完整性
       
       （防篡改）
      
      
       保密性
       
       （防偷窥）
      
      
       抗协议识别
      
      
       主流的
       
       浏览器支持
      
      
       知名的
       
       公共服务器
      
     
     
      
       DNSSEC
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       无
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
     
      
       DNSCrypt
      
      
       无
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       OpenDNS
       
       Quad9
      
     
     
      
       DNS over TLS
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       无
      
      
       Cloudflare
       
       Quad9
      
     
     
      
       DNS over HTTPS
      
      
       进行中
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
    
    
        ★为啥 DNS over HTTPS 更有前途？——谈谈俺个人观点 
  接着来聊一下：4个协议中，谁的前景看好。（以下是俺个人观点，供参考）        ◇首先【排除】DNSSEC 
  如果要讨论这4种协议的优劣，首先出局的是 DNSSEC。因为这玩意儿连【保密性】都不具备，无法保护网民的隐私。  相比之下，另外三种协议都具备了“保密性”。        ◇DNSCrypt 与 TLS 的对比 
  DoT 与 DoH 这两个协议，本质上都是依赖 TLS 来保证安全性（完整性 及 保密性）。所以剩下三种协议的对比，实际上是 DNSCrypt 与 TLS 之间的 PK。  俺认为 TLS 具有如下几个优势：  
   优势1——关于“标准化”
    SSL/TLS 老早就已经标准化了，距今已超过20年。（关于 SSL/TLS 版本的演变历史，可以参见  这篇博文  ）  而 DNSCrypt 发布这么多年，连 RFC 都没有提交过——这玩意儿看来【没希望】成为互联网标准了。   
   优势2——关于“客户端部署”
    TLS 的公钥体系（CA 证书体系）早就已经普及。所有主流的操作系统都内置了一系列 CA 根证书。  相比之下，DNSCrypt 另起炉灶搞了一套公钥机制，只有它自己在用。  所以，在【部署客户端】的时候，DNSCrypt 会比 TLS 麻烦。虽然某些 DNSCrypt 的客户端已经内置了一些知名的公共服务器的公钥，但如果你要切换到另一个 DNSCrypt 服务器，并且该服务器的公钥没有内置在客户端里面，那你就需要手动部署。   
   优势3——关于“协议识别”
    这个话题前面已经谈过了。此处再重复唠叨一下。  如果网络流量被监控，监控者可以根据协议特征，把 DNSCrypt 识别出来；而 DoT 与 DoH，在流量外观上，与其它的 TLS 流量【毫无差异】。也就是说，监控流量的人，无法判断某个 TLS 流量是否属于 DoT 或 DoH。  以咱们天朝为例：  天朝的国际出口被 GFW 严密监视。如果 GFW 愿意的话，它完全可以根据协议特征，把 DNSCrypt 协议的流量识别出来并阻断掉。  再来看 TLS，该协议已经被广泛应用于 HTTPS，GFW 不可能把所有 TLS 流量都阻断；再加上 TLS 协议设计严密，GFW 无法判断 TLS 承载的【上层协议】是啥。所以，对于流经国际出口的 DoT 或 DoH，GFW 是判断不出来滴。   综上所述，TLS 完胜 DNSCrypt。所以，剩下的协议就只有 DoT 与 DoH。        ◇DoT VS DoH 
  前面谈 DoH 优缺点的时候，其实已经可以看出这两者谁更有前途了。  DoT 因为协议栈少了一层，性能会比 DoH 更好。但是俺前面也说了，域名查询的频度是比较低的，而且还可以利用客户端软件的 DNS 缓存，进一步减少域名查询的频度。所以 DoT 虽然性能更好，但优势不明显。   DoH 的强项体现在如下几方面：  
   1. 编程接口更简单
    （关于这点，前面提到过）这是个很重要的优势——有助于让更多软件切换到 DoH 之上。  
   2. 可以利用 HTTP 协议已有的特性
    由于 DoH 是基于 HTTPS 之上，可以无缝地支持 Proxy；  DoH 可以充分利用 HTTP 2.0 的特性（HTTP/2 在 HTTP/1.1 基础上加了很多功能）。   正是因为 DoH 的这些优势，浏览器厂商对 DoH 的支持更积极。对比一下就可以看出来——DoT 在两年前正式发布 RFC，主流的浏览器没一个支持；而 DoH 目前才仅仅是 RFC 草案，Firefox 与 Chrome/Chromium 都开始支持了。        ◇小结 
  经过层层淘汰，目前看下来最有前途的应该 DoH（DNS over HTTPS）。  DoH 未来的发展势头取决于如下几点：  1. 标准化的时间进度（看目前的架势，正式发布应该快到了）  2. 其它浏览器跟进的速度         ★对 DoH 的进一步讨论 
       ◇引申阅读 
  分享几篇 DoH 相关的文章：   《  A cartoon intro to DNS over HTTPS  》  （注：这是 Mozilla 官方博客的一篇文章，深入浅出地扫盲了 DNS 和 DoH 的原理）   《  The Benefits of HTTPS for DNS  》  （注：这是某个老外写的技术文章，讨论 DoH 可以借助 HTTP 协议的哪些好处）         ◇关于浏览器的说明 
  
   Firefox
    Firefox 从 62 版本开始支持 DoH，具体参见 Mozilla 官方博客（链接在“  这里  ”）。  由于 DoH 功能刚刚加入，还没有提供相应的配置界面。如果你想体验该功能，需要定制 Firefox 的配置选项（Preferences）以初始化 DoH 的相关参数。定制 Firefox 的方法参见博文：《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》   
   Chrome/Chromium
    Chrome/Chromium 从 66 版本开始支持 DoH。具体参见 Chromium 官网的 issue（链接在“  这里  ”）。   虽然 Firefox 和 Chrome/Chromium 都已经开始支持 DoH，但大伙儿别急着用。  按照历史经验，刚加入的新功能，可能还不够稳定，没准儿还存在未曝光的安全漏洞。多等几个版本之后再说。        ◇对翻墙的好处——无缝整合 
  常规的翻墙软件，无非就是“代理软件”与“VPN 软件”。  
   对于“VPN 软件”
    由于 VPN 具有【全局代理】的性质，DoH 当然可以无缝地整合到 VPN 翻墙中。  
   对于“代理软件”
    常见的代理软件，要么是 HTTP 代理，要么是 SOCKS 代理。只要这些代理能支持 HTTPS，也就天然地支持 DoH。  注：GAE 没有原生支持 HTTPS 代理。所以基于 GAE 的翻墙软件，就不能走 DoH 协议啦 :(        ◇相关的客户端工具 
  在 curl 官方的代码仓库，有一个  关于 DoH 的 wiki 页面  ，里面列出了一些 DoH 的客户端小工具。  喜欢折腾技术的同学，可以先去玩一玩。   因为 DoH 的标准还没有正式发布，关于它的讨论就到此为止。等到啥时候发布了，俺再专门发一篇 DoH 如何使用的博文。    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》  《  扫盲 HTTPS 和 SSL/TLS 协议  》（系列）  《  数字证书及 CA 的扫盲介绍  》  《  如何保护隐私  》（系列）  《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》     

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html 
    
    
  
  
    
         
    
    
    
 
    
  

" />
    <meta property="og:description" content="

      对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS  
  
    
      
    
  
  
      
       ★引子 
  俺在写前一篇博文（也就是  Firefox PK Chrome 那篇  ）的时候，碰巧看到 Mozilla 官方博客提到说：目前最新的 Firefox 62 版本开始支持【DNS over HTTPS】这一特性（链接在“  这里  ”）。  本来想顺便聊一下“DNS over HTTPS”这个玩意儿。但是查了一下，发现它的 RFC 目前还只是【草案】，尚未正式发布。  所以俺就把本文的主题改成——对比4种强化 DNS 安全的网络协议（顺便也普及一些信息安全知识）。  
       
        ★传统的 DNS 有啥问题？ 
  传统的 DNS 是一个【比较古老】的协议。最早的草案可以追溯到1983年。1987年定稿之后，基本上没啥变化。算起来，它的年龄比俺博客的很多读者都要大。  设计 DNS 的时候，互联网基本上还是个玩具。那年头的互联网协议，压根儿都没考虑安全性，DNS 当然也不例外。所以 DNS 的交互过程全都是【明文】滴，既无法做到“保密性”，也无法实现“完整性”。  缺乏“保密性”就意味着——任何一个能【监视】你上网流量的人，都可以【看到】你查询了哪些域名。直接引发的问题就是隐私风险。  缺乏“完整性”就意味着——任何一个能【修改】你上网流量的人，都可以【篡改】你的查询结果。直接引发的问题就是“DNS 欺骗”（也叫“DNS 污染”或“DNS 缓存投毒”）  关于“域名欺骗/域名污染”，可以参见俺的另一篇博文《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》（注：4年前的那篇博文，不光讲了“域名欺骗”，还扫盲了 DNS 的基本原理）   为了解决传统 DNS 的这些弊端，后来诞生了好几个网络协议，以强化域名系统的安全性。俺今天挑选其中4个来介绍。除了这4个，其它一些协议的名气和影响力太小，不值一提。  下面俺以出场时间的先后，分别介绍这4个协议。         ★DNSSEC 
       ◇历史 
  这玩意儿是“Domain Name System Security Extensions”的缩写。在今天介绍的4个协议中，DNSSEC 是最早诞生的（1997）。从最先的  RFC 2065  进化为  RFC 2535  ，再到  RFC 4033  、  RFC 4034  、  RFC 4035  。  在今天介绍的4个协议中，DNSSEC 也是最早大规模部署的。在2010年的时候，所有  根域名服务器  都已经部署了 DNSSEC。到了2011年，若干顶级域名（.org 和 .com 和 .net 和 .edu）也部署了 DNSSEC。        ◇协议栈 
      --------
 DNSSEC
--------
  UDP
--------
  IP
--------    
       ◇安全性的原理 
  当初设计 DNSSEC 的一个考虑是“尽可能兼容 DNS 协议”。所以 DNSSEC 只是在 DNS 协议的基础上增加了一个【数字签名机制】。  有了数字签名，如果域名查询的结果被人篡改了，DNSSEC 客户端就可以通过【校验签名】，判断查询结果是假的。套用信息安全的行话——DNSSEC 实现了【完整性】（也叫“不可篡改性”）。  由于 DNSSEC 引入了【数字签名】，就需要有【公私钥对】。私钥是保密的，用来生成签名；公钥是公开的，用来验证签名。DNSSEC 客户端可以向 DNSSEC 服务器发出请求，获得一个 DNSKEY 记录，里面含公钥；然后用这个公钥校验每次的查询结果。        ◇信任链的实现 
  有些聪明的读者会问了：DESSEC 客户端在向服务器请求公钥的过程中，如果被攻击者篡改了，得到一个假的公钥，那该如何是好？  为了解决此问题，DNSSEC 体系要求【上级域】来担保。比如想要证明 program-think.blogspot.com 这个域名的公钥是否可信，就依靠 blogspot.com 这个域名的公钥来验证。通过层层追溯，最后达到【根域名服务器】。而“根域名服务器的公钥”是事先就部署在客户端的——这玩意儿就是整个信任链的根源，称之为“信任锚”（洋文叫“Trust Anchor”）。        ◇优点 
  在今天聊的4个协议中，DNSSEC 应该是最成熟的。除了前面提到的广泛部署，大多数公共的域名服务器也都支持它。维基百科上有一个对照表（链接在“  这里  ”），对比了有名气的几个公共域名服务系统。在今天聊的4个协议中，支持 DNSSEC 的最多。        ◇缺点 
  虽然 DNSSEC 最成熟，但它有个天生的缺陷——【没有】考虑到【保密性】。  DNSSEC 虽然对传输的数据做了数字签名，但是【没有】进行加密。这就意味着——任何能监视你网络流量的人，也可以看到你通过 DNSSEC 查询了哪些域名。 
   隐私风险大大滴！
    Chrome 曾经在 14 版本支持过 DNSSEC，后来又【移除】了；而 Firefox 官方从未支持过 DNSSEC 协议。俺猜测：大概就是这个缺点给闹的。         ★DNSCrypt 
       ◇历史 
  第2个出场的是 DNSCrypt。这个协议是由 Frank Denis 和 Yecheng Fu（付业成）两人设计的。  这个协议从来【没有】提交过 RFC（征求意见稿），要想看它的协议实现，只能去它的官网（链接在“  这里  ”）。  历史上有过两个版本，分别称：Version 1 和 Version 2。如今主要使用“版本2”        ◇协议栈 
      ----------------
    DNSCrypt
----------------
   TCP or UDP
----------------
       IP
----------------    
       ◇安全性的原理 
  前面俺提到 DNSSEC 协议强调兼容性。而 DNSCrypt 则完全是另起炉灶搞出来的协议。在这个协议中，域名的“查询请求”与“响应结果”都是加密的。这就是它比 DNSSEC 高级的地方。  换句话说，DNSCrypt 既能做到【完整性】，也能做到【保密性】；相比之下，DNSSEC 只能做到【完整性】。        ◇信任链的实现 
  DNSCrypt 的信任链比较简单——客户端要想使用哪个 DNSCrypt 服务器，就需要预先部署该服务器的公钥。  另外，DNSCrypt 还支持客户端认证（作为可选项）。如果需要的话，可以在服务器上部署客户端的公钥。此时，服务器只接受可信的客户端的查询请求。        ◇优点 
  如前所述，DNSCrypt 同时支持【完整性】与【保密性】。在隐私方面完胜 DNSSEC。  在下层协议方面，DNSCrypt 同时支持 TCP 和 UDP，显然比 DNSSEC 灵活（DNSSEC 只支持 UDP）。  顺便提醒一下：虽然 DNSCrypt 协议默认使用 443 这个端口号，但该协议与 HTTPS 毫无关系。        ◇缺点 
  （俺个人认为）DNSCrypt 最大的缺点就是前面提到的：【从未】提交过 RFC。没有 RFC 也就无法通过 IETF（互联网工程任务组）进行标准化。一个无法标准化的协议，其生命力要打很大的折扣。  另一个比较小的缺点是——虽然 DNSCrypt 协议是加密的，但可以被识别出来。换句话说：如果有人监控你的流量，可以识别出哪些流量属于 DNSCrypt 协议。为啥说这是个缺点捏？在本文末尾讨论 “DNSCrypt 与 TLS 的安全性对比” 的时候，会详细加以说明。  再来说说【公共 DNS 系统】。截至俺写本文时，Google 和 Cloudflare 的公共域名系统【尚未】支持 DNSCrypt（参见  这个页面  的对照表）。这也是一个缺点。         ★DNS over TLS 
  “DNS over TLS”有时也被简称为【DoT】。为了打字省力，本文以下部分用 DoT 来称呼之。        ◇历史 
  DoT 已经正式发布了 RFC（参见  RFC 7858  和  RFC 8310  ）。  从时间上看，RFC7858 是2016年发布的，RFC8310 是今年（2018）发布的；显然，这个协议出现得比较晚（相比前面提到的 DNSSEC 和 DNSCrypt）。        ◇协议栈 
      --------
  DoT
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over TLS 就是基于 TLS 隧道之上的域名协议。由于 TLS 本身已经实现了【保密性】与【完整性】，因此 DoT 自然也就具有这两项特性。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇信任链的实现 
  DoT 的信任链依赖于 TLS，而 TLS 的信任链靠的是 CA 证书体系。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  相比 DNSSEC，DoT 具备了【保密性】；相比 DNSCrypt，DoT 已经标准化。  另外，由于 DoT 协议是完全包裹在 TLS 里面，即使有人监视你的上网流量，也无法判断——哪些 TLS 流量是用于域名查询，哪些 TLS 用于网页传输。换句话说，DoT 协议的流量无法被【单独识别】出来。        ◇缺点 
  支持 DoT 的客户端还不够多。尤其是主流的浏览器还没有计划增加 DoT 的支持。         ★DNS over HTTPS 
  “DNS over HTTPS”有时也被简称为【DoH】。为了打字省力，本文以下部分用 DoH 来称呼之。        ◇历史 
  在今天介绍的4个协议中，DoH 是最新的（最晚出现的）。RFC 方面，它已经有了相应的草案，但还【没有】正式发布。截至俺写本文时，DoH 的草案已经发了 15 个版本（从 00 到 14），最新版的链接在“  这里  ”。  很多人把 DoH 与 DoT 混为一谈，实际上这是两种不同的协议。你可以对比这两者的协议栈，（只要你眼睛不瞎）就可看出其中的差别。        ◇协议栈 
      --------
  DoH
--------
  HTTP
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over HTTPS 就是基于 HTTPS 隧道之上的域名协议。而 HTTPS 又是“HTTP over TLS”。所以 DoH 相当于是【双重隧道】的协议。  与 DoT 类似，DoH 最终也是依靠 TLS 来实现了【保密性】与【完整性】。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇【信任链】的实现 
  DoH 类似于 DoT，最终是靠 TLS 所使用的“CA 证书体系”来实现信任链。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  基本上，DoT 具备的优点，DoH 也具备。  相比 DoT，DoH 还多了一个优点：  由于 DoH 是基于 HTTP 之上。而主流的编程语言都有成熟的 HTTP 协议封装库；再加上 HTTP 协议的使用本身很简单。因此，要想用各种主流编程语言开发一个 DoH 的客户端，是非常容易滴。        ◇缺点 
  如前所述，DoH 目前还只有 RFC 的草案，尚未正式发布。这算是一个缺点。  相比 DoT，DoH 还有一个小缺点——由于 DoH 比 DoT 多了一层（请对比两者的协议栈），所以在性能方面，DoH 会比 DoT 略差。为啥说这是个【小】缺点捏？因为域名的查询并【不】频繁，而且客户端软件可以很容易地对域名的查询结果进行【缓存】（以降低查询次数）。所以 DoH 比 DoT 性能略差，无伤大雅。         ★4种协议的综合对照表 
  为了给列位看官一个直观的印象，放一个综合的对照表。        
    
     
      
       协议类型
      
      
       标准化
      
      
       完整性
       
       （防篡改）
      
      
       保密性
       
       （防偷窥）
      
      
       抗协议识别
      
      
       主流的
       
       浏览器支持
      
      
       知名的
       
       公共服务器
      
     
     
      
       DNSSEC
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       无
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
     
      
       DNSCrypt
      
      
       无
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       OpenDNS
       
       Quad9
      
     
     
      
       DNS over TLS
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       无
      
      
       Cloudflare
       
       Quad9
      
     
     
      
       DNS over HTTPS
      
      
       进行中
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
    
    
        ★为啥 DNS over HTTPS 更有前途？——谈谈俺个人观点 
  接着来聊一下：4个协议中，谁的前景看好。（以下是俺个人观点，供参考）        ◇首先【排除】DNSSEC 
  如果要讨论这4种协议的优劣，首先出局的是 DNSSEC。因为这玩意儿连【保密性】都不具备，无法保护网民的隐私。  相比之下，另外三种协议都具备了“保密性”。        ◇DNSCrypt 与 TLS 的对比 
  DoT 与 DoH 这两个协议，本质上都是依赖 TLS 来保证安全性（完整性 及 保密性）。所以剩下三种协议的对比，实际上是 DNSCrypt 与 TLS 之间的 PK。  俺认为 TLS 具有如下几个优势：  
   优势1——关于“标准化”
    SSL/TLS 老早就已经标准化了，距今已超过20年。（关于 SSL/TLS 版本的演变历史，可以参见  这篇博文  ）  而 DNSCrypt 发布这么多年，连 RFC 都没有提交过——这玩意儿看来【没希望】成为互联网标准了。   
   优势2——关于“客户端部署”
    TLS 的公钥体系（CA 证书体系）早就已经普及。所有主流的操作系统都内置了一系列 CA 根证书。  相比之下，DNSCrypt 另起炉灶搞了一套公钥机制，只有它自己在用。  所以，在【部署客户端】的时候，DNSCrypt 会比 TLS 麻烦。虽然某些 DNSCrypt 的客户端已经内置了一些知名的公共服务器的公钥，但如果你要切换到另一个 DNSCrypt 服务器，并且该服务器的公钥没有内置在客户端里面，那你就需要手动部署。   
   优势3——关于“协议识别”
    这个话题前面已经谈过了。此处再重复唠叨一下。  如果网络流量被监控，监控者可以根据协议特征，把 DNSCrypt 识别出来；而 DoT 与 DoH，在流量外观上，与其它的 TLS 流量【毫无差异】。也就是说，监控流量的人，无法判断某个 TLS 流量是否属于 DoT 或 DoH。  以咱们天朝为例：  天朝的国际出口被 GFW 严密监视。如果 GFW 愿意的话，它完全可以根据协议特征，把 DNSCrypt 协议的流量识别出来并阻断掉。  再来看 TLS，该协议已经被广泛应用于 HTTPS，GFW 不可能把所有 TLS 流量都阻断；再加上 TLS 协议设计严密，GFW 无法判断 TLS 承载的【上层协议】是啥。所以，对于流经国际出口的 DoT 或 DoH，GFW 是判断不出来滴。   综上所述，TLS 完胜 DNSCrypt。所以，剩下的协议就只有 DoT 与 DoH。        ◇DoT VS DoH 
  前面谈 DoH 优缺点的时候，其实已经可以看出这两者谁更有前途了。  DoT 因为协议栈少了一层，性能会比 DoH 更好。但是俺前面也说了，域名查询的频度是比较低的，而且还可以利用客户端软件的 DNS 缓存，进一步减少域名查询的频度。所以 DoT 虽然性能更好，但优势不明显。   DoH 的强项体现在如下几方面：  
   1. 编程接口更简单
    （关于这点，前面提到过）这是个很重要的优势——有助于让更多软件切换到 DoH 之上。  
   2. 可以利用 HTTP 协议已有的特性
    由于 DoH 是基于 HTTPS 之上，可以无缝地支持 Proxy；  DoH 可以充分利用 HTTP 2.0 的特性（HTTP/2 在 HTTP/1.1 基础上加了很多功能）。   正是因为 DoH 的这些优势，浏览器厂商对 DoH 的支持更积极。对比一下就可以看出来——DoT 在两年前正式发布 RFC，主流的浏览器没一个支持；而 DoH 目前才仅仅是 RFC 草案，Firefox 与 Chrome/Chromium 都开始支持了。        ◇小结 
  经过层层淘汰，目前看下来最有前途的应该 DoH（DNS over HTTPS）。  DoH 未来的发展势头取决于如下几点：  1. 标准化的时间进度（看目前的架势，正式发布应该快到了）  2. 其它浏览器跟进的速度         ★对 DoH 的进一步讨论 
       ◇引申阅读 
  分享几篇 DoH 相关的文章：   《  A cartoon intro to DNS over HTTPS  》  （注：这是 Mozilla 官方博客的一篇文章，深入浅出地扫盲了 DNS 和 DoH 的原理）   《  The Benefits of HTTPS for DNS  》  （注：这是某个老外写的技术文章，讨论 DoH 可以借助 HTTP 协议的哪些好处）         ◇关于浏览器的说明 
  
   Firefox
    Firefox 从 62 版本开始支持 DoH，具体参见 Mozilla 官方博客（链接在“  这里  ”）。  由于 DoH 功能刚刚加入，还没有提供相应的配置界面。如果你想体验该功能，需要定制 Firefox 的配置选项（Preferences）以初始化 DoH 的相关参数。定制 Firefox 的方法参见博文：《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》   
   Chrome/Chromium
    Chrome/Chromium 从 66 版本开始支持 DoH。具体参见 Chromium 官网的 issue（链接在“  这里  ”）。   虽然 Firefox 和 Chrome/Chromium 都已经开始支持 DoH，但大伙儿别急着用。  按照历史经验，刚加入的新功能，可能还不够稳定，没准儿还存在未曝光的安全漏洞。多等几个版本之后再说。        ◇对翻墙的好处——无缝整合 
  常规的翻墙软件，无非就是“代理软件”与“VPN 软件”。  
   对于“VPN 软件”
    由于 VPN 具有【全局代理】的性质，DoH 当然可以无缝地整合到 VPN 翻墙中。  
   对于“代理软件”
    常见的代理软件，要么是 HTTP 代理，要么是 SOCKS 代理。只要这些代理能支持 HTTPS，也就天然地支持 DoH。  注：GAE 没有原生支持 HTTPS 代理。所以基于 GAE 的翻墙软件，就不能走 DoH 协议啦 :(        ◇相关的客户端工具 
  在 curl 官方的代码仓库，有一个  关于 DoH 的 wiki 页面  ，里面列出了一些 DoH 的客户端小工具。  喜欢折腾技术的同学，可以先去玩一玩。   因为 DoH 的标准还没有正式发布，关于它的讨论就到此为止。等到啥时候发布了，俺再专门发一篇 DoH 如何使用的博文。    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》  《  扫盲 HTTPS 和 SSL/TLS 协议  》（系列）  《  数字证书及 CA 的扫盲介绍  》  《  如何保护隐私  》（系列）  《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》     

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html 
    
    
  
  
    
         
    
    
    
 
    
  

" />
    
    <meta name="author" content="觀點" />

    
    <meta property="og:title" content="对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS" />
    <meta property="twitter:title" content="对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS" />
    

  <link rel="stylesheet" type="text/css" href="/opinion/style.css" />
  <link rel="alternate" type="application/rss+xml" title="觀點 - 從草根到大師 git.io/JJCxS" href="/opinion/feed.xml" />

  <!-- Social Share Kit CSS -->
  <link rel="stylesheet" href="/opinion/assets/css/social-share-kit.css" type="text/css">
  <link rel="stylesheet" href="/opinion/assets/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="/opinion/assets/css/bootstrap.min.css" type="text/css">
  <script type="text/javascript" src="/opinion/assets/js/jquery-3.5.1.js"></script>
  <script type="text/javascript" src="/opinion/assets/js/page.js"></script>

</head>

  <body>
    <div class="wrapper-masthead">
  <div class="container">
    <header class="masthead clearfix">
      

      <div class="site-info">
        <h1 class="site-name" style="display: inline-block;"><a href="/opinion/">觀點</a></h1>
        <i class="site-description" style="font-size: 12px;">從草根到大師 git.io/JJCxS</i>
      </div>

      <nav>
        <span id="search-container" >
          <a href="/opinion/tools"><i class="fa fa-bookmark twitter" title="百宝箱"></i></a>
        <a><i class="fa fa-search" title="限前100結果"></i></a><input type="text" id="search-input" placeholder="標題 作者 來源 日期 (17489)"
          style="margin: 10px 0px 0px 0px; height: 30px;width: auto" title="本站最正確的打開方式">
        </span>
        
        
        <a href="/opinion/categories" style="color: Tomato;"><i class="fa fa-tags" title="分类"></i></a>
        
        
        
        <a href="https://be4.herokuapp.com/" style="color: #003366;"><i class="fa fa-comments" title="论坛"></i></a>
        
        
        
        <a href="/opinion/about"><i class="fa fa-info-circle" title="关于"></i></a>
        
        
        <a title="电脑热键：&larr;上一篇(页), &rarr;下一篇(页), ins同来源新一篇，del同来源旧一篇" onclick="toggle_visibility('help')"><i class="fa fa-question-circle"></i></a>
        <a id="fa-home" href="https://nodebe4.github.io" title="BE4服务列表" onclick="//toggle_visibility('site-list')"><i class="fa fa-home" aria-hidden="true"></i></a>
      </nav>

    </header>
    <div id="site-list" class="tags" style="display: block;text-align: right;border-bottom: 1px solid lightGray;"><noscript><span style="background-color: #e8e8e8;color: #d10000;font-size: 14px;">开启浏览器JavaScript以获取搜索功能和更好的浏览体验</span></noscript></div>
    <p id="help" style="font-size: 14px;display: none;text-align: right;"><span style="color:green;">电脑热键：&larr;上一篇(页), &rarr;下一篇(页), ins同来源新一篇, del同来源旧一篇</span>; <span style="color:orange">对应触屏FAB：上下右左</span>; 轉Markdown<a href="https://euangoddard.github.io/clipboard2markdown/"><i class="fa fa-file-text-o"></i></a></p>
  </div>
</div>

<script type="text/javascript" >
  function toggle_visibility(id){
    var help = document.getElementById(id)
    if (help.style.display=='none'){
      help.style.display='block';
    }else{
      help.style.display='none';
    }
  }

  const url = "https://nodebe4.github.io/sitelist.json"

  document.addEventListener("DOMContentLoaded", function(event){
    // var homebtn = document.getElementById("fa-home")
    // homebtn.removeAttribute("href")
    var content = document.getElementById("site-list");
    content.innerHTML = ''
    var ul = document.createElement("ul")
    ul.classList.add("label")
    content.appendChild(ul)
    var cnt = 0

    $.getJSON(url, function(allsites) {

      allsites.map(item =>{
        var li = document.createElement('li')
        li.classList.add("tag")
        li.id = 'site-' + cnt
        ul.appendChild(li)
        var a0 = document.createElement('a')
        li.appendChild(a0)
        a0.href = item.url[0]
        var span = document.createElement('span')
        a0.appendChild(span)
        span.innerText = item['name']
        // span.style.backgroundColor = item['background-color']
        // span.style.color='#E4CBC3'
        span.style.color = item['background-color']
        span.style['font-size'] = '14px'
        cnt += 1
        // test_alive(li.id, a0.href)
      })
    })
  })

function test_alive(id, url){
  var divstatus = document.getElementById(id)
  const base = 'https://textance.herokuapp.com/title/'
  var fullurl = base + url
  $.ajax({
      url: fullurl,
      complete: function(data) {
        if (data.responseText.includes('502')){
          // divstatus.style.color='#FBB7B7'
          // divstatus.style.color='gray'
          // divstatus.title = "服务器无响应"
          divstatus.parentNode.removeChild(divstatus)
        }else{
          // divstatus.style.color='#B6FAC8'
          divstatus.title = data.responseText
        }
      }
  });
  return divstatus
}
</script>



    <!-- Left & centered positioning -->

<div class="ssk-sticky ssk-right ssk-center ssk-sticky-hide-xs ssk-group ssk-round">
  
    <a href="https://be4news.pythonanywhere.com/archivenow/ia/https%3A%2F%2Fprogram-think.blogspot.com%2F2018%2F10%2FComparison-of-DNS-Protocols.html" class="ssk ssk-link" title="存到互联网档案馆" target="_blank"></a>
    <a href="https://www.facebook.com/sharer.php?u=https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html" class="ssk ssk-facebook"></a>
    <a href="https://twitter.com/intent/tweet?url=https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html&text=对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS&hashtags=觀點" class="ssk ssk-twitter"></a>
    <a href="https://reddit.com/submit?url=https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html&title=对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS" class="ssk ssk-reddit"></a>
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html&title=对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS" class="ssk ssk-linkedin"></a>
    <a href="mailto:{email_address}?subject=对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS&body=

      对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS  
  
    
      
    
  
  
      
       ★引子 
  俺在写前一篇博文（也就是  Firefox PK Chrome 那篇  ）的时候，碰巧看到 Mozilla 官方博客提到说：目前最新的 Firefox 62 版本开始支持【DNS over HTTPS】这一特性（链接在“  这里  ”）。  本来想顺便聊一下“DNS over HTTPS”这个玩意儿。但是查了一下，发现它的 RFC 目前还只是【草案】，尚未正式发布。  所以俺就把本文的主题改成——对比4种强化 DNS 安全的网络协议（顺便也普及一些信息安全知识）。  
       
        ★传统的 DNS 有啥问题？ 
  传统的 DNS 是一个【比较古老】的协议。最早的草案可以追溯到1983年。1987年定稿之后，基本上没啥变化。算起来，它的年龄比俺博客的很多读者都要大。  设计 DNS 的时候，互联网基本上还是个玩具。那年头的互联网协议，压根儿都没考虑安全性，DNS 当然也不例外。所以 DNS 的交互过程全都是【明文】滴，既无法做到“保密性”，也无法实现“完整性”。  缺乏“保密性”就意味着——任何一个能【监视】你上网流量的人，都可以【看到】你查询了哪些域名。直接引发的问题就是隐私风险。  缺乏“完整性”就意味着——任何一个能【修改】你上网流量的人，都可以【篡改】你的查询结果。直接引发的问题就是“DNS 欺骗”（也叫“DNS 污染”或“DNS 缓存投毒”）  关于“域名欺骗/域名污染”，可以参见俺的另一篇博文《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》（注：4年前的那篇博文，不光讲了“域名欺骗”，还扫盲了 DNS 的基本原理）   为了解决传统 DNS 的这些弊端，后来诞生了好几个网络协议，以强化域名系统的安全性。俺今天挑选其中4个来介绍。除了这4个，其它一些协议的名气和影响力太小，不值一提。  下面俺以出场时间的先后，分别介绍这4个协议。         ★DNSSEC 
       ◇历史 
  这玩意儿是“Domain Name System Security Extensions”的缩写。在今天介绍的4个协议中，DNSSEC 是最早诞生的（1997）。从最先的  RFC 2065  进化为  RFC 2535  ，再到  RFC 4033  、  RFC 4034  、  RFC 4035  。  在今天介绍的4个协议中，DNSSEC 也是最早大规模部署的。在2010年的时候，所有  根域名服务器  都已经部署了 DNSSEC。到了2011年，若干顶级域名（.org 和 .com 和 .net 和 .edu）也部署了 DNSSEC。        ◇协议栈 
      --------
 DNSSEC
--------
  UDP
--------
  IP
--------    
       ◇安全性的原理 
  当初设计 DNSSEC 的一个考虑是“尽可能兼容 DNS 协议”。所以 DNSSEC 只是在 DNS 协议的基础上增加了一个【数字签名机制】。  有了数字签名，如果域名查询的结果被人篡改了，DNSSEC 客户端就可以通过【校验签名】，判断查询结果是假的。套用信息安全的行话——DNSSEC 实现了【完整性】（也叫“不可篡改性”）。  由于 DNSSEC 引入了【数字签名】，就需要有【公私钥对】。私钥是保密的，用来生成签名；公钥是公开的，用来验证签名。DNSSEC 客户端可以向 DNSSEC 服务器发出请求，获得一个 DNSKEY 记录，里面含公钥；然后用这个公钥校验每次的查询结果。        ◇信任链的实现 
  有些聪明的读者会问了：DESSEC 客户端在向服务器请求公钥的过程中，如果被攻击者篡改了，得到一个假的公钥，那该如何是好？  为了解决此问题，DNSSEC 体系要求【上级域】来担保。比如想要证明 program-think.blogspot.com 这个域名的公钥是否可信，就依靠 blogspot.com 这个域名的公钥来验证。通过层层追溯，最后达到【根域名服务器】。而“根域名服务器的公钥”是事先就部署在客户端的——这玩意儿就是整个信任链的根源，称之为“信任锚”（洋文叫“Trust Anchor”）。        ◇优点 
  在今天聊的4个协议中，DNSSEC 应该是最成熟的。除了前面提到的广泛部署，大多数公共的域名服务器也都支持它。维基百科上有一个对照表（链接在“  这里  ”），对比了有名气的几个公共域名服务系统。在今天聊的4个协议中，支持 DNSSEC 的最多。        ◇缺点 
  虽然 DNSSEC 最成熟，但它有个天生的缺陷——【没有】考虑到【保密性】。  DNSSEC 虽然对传输的数据做了数字签名，但是【没有】进行加密。这就意味着——任何能监视你网络流量的人，也可以看到你通过 DNSSEC 查询了哪些域名。 
   隐私风险大大滴！
    Chrome 曾经在 14 版本支持过 DNSSEC，后来又【移除】了；而 Firefox 官方从未支持过 DNSSEC 协议。俺猜测：大概就是这个缺点给闹的。         ★DNSCrypt 
       ◇历史 
  第2个出场的是 DNSCrypt。这个协议是由 Frank Denis 和 Yecheng Fu（付业成）两人设计的。  这个协议从来【没有】提交过 RFC（征求意见稿），要想看它的协议实现，只能去它的官网（链接在“  这里  ”）。  历史上有过两个版本，分别称：Version 1 和 Version 2。如今主要使用“版本2”        ◇协议栈 
      ----------------
    DNSCrypt
----------------
   TCP or UDP
----------------
       IP
----------------    
       ◇安全性的原理 
  前面俺提到 DNSSEC 协议强调兼容性。而 DNSCrypt 则完全是另起炉灶搞出来的协议。在这个协议中，域名的“查询请求”与“响应结果”都是加密的。这就是它比 DNSSEC 高级的地方。  换句话说，DNSCrypt 既能做到【完整性】，也能做到【保密性】；相比之下，DNSSEC 只能做到【完整性】。        ◇信任链的实现 
  DNSCrypt 的信任链比较简单——客户端要想使用哪个 DNSCrypt 服务器，就需要预先部署该服务器的公钥。  另外，DNSCrypt 还支持客户端认证（作为可选项）。如果需要的话，可以在服务器上部署客户端的公钥。此时，服务器只接受可信的客户端的查询请求。        ◇优点 
  如前所述，DNSCrypt 同时支持【完整性】与【保密性】。在隐私方面完胜 DNSSEC。  在下层协议方面，DNSCrypt 同时支持 TCP 和 UDP，显然比 DNSSEC 灵活（DNSSEC 只支持 UDP）。  顺便提醒一下：虽然 DNSCrypt 协议默认使用 443 这个端口号，但该协议与 HTTPS 毫无关系。        ◇缺点 
  （俺个人认为）DNSCrypt 最大的缺点就是前面提到的：【从未】提交过 RFC。没有 RFC 也就无法通过 IETF（互联网工程任务组）进行标准化。一个无法标准化的协议，其生命力要打很大的折扣。  另一个比较小的缺点是——虽然 DNSCrypt 协议是加密的，但可以被识别出来。换句话说：如果有人监控你的流量，可以识别出哪些流量属于 DNSCrypt 协议。为啥说这是个缺点捏？在本文末尾讨论 “DNSCrypt 与 TLS 的安全性对比” 的时候，会详细加以说明。  再来说说【公共 DNS 系统】。截至俺写本文时，Google 和 Cloudflare 的公共域名系统【尚未】支持 DNSCrypt（参见  这个页面  的对照表）。这也是一个缺点。         ★DNS over TLS 
  “DNS over TLS”有时也被简称为【DoT】。为了打字省力，本文以下部分用 DoT 来称呼之。        ◇历史 
  DoT 已经正式发布了 RFC（参见  RFC 7858  和  RFC 8310  ）。  从时间上看，RFC7858 是2016年发布的，RFC8310 是今年（2018）发布的；显然，这个协议出现得比较晚（相比前面提到的 DNSSEC 和 DNSCrypt）。        ◇协议栈 
      --------
  DoT
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over TLS 就是基于 TLS 隧道之上的域名协议。由于 TLS 本身已经实现了【保密性】与【完整性】，因此 DoT 自然也就具有这两项特性。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇信任链的实现 
  DoT 的信任链依赖于 TLS，而 TLS 的信任链靠的是 CA 证书体系。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  相比 DNSSEC，DoT 具备了【保密性】；相比 DNSCrypt，DoT 已经标准化。  另外，由于 DoT 协议是完全包裹在 TLS 里面，即使有人监视你的上网流量，也无法判断——哪些 TLS 流量是用于域名查询，哪些 TLS 用于网页传输。换句话说，DoT 协议的流量无法被【单独识别】出来。        ◇缺点 
  支持 DoT 的客户端还不够多。尤其是主流的浏览器还没有计划增加 DoT 的支持。         ★DNS over HTTPS 
  “DNS over HTTPS”有时也被简称为【DoH】。为了打字省力，本文以下部分用 DoH 来称呼之。        ◇历史 
  在今天介绍的4个协议中，DoH 是最新的（最晚出现的）。RFC 方面，它已经有了相应的草案，但还【没有】正式发布。截至俺写本文时，DoH 的草案已经发了 15 个版本（从 00 到 14），最新版的链接在“  这里  ”。  很多人把 DoH 与 DoT 混为一谈，实际上这是两种不同的协议。你可以对比这两者的协议栈，（只要你眼睛不瞎）就可看出其中的差别。        ◇协议栈 
      --------
  DoH
--------
  HTTP
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over HTTPS 就是基于 HTTPS 隧道之上的域名协议。而 HTTPS 又是“HTTP over TLS”。所以 DoH 相当于是【双重隧道】的协议。  与 DoT 类似，DoH 最终也是依靠 TLS 来实现了【保密性】与【完整性】。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇【信任链】的实现 
  DoH 类似于 DoT，最终是靠 TLS 所使用的“CA 证书体系”来实现信任链。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  基本上，DoT 具备的优点，DoH 也具备。  相比 DoT，DoH 还多了一个优点：  由于 DoH 是基于 HTTP 之上。而主流的编程语言都有成熟的 HTTP 协议封装库；再加上 HTTP 协议的使用本身很简单。因此，要想用各种主流编程语言开发一个 DoH 的客户端，是非常容易滴。        ◇缺点 
  如前所述，DoH 目前还只有 RFC 的草案，尚未正式发布。这算是一个缺点。  相比 DoT，DoH 还有一个小缺点——由于 DoH 比 DoT 多了一层（请对比两者的协议栈），所以在性能方面，DoH 会比 DoT 略差。为啥说这是个【小】缺点捏？因为域名的查询并【不】频繁，而且客户端软件可以很容易地对域名的查询结果进行【缓存】（以降低查询次数）。所以 DoH 比 DoT 性能略差，无伤大雅。         ★4种协议的综合对照表 
  为了给列位看官一个直观的印象，放一个综合的对照表。        
    
     
      
       协议类型
      
      
       标准化
      
      
       完整性
       
       （防篡改）
      
      
       保密性
       
       （防偷窥）
      
      
       抗协议识别
      
      
       主流的
       
       浏览器支持
      
      
       知名的
       
       公共服务器
      
     
     
      
       DNSSEC
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       无
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
     
      
       DNSCrypt
      
      
       无
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       OpenDNS
       
       Quad9
      
     
     
      
       DNS over TLS
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       无
      
      
       Cloudflare
       
       Quad9
      
     
     
      
       DNS over HTTPS
      
      
       进行中
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
    
    
        ★为啥 DNS over HTTPS 更有前途？——谈谈俺个人观点 
  接着来聊一下：4个协议中，谁的前景看好。（以下是俺个人观点，供参考）        ◇首先【排除】DNSSEC 
  如果要讨论这4种协议的优劣，首先出局的是 DNSSEC。因为这玩意儿连【保密性】都不具备，无法保护网民的隐私。  相比之下，另外三种协议都具备了“保密性”。        ◇DNSCrypt 与 TLS 的对比 
  DoT 与 DoH 这两个协议，本质上都是依赖 TLS 来保证安全性（完整性 及 保密性）。所以剩下三种协议的对比，实际上是 DNSCrypt 与 TLS 之间的 PK。  俺认为 TLS 具有如下几个优势：  
   优势1——关于“标准化”
    SSL/TLS 老早就已经标准化了，距今已超过20年。（关于 SSL/TLS 版本的演变历史，可以参见  这篇博文  ）  而 DNSCrypt 发布这么多年，连 RFC 都没有提交过——这玩意儿看来【没希望】成为互联网标准了。   
   优势2——关于“客户端部署”
    TLS 的公钥体系（CA 证书体系）早就已经普及。所有主流的操作系统都内置了一系列 CA 根证书。  相比之下，DNSCrypt 另起炉灶搞了一套公钥机制，只有它自己在用。  所以，在【部署客户端】的时候，DNSCrypt 会比 TLS 麻烦。虽然某些 DNSCrypt 的客户端已经内置了一些知名的公共服务器的公钥，但如果你要切换到另一个 DNSCrypt 服务器，并且该服务器的公钥没有内置在客户端里面，那你就需要手动部署。   
   优势3——关于“协议识别”
    这个话题前面已经谈过了。此处再重复唠叨一下。  如果网络流量被监控，监控者可以根据协议特征，把 DNSCrypt 识别出来；而 DoT 与 DoH，在流量外观上，与其它的 TLS 流量【毫无差异】。也就是说，监控流量的人，无法判断某个 TLS 流量是否属于 DoT 或 DoH。  以咱们天朝为例：  天朝的国际出口被 GFW 严密监视。如果 GFW 愿意的话，它完全可以根据协议特征，把 DNSCrypt 协议的流量识别出来并阻断掉。  再来看 TLS，该协议已经被广泛应用于 HTTPS，GFW 不可能把所有 TLS 流量都阻断；再加上 TLS 协议设计严密，GFW 无法判断 TLS 承载的【上层协议】是啥。所以，对于流经国际出口的 DoT 或 DoH，GFW 是判断不出来滴。   综上所述，TLS 完胜 DNSCrypt。所以，剩下的协议就只有 DoT 与 DoH。        ◇DoT VS DoH 
  前面谈 DoH 优缺点的时候，其实已经可以看出这两者谁更有前途了。  DoT 因为协议栈少了一层，性能会比 DoH 更好。但是俺前面也说了，域名查询的频度是比较低的，而且还可以利用客户端软件的 DNS 缓存，进一步减少域名查询的频度。所以 DoT 虽然性能更好，但优势不明显。   DoH 的强项体现在如下几方面：  
   1. 编程接口更简单
    （关于这点，前面提到过）这是个很重要的优势——有助于让更多软件切换到 DoH 之上。  
   2. 可以利用 HTTP 协议已有的特性
    由于 DoH 是基于 HTTPS 之上，可以无缝地支持 Proxy；  DoH 可以充分利用 HTTP 2.0 的特性（HTTP/2 在 HTTP/1.1 基础上加了很多功能）。   正是因为 DoH 的这些优势，浏览器厂商对 DoH 的支持更积极。对比一下就可以看出来——DoT 在两年前正式发布 RFC，主流的浏览器没一个支持；而 DoH 目前才仅仅是 RFC 草案，Firefox 与 Chrome/Chromium 都开始支持了。        ◇小结 
  经过层层淘汰，目前看下来最有前途的应该 DoH（DNS over HTTPS）。  DoH 未来的发展势头取决于如下几点：  1. 标准化的时间进度（看目前的架势，正式发布应该快到了）  2. 其它浏览器跟进的速度         ★对 DoH 的进一步讨论 
       ◇引申阅读 
  分享几篇 DoH 相关的文章：   《  A cartoon intro to DNS over HTTPS  》  （注：这是 Mozilla 官方博客的一篇文章，深入浅出地扫盲了 DNS 和 DoH 的原理）   《  The Benefits of HTTPS for DNS  》  （注：这是某个老外写的技术文章，讨论 DoH 可以借助 HTTP 协议的哪些好处）         ◇关于浏览器的说明 
  
   Firefox
    Firefox 从 62 版本开始支持 DoH，具体参见 Mozilla 官方博客（链接在“  这里  ”）。  由于 DoH 功能刚刚加入，还没有提供相应的配置界面。如果你想体验该功能，需要定制 Firefox 的配置选项（Preferences）以初始化 DoH 的相关参数。定制 Firefox 的方法参见博文：《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》   
   Chrome/Chromium
    Chrome/Chromium 从 66 版本开始支持 DoH。具体参见 Chromium 官网的 issue（链接在“  这里  ”）。   虽然 Firefox 和 Chrome/Chromium 都已经开始支持 DoH，但大伙儿别急着用。  按照历史经验，刚加入的新功能，可能还不够稳定，没准儿还存在未曝光的安全漏洞。多等几个版本之后再说。        ◇对翻墙的好处——无缝整合 
  常规的翻墙软件，无非就是“代理软件”与“VPN 软件”。  
   对于“VPN 软件”
    由于 VPN 具有【全局代理】的性质，DoH 当然可以无缝地整合到 VPN 翻墙中。  
   对于“代理软件”
    常见的代理软件，要么是 HTTP 代理，要么是 SOCKS 代理。只要这些代理能支持 HTTPS，也就天然地支持 DoH。  注：GAE 没有原生支持 HTTPS 代理。所以基于 GAE 的翻墙软件，就不能走 DoH 协议啦 :(        ◇相关的客户端工具 
  在 curl 官方的代码仓库，有一个  关于 DoH 的 wiki 页面  ，里面列出了一些 DoH 的客户端小工具。  喜欢折腾技术的同学，可以先去玩一玩。   因为 DoH 的标准还没有正式发布，关于它的讨论就到此为止。等到啥时候发布了，俺再专门发一篇 DoH 如何使用的博文。    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》  《  扫盲 HTTPS 和 SSL/TLS 协议  》（系列）  《  数字证书及 CA 的扫盲介绍  》  《  如何保护隐私  》（系列）  《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》     

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html 
    
    
  
  
    
         
    
    
    
 
    
  

" class="ssk ssk-email"></a>
    <a href="http://pinterest.com/pin/create/link/?url=https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html" class="ssk ssk-pinterest"></a>
    <a href="https://www.tumblr.com/widgets/share/tool?canonicalUrl=https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html&title=对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS&caption=

      对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS  
  
    
      
    
  
  
      
       ★引子 
  俺在写前一篇博文（也就是  Firefox PK Chrome 那篇  ）的时候，碰巧看到 Mozilla 官方博客提到说：目前最新的 Firefox 62 版本开始支持【DNS over HTTPS】这一特性（链接在“  这里  ”）。  本来想顺便聊一下“DNS over HTTPS”这个玩意儿。但是查了一下，发现它的 RFC 目前还只是【草案】，尚未正式发布。  所以俺就把本文的主题改成——对比4种强化 DNS 安全的网络协议（顺便也普及一些信息安全知识）。  
       
        ★传统的 DNS 有啥问题？ 
  传统的 DNS 是一个【比较古老】的协议。最早的草案可以追溯到1983年。1987年定稿之后，基本上没啥变化。算起来，它的年龄比俺博客的很多读者都要大。  设计 DNS 的时候，互联网基本上还是个玩具。那年头的互联网协议，压根儿都没考虑安全性，DNS 当然也不例外。所以 DNS 的交互过程全都是【明文】滴，既无法做到“保密性”，也无法实现“完整性”。  缺乏“保密性”就意味着——任何一个能【监视】你上网流量的人，都可以【看到】你查询了哪些域名。直接引发的问题就是隐私风险。  缺乏“完整性”就意味着——任何一个能【修改】你上网流量的人，都可以【篡改】你的查询结果。直接引发的问题就是“DNS 欺骗”（也叫“DNS 污染”或“DNS 缓存投毒”）  关于“域名欺骗/域名污染”，可以参见俺的另一篇博文《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》（注：4年前的那篇博文，不光讲了“域名欺骗”，还扫盲了 DNS 的基本原理）   为了解决传统 DNS 的这些弊端，后来诞生了好几个网络协议，以强化域名系统的安全性。俺今天挑选其中4个来介绍。除了这4个，其它一些协议的名气和影响力太小，不值一提。  下面俺以出场时间的先后，分别介绍这4个协议。         ★DNSSEC 
       ◇历史 
  这玩意儿是“Domain Name System Security Extensions”的缩写。在今天介绍的4个协议中，DNSSEC 是最早诞生的（1997）。从最先的  RFC 2065  进化为  RFC 2535  ，再到  RFC 4033  、  RFC 4034  、  RFC 4035  。  在今天介绍的4个协议中，DNSSEC 也是最早大规模部署的。在2010年的时候，所有  根域名服务器  都已经部署了 DNSSEC。到了2011年，若干顶级域名（.org 和 .com 和 .net 和 .edu）也部署了 DNSSEC。        ◇协议栈 
      --------
 DNSSEC
--------
  UDP
--------
  IP
--------    
       ◇安全性的原理 
  当初设计 DNSSEC 的一个考虑是“尽可能兼容 DNS 协议”。所以 DNSSEC 只是在 DNS 协议的基础上增加了一个【数字签名机制】。  有了数字签名，如果域名查询的结果被人篡改了，DNSSEC 客户端就可以通过【校验签名】，判断查询结果是假的。套用信息安全的行话——DNSSEC 实现了【完整性】（也叫“不可篡改性”）。  由于 DNSSEC 引入了【数字签名】，就需要有【公私钥对】。私钥是保密的，用来生成签名；公钥是公开的，用来验证签名。DNSSEC 客户端可以向 DNSSEC 服务器发出请求，获得一个 DNSKEY 记录，里面含公钥；然后用这个公钥校验每次的查询结果。        ◇信任链的实现 
  有些聪明的读者会问了：DESSEC 客户端在向服务器请求公钥的过程中，如果被攻击者篡改了，得到一个假的公钥，那该如何是好？  为了解决此问题，DNSSEC 体系要求【上级域】来担保。比如想要证明 program-think.blogspot.com 这个域名的公钥是否可信，就依靠 blogspot.com 这个域名的公钥来验证。通过层层追溯，最后达到【根域名服务器】。而“根域名服务器的公钥”是事先就部署在客户端的——这玩意儿就是整个信任链的根源，称之为“信任锚”（洋文叫“Trust Anchor”）。        ◇优点 
  在今天聊的4个协议中，DNSSEC 应该是最成熟的。除了前面提到的广泛部署，大多数公共的域名服务器也都支持它。维基百科上有一个对照表（链接在“  这里  ”），对比了有名气的几个公共域名服务系统。在今天聊的4个协议中，支持 DNSSEC 的最多。        ◇缺点 
  虽然 DNSSEC 最成熟，但它有个天生的缺陷——【没有】考虑到【保密性】。  DNSSEC 虽然对传输的数据做了数字签名，但是【没有】进行加密。这就意味着——任何能监视你网络流量的人，也可以看到你通过 DNSSEC 查询了哪些域名。 
   隐私风险大大滴！
    Chrome 曾经在 14 版本支持过 DNSSEC，后来又【移除】了；而 Firefox 官方从未支持过 DNSSEC 协议。俺猜测：大概就是这个缺点给闹的。         ★DNSCrypt 
       ◇历史 
  第2个出场的是 DNSCrypt。这个协议是由 Frank Denis 和 Yecheng Fu（付业成）两人设计的。  这个协议从来【没有】提交过 RFC（征求意见稿），要想看它的协议实现，只能去它的官网（链接在“  这里  ”）。  历史上有过两个版本，分别称：Version 1 和 Version 2。如今主要使用“版本2”        ◇协议栈 
      ----------------
    DNSCrypt
----------------
   TCP or UDP
----------------
       IP
----------------    
       ◇安全性的原理 
  前面俺提到 DNSSEC 协议强调兼容性。而 DNSCrypt 则完全是另起炉灶搞出来的协议。在这个协议中，域名的“查询请求”与“响应结果”都是加密的。这就是它比 DNSSEC 高级的地方。  换句话说，DNSCrypt 既能做到【完整性】，也能做到【保密性】；相比之下，DNSSEC 只能做到【完整性】。        ◇信任链的实现 
  DNSCrypt 的信任链比较简单——客户端要想使用哪个 DNSCrypt 服务器，就需要预先部署该服务器的公钥。  另外，DNSCrypt 还支持客户端认证（作为可选项）。如果需要的话，可以在服务器上部署客户端的公钥。此时，服务器只接受可信的客户端的查询请求。        ◇优点 
  如前所述，DNSCrypt 同时支持【完整性】与【保密性】。在隐私方面完胜 DNSSEC。  在下层协议方面，DNSCrypt 同时支持 TCP 和 UDP，显然比 DNSSEC 灵活（DNSSEC 只支持 UDP）。  顺便提醒一下：虽然 DNSCrypt 协议默认使用 443 这个端口号，但该协议与 HTTPS 毫无关系。        ◇缺点 
  （俺个人认为）DNSCrypt 最大的缺点就是前面提到的：【从未】提交过 RFC。没有 RFC 也就无法通过 IETF（互联网工程任务组）进行标准化。一个无法标准化的协议，其生命力要打很大的折扣。  另一个比较小的缺点是——虽然 DNSCrypt 协议是加密的，但可以被识别出来。换句话说：如果有人监控你的流量，可以识别出哪些流量属于 DNSCrypt 协议。为啥说这是个缺点捏？在本文末尾讨论 “DNSCrypt 与 TLS 的安全性对比” 的时候，会详细加以说明。  再来说说【公共 DNS 系统】。截至俺写本文时，Google 和 Cloudflare 的公共域名系统【尚未】支持 DNSCrypt（参见  这个页面  的对照表）。这也是一个缺点。         ★DNS over TLS 
  “DNS over TLS”有时也被简称为【DoT】。为了打字省力，本文以下部分用 DoT 来称呼之。        ◇历史 
  DoT 已经正式发布了 RFC（参见  RFC 7858  和  RFC 8310  ）。  从时间上看，RFC7858 是2016年发布的，RFC8310 是今年（2018）发布的；显然，这个协议出现得比较晚（相比前面提到的 DNSSEC 和 DNSCrypt）。        ◇协议栈 
      --------
  DoT
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over TLS 就是基于 TLS 隧道之上的域名协议。由于 TLS 本身已经实现了【保密性】与【完整性】，因此 DoT 自然也就具有这两项特性。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇信任链的实现 
  DoT 的信任链依赖于 TLS，而 TLS 的信任链靠的是 CA 证书体系。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  相比 DNSSEC，DoT 具备了【保密性】；相比 DNSCrypt，DoT 已经标准化。  另外，由于 DoT 协议是完全包裹在 TLS 里面，即使有人监视你的上网流量，也无法判断——哪些 TLS 流量是用于域名查询，哪些 TLS 用于网页传输。换句话说，DoT 协议的流量无法被【单独识别】出来。        ◇缺点 
  支持 DoT 的客户端还不够多。尤其是主流的浏览器还没有计划增加 DoT 的支持。         ★DNS over HTTPS 
  “DNS over HTTPS”有时也被简称为【DoH】。为了打字省力，本文以下部分用 DoH 来称呼之。        ◇历史 
  在今天介绍的4个协议中，DoH 是最新的（最晚出现的）。RFC 方面，它已经有了相应的草案，但还【没有】正式发布。截至俺写本文时，DoH 的草案已经发了 15 个版本（从 00 到 14），最新版的链接在“  这里  ”。  很多人把 DoH 与 DoT 混为一谈，实际上这是两种不同的协议。你可以对比这两者的协议栈，（只要你眼睛不瞎）就可看出其中的差别。        ◇协议栈 
      --------
  DoH
--------
  HTTP
--------
  TLS
--------
  TCP
--------
  IP
--------    
       ◇安全性的原理 
  顾名思义，DNS over HTTPS 就是基于 HTTPS 隧道之上的域名协议。而 HTTPS 又是“HTTP over TLS”。所以 DoH 相当于是【双重隧道】的协议。  与 DoT 类似，DoH 最终也是依靠 TLS 来实现了【保密性】与【完整性】。  至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《  扫盲 HTTPS 和 SSL/TLS 协议  》        ◇【信任链】的实现 
  DoH 类似于 DoT，最终是靠 TLS 所使用的“CA 证书体系”来实现信任链。  关于 CA 证书体系，可以参见8年前的博文：《  数字证书及 CA 的扫盲介绍  》        ◇优点 
  基本上，DoT 具备的优点，DoH 也具备。  相比 DoT，DoH 还多了一个优点：  由于 DoH 是基于 HTTP 之上。而主流的编程语言都有成熟的 HTTP 协议封装库；再加上 HTTP 协议的使用本身很简单。因此，要想用各种主流编程语言开发一个 DoH 的客户端，是非常容易滴。        ◇缺点 
  如前所述，DoH 目前还只有 RFC 的草案，尚未正式发布。这算是一个缺点。  相比 DoT，DoH 还有一个小缺点——由于 DoH 比 DoT 多了一层（请对比两者的协议栈），所以在性能方面，DoH 会比 DoT 略差。为啥说这是个【小】缺点捏？因为域名的查询并【不】频繁，而且客户端软件可以很容易地对域名的查询结果进行【缓存】（以降低查询次数）。所以 DoH 比 DoT 性能略差，无伤大雅。         ★4种协议的综合对照表 
  为了给列位看官一个直观的印象，放一个综合的对照表。        
    
     
      
       协议类型
      
      
       标准化
      
      
       完整性
       
       （防篡改）
      
      
       保密性
       
       （防偷窥）
      
      
       抗协议识别
      
      
       主流的
       
       浏览器支持
      
      
       知名的
       
       公共服务器
      
     
     
      
       DNSSEC
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       无
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
     
      
       DNSCrypt
      
      
       无
      
      
       有
      
      
       有
      
      
       无
      
      
       无
      
      
       OpenDNS
       
       Quad9
      
     
     
      
       DNS over TLS
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       无
      
      
       Cloudflare
       
       Quad9
      
     
     
      
       DNS over HTTPS
      
      
       进行中
      
      
       有
      
      
       有
      
      
       有
      
      
       有
      
      
       Google
       
       Cloudflare
       
       Quad9
      
     
    
    
        ★为啥 DNS over HTTPS 更有前途？——谈谈俺个人观点 
  接着来聊一下：4个协议中，谁的前景看好。（以下是俺个人观点，供参考）        ◇首先【排除】DNSSEC 
  如果要讨论这4种协议的优劣，首先出局的是 DNSSEC。因为这玩意儿连【保密性】都不具备，无法保护网民的隐私。  相比之下，另外三种协议都具备了“保密性”。        ◇DNSCrypt 与 TLS 的对比 
  DoT 与 DoH 这两个协议，本质上都是依赖 TLS 来保证安全性（完整性 及 保密性）。所以剩下三种协议的对比，实际上是 DNSCrypt 与 TLS 之间的 PK。  俺认为 TLS 具有如下几个优势：  
   优势1——关于“标准化”
    SSL/TLS 老早就已经标准化了，距今已超过20年。（关于 SSL/TLS 版本的演变历史，可以参见  这篇博文  ）  而 DNSCrypt 发布这么多年，连 RFC 都没有提交过——这玩意儿看来【没希望】成为互联网标准了。   
   优势2——关于“客户端部署”
    TLS 的公钥体系（CA 证书体系）早就已经普及。所有主流的操作系统都内置了一系列 CA 根证书。  相比之下，DNSCrypt 另起炉灶搞了一套公钥机制，只有它自己在用。  所以，在【部署客户端】的时候，DNSCrypt 会比 TLS 麻烦。虽然某些 DNSCrypt 的客户端已经内置了一些知名的公共服务器的公钥，但如果你要切换到另一个 DNSCrypt 服务器，并且该服务器的公钥没有内置在客户端里面，那你就需要手动部署。   
   优势3——关于“协议识别”
    这个话题前面已经谈过了。此处再重复唠叨一下。  如果网络流量被监控，监控者可以根据协议特征，把 DNSCrypt 识别出来；而 DoT 与 DoH，在流量外观上，与其它的 TLS 流量【毫无差异】。也就是说，监控流量的人，无法判断某个 TLS 流量是否属于 DoT 或 DoH。  以咱们天朝为例：  天朝的国际出口被 GFW 严密监视。如果 GFW 愿意的话，它完全可以根据协议特征，把 DNSCrypt 协议的流量识别出来并阻断掉。  再来看 TLS，该协议已经被广泛应用于 HTTPS，GFW 不可能把所有 TLS 流量都阻断；再加上 TLS 协议设计严密，GFW 无法判断 TLS 承载的【上层协议】是啥。所以，对于流经国际出口的 DoT 或 DoH，GFW 是判断不出来滴。   综上所述，TLS 完胜 DNSCrypt。所以，剩下的协议就只有 DoT 与 DoH。        ◇DoT VS DoH 
  前面谈 DoH 优缺点的时候，其实已经可以看出这两者谁更有前途了。  DoT 因为协议栈少了一层，性能会比 DoH 更好。但是俺前面也说了，域名查询的频度是比较低的，而且还可以利用客户端软件的 DNS 缓存，进一步减少域名查询的频度。所以 DoT 虽然性能更好，但优势不明显。   DoH 的强项体现在如下几方面：  
   1. 编程接口更简单
    （关于这点，前面提到过）这是个很重要的优势——有助于让更多软件切换到 DoH 之上。  
   2. 可以利用 HTTP 协议已有的特性
    由于 DoH 是基于 HTTPS 之上，可以无缝地支持 Proxy；  DoH 可以充分利用 HTTP 2.0 的特性（HTTP/2 在 HTTP/1.1 基础上加了很多功能）。   正是因为 DoH 的这些优势，浏览器厂商对 DoH 的支持更积极。对比一下就可以看出来——DoT 在两年前正式发布 RFC，主流的浏览器没一个支持；而 DoH 目前才仅仅是 RFC 草案，Firefox 与 Chrome/Chromium 都开始支持了。        ◇小结 
  经过层层淘汰，目前看下来最有前途的应该 DoH（DNS over HTTPS）。  DoH 未来的发展势头取决于如下几点：  1. 标准化的时间进度（看目前的架势，正式发布应该快到了）  2. 其它浏览器跟进的速度         ★对 DoH 的进一步讨论 
       ◇引申阅读 
  分享几篇 DoH 相关的文章：   《  A cartoon intro to DNS over HTTPS  》  （注：这是 Mozilla 官方博客的一篇文章，深入浅出地扫盲了 DNS 和 DoH 的原理）   《  The Benefits of HTTPS for DNS  》  （注：这是某个老外写的技术文章，讨论 DoH 可以借助 HTTP 协议的哪些好处）         ◇关于浏览器的说明 
  
   Firefox
    Firefox 从 62 版本开始支持 DoH，具体参见 Mozilla 官方博客（链接在“  这里  ”）。  由于 DoH 功能刚刚加入，还没有提供相应的配置界面。如果你想体验该功能，需要定制 Firefox 的配置选项（Preferences）以初始化 DoH 的相关参数。定制 Firefox 的方法参见博文：《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》   
   Chrome/Chromium
    Chrome/Chromium 从 66 版本开始支持 DoH。具体参见 Chromium 官网的 issue（链接在“  这里  ”）。   虽然 Firefox 和 Chrome/Chromium 都已经开始支持 DoH，但大伙儿别急着用。  按照历史经验，刚加入的新功能，可能还不够稳定，没准儿还存在未曝光的安全漏洞。多等几个版本之后再说。        ◇对翻墙的好处——无缝整合 
  常规的翻墙软件，无非就是“代理软件”与“VPN 软件”。  
   对于“VPN 软件”
    由于 VPN 具有【全局代理】的性质，DoH 当然可以无缝地整合到 VPN 翻墙中。  
   对于“代理软件”
    常见的代理软件，要么是 HTTP 代理，要么是 SOCKS 代理。只要这些代理能支持 HTTPS，也就天然地支持 DoH。  注：GAE 没有原生支持 HTTPS 代理。所以基于 GAE 的翻墙软件，就不能走 DoH 协议啦 :(        ◇相关的客户端工具 
  在 curl 官方的代码仓库，有一个  关于 DoH 的 wiki 页面  ，里面列出了一些 DoH 的客户端小工具。  喜欢折腾技术的同学，可以先去玩一玩。   因为 DoH 的标准还没有正式发布，关于它的讨论就到此为止。等到啥时候发布了，俺再专门发一篇 DoH 如何使用的博文。    
   俺博客上，和本文相关的帖子（需翻墙）
   ：  《  扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染”  》  《  扫盲 HTTPS 和 SSL/TLS 协议  》（系列）  《  数字证书及 CA 的扫盲介绍  》  《  如何保护隐私  》（系列）  《  扫盲 Firefox 定制——从“user.js”到“omni.ja”  》     

    版权声明
     本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者  编程随想  和本文原始地址：   https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html 
    
    
  
  
    
         
    
    
    
 
    
  

&tags=觀點" class="ssk ssk-tumblr"></a>
    <a href="https://buffer.com/add?text=对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS&url=https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html" class="ssk ssk-buffer"></a>
</div>


    <div id="main" role="main" class="container">
      
  <!-- Html Elements for Search -->
  <ul id="results-container" class="searched" style="color: #2980B9;"></ul>

  <script src="/opinion/assets/js/simple-jekyll-search.min.js"></script>

  <!-- Configuration -->
  <script>
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/opinion/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a><time>{date}</time><a class="tag">{category}</a></li>',
    noResultsText: '没找到',
    limit: 100,
    fuzzy: false,
    exclude: ['Welcome']
  })

  </script>

      







  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
    


  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
    



<article class="post">
  <h1>对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS</h1>
  <!-- Look the author details up from the site config. -->
  

  <div>
    <span class="date">
      2018-10-09
    </span>

    <!-- Output author details if some exist. -->
    
      
    


    <ul class="tag">
      <li>
        <a href="https://nodebe4.github.io/opinion/categories/#编程随想">
          编程随想
        </a>
      </li>
    </ul>

    
        <span>
            <!-- Personal Info. -->
            <a href="https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html" style="font-size:14px;">原文</a>
        </span>
    

    <span style="float: right;" title="编程随想的其它文章">
      <a style="font-size: 14px;" rel="nofollow" href="#sametag" class="tags">#编程随想 的其它文章</a>
    </span>

  </div>

  <div class="entry">
    
    
    
    <div class="post hentry uncustomized-post-template">
<a name="4363490092869699584">
 </a>   <h1 class="post-title entry-title" id="dnssecdnscryptdns-over-tlsdns-over-https--"> <a href="https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html"> 对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS </a> </h1>
  <div class="post-header">
    <div class="post-header-line-1">
      <div class="post-inner-index"></div>
    </div>
  </div>
  <div class="post-body entry-content">
    <center> <img alt="不见图 请翻墙" src="https://lh6.googleusercontent.com/4QaghUJDZ1GkjAsoVyFbCnhNchM7YYswTgIuk9MWSA3NNW6xBh6P4VJ1NRAjJcqFJXiee6VhkCkI8UuP8eJLSd7Ka0dyOekEHVc0_GDVWvHOUOrSH0CL7T2JXqka3dZdG6VNLo--vkU" /> </center>
 <br />     <h2 id="section"> ★引子 </h2>
 <br /> 俺在写前一篇博文（也就是 <a href="https://program-think.blogspot.com/2018/09/Why-You-Should-Switch-from-Chrome-to-Firefox.html"> Firefox PK Chrome 那篇 </a> ）的时候，碰巧看到 Mozilla 官方博客提到说：目前最新的 Firefox 62 版本开始支持【DNS over HTTPS】这一特性（链接在“ <a href="https://blog.nightly.mozilla.org/2018/06/01/improving-dns-privacy-in-firefox/" rel="nofollow" target="_blank"> 这里 </a> ”）。 <br /> 本来想顺便聊一下“DNS over HTTPS”这个玩意儿。但是查了一下，发现它的 RFC 目前还只是【草案】，尚未正式发布。 <br /> 所以俺就把本文的主题改成——对比4种强化 DNS 安全的网络协议（顺便也普及一些信息安全知识）。 <br /> <a name="more">
  </a>     <!--program-think-->
 <br /> <br />     <h2 id="dns--"> ★传统的 DNS 有啥问题？ </h2>
 <br /> 传统的 DNS 是一个【比较古老】的协议。最早的草案可以追溯到1983年。1987年定稿之后，基本上没啥变化。算起来，它的年龄比俺博客的很多读者都要大。 <br /> 设计 DNS 的时候，互联网基本上还是个玩具。那年头的互联网协议，压根儿都没考虑安全性，DNS 当然也不例外。所以 DNS 的交互过程全都是【明文】滴，既无法做到“保密性”，也无法实现“完整性”。 <br /> 缺乏“保密性”就意味着——任何一个能【监视】你上网流量的人，都可以【看到】你查询了哪些域名。直接引发的问题就是隐私风险。 <br /> 缺乏“完整性”就意味着——任何一个能【修改】你上网流量的人，都可以【篡改】你的查询结果。直接引发的问题就是“DNS 欺骗”（也叫“DNS 污染”或“DNS 缓存投毒”） <br /> 关于“域名欺骗/域名污染”，可以参见俺的另一篇博文《 <a href="https://program-think.blogspot.com/2014/01/dns.html"> 扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染” </a> 》（注：4年前的那篇博文，不光讲了“域名欺骗”，还扫盲了 DNS 的基本原理） <br /> <br /> 为了解决传统 DNS 的这些弊端，后来诞生了好几个网络协议，以强化域名系统的安全性。俺今天挑选其中4个来介绍。除了这4个，其它一些协议的名气和影响力太小，不值一提。 <br /> 下面俺以出场时间的先后，分别介绍这4个协议。 <br /> <br /> <br />     <h2 id="dnssec-"> ★DNSSEC </h2>
 <br />     <h3 id="section-1"> ◇历史 </h3>
 <br /> 这玩意儿是“Domain Name System Security Extensions”的缩写。在今天介绍的4个协议中，DNSSEC 是最早诞生的（1997）。从最先的 <a href="https://tools.ietf.org/html/rfc2065" rel="nofollow" target="_blank"> RFC 2065 </a> 进化为 <a href="https://tools.ietf.org/html/rfc2535" rel="nofollow" target="_blank"> RFC 2535 </a> ，再到 <a href="https://tools.ietf.org/html/rfc4033" rel="nofollow" target="_blank"> RFC 4033 </a> 、 <a href="https://tools.ietf.org/html/rfc4034" rel="nofollow" target="_blank"> RFC 4034 </a> 、 <a href="https://tools.ietf.org/html/rfc4035" rel="nofollow" target="_blank"> RFC 4035 </a> 。 <br /> 在今天介绍的4个协议中，DNSSEC 也是最早大规模部署的。在2010年的时候，所有 <a href="https://zh.wikipedia.org/wiki/%E6%A0%B9%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8B%99%E5%99%A8" rel="nofollow" target="_blank"> 根域名服务器 </a> 都已经部署了 DNSSEC。到了2011年，若干顶级域名（.org 和 .com 和 .net 和 .edu）也部署了 DNSSEC。 <br /> <br />     <h3 id="section-2"> ◇协议栈 </h3>
 <br />     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--------
 DNSSEC
--------
  UDP
--------
  IP
--------</code></pre></div>    </div>
 <br />     <h3 id="section-3"> ◇安全性的原理 </h3>
 <br /> 当初设计 DNSSEC 的一个考虑是“尽可能兼容 DNS 协议”。所以 DNSSEC 只是在 DNS 协议的基础上增加了一个【数字签名机制】。 <br /> 有了数字签名，如果域名查询的结果被人篡改了，DNSSEC 客户端就可以通过【校验签名】，判断查询结果是假的。套用信息安全的行话——DNSSEC 实现了【完整性】（也叫“不可篡改性”）。 <br /> 由于 DNSSEC 引入了【数字签名】，就需要有【公私钥对】。私钥是保密的，用来生成签名；公钥是公开的，用来验证签名。DNSSEC 客户端可以向 DNSSEC 服务器发出请求，获得一个 DNSKEY 记录，里面含公钥；然后用这个公钥校验每次的查询结果。 <br /> <br />     <h3 id="section-4"> ◇信任链的实现 </h3>
 <br /> 有些聪明的读者会问了：DESSEC 客户端在向服务器请求公钥的过程中，如果被攻击者篡改了，得到一个假的公钥，那该如何是好？ <br /> 为了解决此问题，DNSSEC 体系要求【上级域】来担保。比如想要证明 program-think.blogspot.com 这个域名的公钥是否可信，就依靠 blogspot.com 这个域名的公钥来验证。通过层层追溯，最后达到【根域名服务器】。而“根域名服务器的公钥”是事先就部署在客户端的——这玩意儿就是整个信任链的根源，称之为“信任锚”（洋文叫“Trust Anchor”）。 <br /> <br />     <h3 id="section-5"> ◇优点 </h3>
 <br /> 在今天聊的4个协议中，DNSSEC 应该是最成熟的。除了前面提到的广泛部署，大多数公共的域名服务器也都支持它。维基百科上有一个对照表（链接在“ <a href="https://en.wikipedia.org/wiki/Public_recursive_name_server" rel="nofollow" target="_blank"> 这里 </a> ”），对比了有名气的几个公共域名服务系统。在今天聊的4个协议中，支持 DNSSEC 的最多。 <br /> <br />     <h3 id="section-6"> ◇缺点 </h3>
 <br /> 虽然 DNSSEC 最成熟，但它有个天生的缺陷——【没有】考虑到【保密性】。 <br /> DNSSEC 虽然对传输的数据做了数字签名，但是【没有】进行加密。这就意味着——任何能监视你网络流量的人，也可以看到你通过 DNSSEC 查询了哪些域名。 <b>
   隐私风险大大滴！
  </b> <br /> Chrome 曾经在 14 版本支持过 DNSSEC，后来又【移除】了；而 Firefox 官方从未支持过 DNSSEC 协议。俺猜测：大概就是这个缺点给闹的。 <br /> <br /> <br />     <h2 id="dnscrypt-"> ★DNSCrypt </h2>
 <br />     <h3 id="section-7"> ◇历史 </h3>
 <br /> 第2个出场的是 DNSCrypt。这个协议是由 Frank Denis 和 Yecheng Fu（付业成）两人设计的。 <br /> 这个协议从来【没有】提交过 RFC（征求意见稿），要想看它的协议实现，只能去它的官网（链接在“ <a href="https://dnscrypt.info/protocol/" rel="nofollow" target="_blank"> 这里 </a> ”）。 <br /> 历史上有过两个版本，分别称：Version 1 和 Version 2。如今主要使用“版本2” <br /> <br />     <h3 id="section-8"> ◇协议栈 </h3>
 <br />     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>----------------
    DNSCrypt
----------------
   TCP or UDP
----------------
       IP
----------------</code></pre></div>    </div>
 <br />     <h3 id="section-9"> ◇安全性的原理 </h3>
 <br /> 前面俺提到 DNSSEC 协议强调兼容性。而 DNSCrypt 则完全是另起炉灶搞出来的协议。在这个协议中，域名的“查询请求”与“响应结果”都是加密的。这就是它比 DNSSEC 高级的地方。 <br /> 换句话说，DNSCrypt 既能做到【完整性】，也能做到【保密性】；相比之下，DNSSEC 只能做到【完整性】。 <br /> <br />     <h3 id="section-10"> ◇信任链的实现 </h3>
 <br /> DNSCrypt 的信任链比较简单——客户端要想使用哪个 DNSCrypt 服务器，就需要预先部署该服务器的公钥。 <br /> 另外，DNSCrypt 还支持客户端认证（作为可选项）。如果需要的话，可以在服务器上部署客户端的公钥。此时，服务器只接受可信的客户端的查询请求。 <br /> <br />     <h3 id="section-11"> ◇优点 </h3>
 <br /> 如前所述，DNSCrypt 同时支持【完整性】与【保密性】。在隐私方面完胜 DNSSEC。 <br /> 在下层协议方面，DNSCrypt 同时支持 TCP 和 UDP，显然比 DNSSEC 灵活（DNSSEC 只支持 UDP）。 <br /> 顺便提醒一下：虽然 DNSCrypt 协议默认使用 443 这个端口号，但该协议与 HTTPS 毫无关系。 <br /> <br />     <h3 id="section-12"> ◇缺点 </h3>
 <br /> （俺个人认为）DNSCrypt 最大的缺点就是前面提到的：【从未】提交过 RFC。没有 RFC 也就无法通过 IETF（互联网工程任务组）进行标准化。一个无法标准化的协议，其生命力要打很大的折扣。 <br /> 另一个比较小的缺点是——虽然 DNSCrypt 协议是加密的，但可以被识别出来。换句话说：如果有人监控你的流量，可以识别出哪些流量属于 DNSCrypt 协议。为啥说这是个缺点捏？在本文末尾讨论 “DNSCrypt 与 TLS 的安全性对比” 的时候，会详细加以说明。 <br /> 再来说说【公共 DNS 系统】。截至俺写本文时，Google 和 Cloudflare 的公共域名系统【尚未】支持 DNSCrypt（参见 <a href="https://en.wikipedia.org/wiki/Public_recursive_name_server" rel="nofollow" target="_blank"> 这个页面 </a> 的对照表）。这也是一个缺点。 <br /> <br /> <br />     <h2 id="dns-over-tls-"> ★DNS over TLS </h2>
 <br /> “DNS over TLS”有时也被简称为【DoT】。为了打字省力，本文以下部分用 DoT 来称呼之。 <br /> <br />     <h3 id="section-13"> ◇历史 </h3>
 <br /> DoT 已经正式发布了 RFC（参见 <a href="https://tools.ietf.org/html/rfc7858" rel="nofollow" target="_blank"> RFC 7858 </a> 和 <a href="https://tools.ietf.org/html/rfc8310" rel="nofollow" target="_blank"> RFC 8310 </a> ）。 <br /> 从时间上看，RFC7858 是2016年发布的，RFC8310 是今年（2018）发布的；显然，这个协议出现得比较晚（相比前面提到的 DNSSEC 和 DNSCrypt）。 <br /> <br />     <h3 id="section-14"> ◇协议栈 </h3>
 <br />     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--------
  DoT
--------
  TLS
--------
  TCP
--------
  IP
--------</code></pre></div>    </div>
 <br />     <h3 id="section-15"> ◇安全性的原理 </h3>
 <br /> 顾名思义，DNS over TLS 就是基于 TLS 隧道之上的域名协议。由于 TLS 本身已经实现了【保密性】与【完整性】，因此 DoT 自然也就具有这两项特性。 <br /> 至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《 <a href="https://program-think.blogspot.com/2014/11/https-ssl-tls-0.html"> 扫盲 HTTPS 和 SSL/TLS 协议 </a> 》 <br /> <br />     <h3 id="section-16"> ◇信任链的实现 </h3>
 <br /> DoT 的信任链依赖于 TLS，而 TLS 的信任链靠的是 CA 证书体系。 <br /> 关于 CA 证书体系，可以参见8年前的博文：《 <a href="https://program-think.blogspot.com/2010/02/introduce-digital-certificate-and-ca.html"> 数字证书及 CA 的扫盲介绍 </a> 》 <br /> <br />     <h3 id="section-17"> ◇优点 </h3>
 <br /> 相比 DNSSEC，DoT 具备了【保密性】；相比 DNSCrypt，DoT 已经标准化。 <br /> 另外，由于 DoT 协议是完全包裹在 TLS 里面，即使有人监视你的上网流量，也无法判断——哪些 TLS 流量是用于域名查询，哪些 TLS 用于网页传输。换句话说，DoT 协议的流量无法被【单独识别】出来。 <br /> <br />     <h3 id="section-18"> ◇缺点 </h3>
 <br /> 支持 DoT 的客户端还不够多。尤其是主流的浏览器还没有计划增加 DoT 的支持。 <br /> <br /> <br />     <h2 id="dns-over-https-"> ★DNS over HTTPS </h2>
 <br /> “DNS over HTTPS”有时也被简称为【DoH】。为了打字省力，本文以下部分用 DoH 来称呼之。 <br /> <br />     <h3 id="section-19"> ◇历史 </h3>
 <br /> 在今天介绍的4个协议中，DoH 是最新的（最晚出现的）。RFC 方面，它已经有了相应的草案，但还【没有】正式发布。截至俺写本文时，DoH 的草案已经发了 15 个版本（从 00 到 14），最新版的链接在“ <a href="https://tools.ietf.org/html/draft-ietf-doh-dns-over-https-14" rel="nofollow" target="_blank"> 这里 </a> ”。 <br /> 很多人把 DoH 与 DoT 混为一谈，实际上这是两种不同的协议。你可以对比这两者的协议栈，（只要你眼睛不瞎）就可看出其中的差别。 <br /> <br />     <h3 id="section-20"> ◇协议栈 </h3>
 <br />     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--------
  DoH
--------
  HTTP
--------
  TLS
--------
  TCP
--------
  IP
--------</code></pre></div>    </div>
 <br />     <h3 id="section-21"> ◇安全性的原理 </h3>
 <br /> 顾名思义，DNS over HTTPS 就是基于 HTTPS 隧道之上的域名协议。而 HTTPS 又是“HTTP over TLS”。所以 DoH 相当于是【双重隧道】的协议。 <br /> 与 DoT 类似，DoH 最终也是依靠 TLS 来实现了【保密性】与【完整性】。 <br /> 至于 TLS 协议是如何实现完整性与保密性滴？可以参见俺的系列博文：《 <a href="https://program-think.blogspot.com/2014/11/https-ssl-tls-0.html"> 扫盲 HTTPS 和 SSL/TLS 协议 </a> 》 <br /> <br />     <h3 id="section-22"> ◇【信任链】的实现 </h3>
 <br /> DoH 类似于 DoT，最终是靠 TLS 所使用的“CA 证书体系”来实现信任链。 <br /> 关于 CA 证书体系，可以参见8年前的博文：《 <a href="https://program-think.blogspot.com/2010/02/introduce-digital-certificate-and-ca.html"> 数字证书及 CA 的扫盲介绍 </a> 》 <br /> <br />     <h3 id="section-23"> ◇优点 </h3>
 <br /> 基本上，DoT 具备的优点，DoH 也具备。 <br /> 相比 DoT，DoH 还多了一个优点： <br /> 由于 DoH 是基于 HTTP 之上。而主流的编程语言都有成熟的 HTTP 协议封装库；再加上 HTTP 协议的使用本身很简单。因此，要想用各种主流编程语言开发一个 DoH 的客户端，是非常容易滴。 <br /> <br />     <h3 id="section-24"> ◇缺点 </h3>
 <br /> 如前所述，DoH 目前还只有 RFC 的草案，尚未正式发布。这算是一个缺点。 <br /> 相比 DoT，DoH 还有一个小缺点——由于 DoH 比 DoT 多了一层（请对比两者的协议栈），所以在性能方面，DoH 会比 DoT 略差。为啥说这是个【小】缺点捏？因为域名的查询并【不】频繁，而且客户端软件可以很容易地对域名的查询结果进行【缓存】（以降低查询次数）。所以 DoH 比 DoT 性能略差，无伤大雅。 <br /> <br /> <br />     <h2 id="section-25"> ★4种协议的综合对照表 </h2>
 <br /> 为了给列位看官一个直观的印象，放一个综合的对照表。 <br /> <br />     <center> <table border="1" cellpadding="3" cellspacing="0">
    <tbody>
     <tr style="background:lightgrey;">
      <th>
       协议类型
      </th>
      <th>
       标准化
      </th>
      <th>
       完整性
       <br />
       （防篡改）
      </th>
      <th>
       保密性
       <br />
       （防偷窥）
      </th>
      <th>
       抗协议识别
      </th>
      <th>
       主流的
       <br />
       浏览器支持
      </th>
      <th>
       知名的
       <br />
       公共服务器
      </th>
     </tr>
     <tr>
      <td>
       DNSSEC
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       无
      </td>
      <td>
       无
      </td>
      <td>
       无
      </td>
      <td>
       Google
       <br />
       Cloudflare
       <br />
       Quad9
      </td>
     </tr>
     <tr>
      <td>
       DNSCrypt
      </td>
      <td>
       无
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       无
      </td>
      <td>
       无
      </td>
      <td>
       OpenDNS
       <br />
       Quad9
      </td>
     </tr>
     <tr>
      <td>
       DNS over TLS
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       无
      </td>
      <td>
       Cloudflare
       <br />
       Quad9
      </td>
     </tr>
     <tr>
      <td>
       DNS over HTTPS
      </td>
      <td>
       进行中
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       有
      </td>
      <td>
       Google
       <br />
       Cloudflare
       <br />
       Quad9
      </td>
     </tr>
    </tbody>
   </table> </center>
 <br /> <br />     <h2 id="dns-over-https--"> ★为啥 DNS over HTTPS 更有前途？——谈谈俺个人观点 </h2>
 <br /> 接着来聊一下：4个协议中，谁的前景看好。（以下是俺个人观点，供参考） <br /> <br />     <h3 id="dnssec--1"> ◇首先【排除】DNSSEC </h3>
 <br /> 如果要讨论这4种协议的优劣，首先出局的是 DNSSEC。因为这玩意儿连【保密性】都不具备，无法保护网民的隐私。 <br /> 相比之下，另外三种协议都具备了“保密性”。 <br /> <br />     <h3 id="dnscrypt--tls--"> ◇DNSCrypt 与 TLS 的对比 </h3>
 <br /> DoT 与 DoH 这两个协议，本质上都是依赖 TLS 来保证安全性（完整性 及 保密性）。所以剩下三种协议的对比，实际上是 DNSCrypt 与 TLS 之间的 PK。 <br /> 俺认为 TLS 具有如下几个优势： <br /> <b>
   优势1——关于“标准化”
  </b> <br /> SSL/TLS 老早就已经标准化了，距今已超过20年。（关于 SSL/TLS 版本的演变历史，可以参见 <a href="https://program-think.blogspot.com/2018/09/https-ssl-tls-4.html"> 这篇博文 </a> ） <br /> 而 DNSCrypt 发布这么多年，连 RFC 都没有提交过——这玩意儿看来【没希望】成为互联网标准了。 <br /> <br /> <b>
   优势2——关于“客户端部署”
  </b> <br /> TLS 的公钥体系（CA 证书体系）早就已经普及。所有主流的操作系统都内置了一系列 CA 根证书。 <br /> 相比之下，DNSCrypt 另起炉灶搞了一套公钥机制，只有它自己在用。 <br /> 所以，在【部署客户端】的时候，DNSCrypt 会比 TLS 麻烦。虽然某些 DNSCrypt 的客户端已经内置了一些知名的公共服务器的公钥，但如果你要切换到另一个 DNSCrypt 服务器，并且该服务器的公钥没有内置在客户端里面，那你就需要手动部署。 <br /> <br /> <b>
   优势3——关于“协议识别”
  </b> <br /> 这个话题前面已经谈过了。此处再重复唠叨一下。 <br /> 如果网络流量被监控，监控者可以根据协议特征，把 DNSCrypt 识别出来；而 DoT 与 DoH，在流量外观上，与其它的 TLS 流量【毫无差异】。也就是说，监控流量的人，无法判断某个 TLS 流量是否属于 DoT 或 DoH。 <br /> 以咱们天朝为例： <br /> 天朝的国际出口被 GFW 严密监视。如果 GFW 愿意的话，它完全可以根据协议特征，把 DNSCrypt 协议的流量识别出来并阻断掉。 <br /> 再来看 TLS，该协议已经被广泛应用于 HTTPS，GFW 不可能把所有 TLS 流量都阻断；再加上 TLS 协议设计严密，GFW 无法判断 TLS 承载的【上层协议】是啥。所以，对于流经国际出口的 DoT 或 DoH，GFW 是判断不出来滴。 <br /> <br /> 综上所述，TLS 完胜 DNSCrypt。所以，剩下的协议就只有 DoT 与 DoH。 <br /> <br />     <h3 id="dot-vs-doh-"> ◇DoT VS DoH </h3>
 <br /> 前面谈 DoH 优缺点的时候，其实已经可以看出这两者谁更有前途了。 <br /> DoT 因为协议栈少了一层，性能会比 DoH 更好。但是俺前面也说了，域名查询的频度是比较低的，而且还可以利用客户端软件的 DNS 缓存，进一步减少域名查询的频度。所以 DoT 虽然性能更好，但优势不明显。 <br /> <br /> DoH 的强项体现在如下几方面： <br /> <b>
   1. 编程接口更简单
  </b> <br /> （关于这点，前面提到过）这是个很重要的优势——有助于让更多软件切换到 DoH 之上。 <br /> <b>
   2. 可以利用 HTTP 协议已有的特性
  </b> <br /> 由于 DoH 是基于 HTTPS 之上，可以无缝地支持 Proxy； <br /> DoH 可以充分利用 HTTP 2.0 的特性（HTTP/2 在 HTTP/1.1 基础上加了很多功能）。 <br /> <br /> 正是因为 DoH 的这些优势，浏览器厂商对 DoH 的支持更积极。对比一下就可以看出来——DoT 在两年前正式发布 RFC，主流的浏览器没一个支持；而 DoH 目前才仅仅是 RFC 草案，Firefox 与 Chrome/Chromium 都开始支持了。 <br /> <br />     <h3 id="section-26"> ◇小结 </h3>
 <br /> 经过层层淘汰，目前看下来最有前途的应该 DoH（DNS over HTTPS）。 <br /> DoH 未来的发展势头取决于如下几点： <br /> 1. 标准化的时间进度（看目前的架势，正式发布应该快到了） <br /> 2. 其它浏览器跟进的速度 <br /> <br /> <br />     <h2 id="doh--"> ★对 DoH 的进一步讨论 </h2>
 <br />     <h3 id="section-27"> ◇引申阅读 </h3>
 <br /> 分享几篇 DoH 相关的文章： <br /> <br /> 《 <a href="https://hacks.mozilla.org/2018/05/a-cartoon-intro-to-dns-over-https/" rel="nofollow" target="_blank"> A cartoon intro to DNS over HTTPS </a> 》 <br /> （注：这是 Mozilla 官方博客的一篇文章，深入浅出地扫盲了 DNS 和 DoH 的原理） <br /> <br /> 《 <a href="https://bitsup.blogspot.com/2018/05/the-benefits-of-https-for-dns.html" rel="nofollow" target="_blank"> The Benefits of HTTPS for DNS </a> 》 <br /> （注：这是某个老外写的技术文章，讨论 DoH 可以借助 HTTP 协议的哪些好处） <br /> <br /> <br />     <h3 id="section-28"> ◇关于浏览器的说明 </h3>
 <br /> <b>
   Firefox
  </b> <br /> Firefox 从 62 版本开始支持 DoH，具体参见 Mozilla 官方博客（链接在“ <a href="https://blog.nightly.mozilla.org/2018/06/01/improving-dns-privacy-in-firefox/" rel="nofollow" target="_blank"> 这里 </a> ”）。 <br /> 由于 DoH 功能刚刚加入，还没有提供相应的配置界面。如果你想体验该功能，需要定制 Firefox 的配置选项（Preferences）以初始化 DoH 的相关参数。定制 Firefox 的方法参见博文：《 <a href="https://program-think.blogspot.com/2019/07/Customize-Firefox.html"> 扫盲 Firefox 定制——从“user.js”到“omni.ja” </a> 》 <br /> <br /> <b>
   Chrome/Chromium
  </b> <br /> Chrome/Chromium 从 66 版本开始支持 DoH。具体参见 Chromium 官网的 issue（链接在“ <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=799753" rel="nofollow" target="_blank"> 这里 </a> ”）。 <br /> <br /> 虽然 Firefox 和 Chrome/Chromium 都已经开始支持 DoH，但大伙儿别急着用。 <br /> 按照历史经验，刚加入的新功能，可能还不够稳定，没准儿还存在未曝光的安全漏洞。多等几个版本之后再说。 <br /> <br />     <h3 id="section-29"> ◇对翻墙的好处——无缝整合 </h3>
 <br /> 常规的翻墙软件，无非就是“代理软件”与“VPN 软件”。 <br /> <b>
   对于“VPN 软件”
  </b> <br /> 由于 VPN 具有【全局代理】的性质，DoH 当然可以无缝地整合到 VPN 翻墙中。 <br /> <b>
   对于“代理软件”
  </b> <br /> 常见的代理软件，要么是 HTTP 代理，要么是 SOCKS 代理。只要这些代理能支持 HTTPS，也就天然地支持 DoH。 <br /> 注：GAE 没有原生支持 HTTPS 代理。所以基于 GAE 的翻墙软件，就不能走 DoH 协议啦 :( <br /> <br />     <h3 id="section-30"> ◇相关的客户端工具 </h3>
 <br /> 在 curl 官方的代码仓库，有一个 <a href="https://github.com/curl/curl/wiki/DNS-over-HTTPS#doh-tools" rel="nofollow" target="_blank"> 关于 DoH 的 wiki 页面 </a> ，里面列出了一些 DoH 的客户端小工具。 <br /> 喜欢折腾技术的同学，可以先去玩一玩。 <br /> <br /> 因为 DoH 的标准还没有正式发布，关于它的讨论就到此为止。等到啥时候发布了，俺再专门发一篇 DoH 如何使用的博文。 <br /> <br /> <br /> <b>
   俺博客上，和本文相关的帖子（需翻墙）
  </b> ： <br /> 《 <a href="https://program-think.blogspot.com/2014/01/dns.html"> 扫盲 DNS 原理，兼谈“域名劫持”和“域名欺骗／域名污染” </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2014/11/https-ssl-tls-0.html"> 扫盲 HTTPS 和 SSL/TLS 协议 </a> 》（系列） <br /> 《 <a href="https://program-think.blogspot.com/2010/02/introduce-digital-certificate-and-ca.html"> 数字证书及 CA 的扫盲介绍 </a> 》 <br /> 《 <a href="https://program-think.blogspot.com/2013/06/privacy-protection-0.html"> 如何保护隐私 </a> 》（系列） <br /> 《 <a href="https://program-think.blogspot.com/2019/07/Customize-Firefox.html"> 扫盲 Firefox 定制——从“user.js”到“omni.ja” </a> 》     <div class="post-copyright">
<b>
    版权声明
   </b> <br /> 本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者 <a href="mailto:program.think@gmail.com"> 编程随想 </a> 和本文原始地址： <br /> <a href="https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html" id="OriginalPostUrl"> https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html </a>
    </div>
    <div style="clear: both;"></div>
  </div>
  <div class="post-footer" style="margin-bottom:50px;">
    <div class="post-footer-line post-footer-line-1" style="display:none;">
<span class="post-author vcard"> </span> <span class="reaction-buttons"> </span> <span class="star-ratings"> </span> <span class="post-icons"> </span> <span class="post-backlinks post-comment-link"> </span>
    </div>
    <div class="post-footer-line post-footer-line-2 post-toolbar"></div>
    <div class="post-footer-line post-footer-line-3">
<span class="post-location"> </span>
    </div>
  </div>
</div>


  </div>

  <hr style="border-top:1px solid #28323C;"/>

<font size=2px>
  文章版权归原作者所有。
</font>

<div style="text-align:center"><img width="1px" src="https://i.imgur.com/HSw56Ez.png" alt="二维码分享本站" style="text-align:center"/></div>

  <div id="sametag">
    <h4 style="display: inline-block;">#编程随想 的其它文章</h4>
    <span>--<a href="https://nodebe4.github.io/opinion/2021-05-09/%E5%88%86%E4%BA%AB%E5%90%84%E7%B1%BB%E7%94%B5%E5%AD%90%E4%B9%A6-%E6%94%BF%E6%B2%BB-IT-%E7%A7%91%E6%99%AE-%E5%8E%86%E5%8F%B2-%E7%AD%89-97%E6%9C%AC/">最新</a>-</span>
    <span>-<a href="https://nodebe4.github.io/opinion/2009-01-15/%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%BC%A0%E5%8F%8A%E6%9C%AC%E5%8D%9A%E5%AE%A2%E5%86%85%E5%AE%B9%E7%AE%80%E4%BB%8B/">最早</a>--</span>
    
      <li>
        <time>2018-10-25</time>
        <a href="https://nodebe4.github.io/opinion/2018-10-25/%E5%9F%BA%E4%BA%8E%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%8F%8A%E5%88%87%E6%8D%A2-Firefox-%E7%89%88%E6%9C%AC/">
          基于安全性考虑，如何选择及切换 Firefox 版本？
        </a>
      </li>
    
    
      <li>
        <time>2018-10-18</time>
        <a href="https://nodebe4.github.io/opinion/2018-10-18/%E6%AF%8F%E5%91%A8%E8%BD%AC%E8%BD%BD-2018%E5%B9%B4%E8%BF%99%E8%BD%AE%E8%82%A1%E7%81%BE%E5%88%B0%E5%BA%95%E6%9C%89%E5%A4%9A%E6%83%A8-%E7%9C%8B%E4%BA%86%E4%BD%A0%E5%B0%B1%E7%9F%A5%E9%81%93%E4%BA%86/">
          每周转载：2018年这轮股灾到底有多惨，看了你就知道了
        </a>
      </li>
    
    
      <li>
        <time>2018-09-30</time>
        <a href="https://nodebe4.github.io/opinion/2018-09-30/%E5%BC%83%E7%94%A8-Chrome-%E6%94%B9%E7%94%A8-Firefox-%E7%9A%84%E5%87%A0%E7%82%B9%E7%90%86%E7%94%B1-%E5%85%B3%E4%BA%8E-Chrome-69-%E9%9A%90%E7%A7%81%E4%B8%91%E9%97%BB%E7%9A%84%E9%9A%8F%E6%83%B3/">
          弃用 Chrome 改用 Firefox 的几点理由——关于 Chrome 69 隐私丑闻的随想
        </a>
      </li>
    
    
      <li>
        <time>2018-09-21</time>
        <a href="https://nodebe4.github.io/opinion/2018-09-21/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%A9%AC%E5%85%8B%E6%80%9D%E6%98%AF%E9%94%99%E7%9A%84-%E5%85%A8%E9%9D%A2%E6%89%B9%E5%88%A4%E9%A9%AC%E5%88%97%E4%B8%BB%E4%B9%89%E7%9A%84%E7%9F%A5%E5%90%8D%E8%91%97%E4%BD%9C%E5%AF%BC%E8%AF%BB/">
          为什么马克思是错的？——全面批判马列主义的知名著作导读
        </a>
      </li>
    
  </div>


  <hr>
  <div class="pagination">
    
      <span class="prev" >
          <a href="https://nodebe4.github.io/opinion/2018-10-09/%E7%9C%9F%E4%BA%BA%E7%A7%80%E8%8A%82%E7%9B%AE%E5%A6%82%E4%BD%95%E4%B8%8E%E5%B9%BF%E7%94%B5%E6%80%BB%E5%B1%80%E6%96%97%E6%99%BA%E6%96%97%E5%8B%87/">
            前一篇：真人秀节目如何与广电总局斗智斗勇
          </a>
      </span>
    
    
      <span class="next" >
          <a href="https://nodebe4.github.io/opinion/2018-10-10/%E4%BD%99%E5%A4%A7%E7%AB%A0%E5%85%88%E7%94%9F-%E8%BF%BD%E6%80%9D%E4%BC%9A%E7%BA%AA%E8%A6%81/">
            後一篇：余大章先生 追思会纪要
          </a>
      </span>
    

    <script>
    /* post pagination keyboard shortcuts */
    document.body.onkeyup = function(e){
      if (e.keyCode == '37') { window.location = 'https://nodebe4.github.io/opinion/2018-10-09/%E7%9C%9F%E4%BA%BA%E7%A7%80%E8%8A%82%E7%9B%AE%E5%A6%82%E4%BD%95%E4%B8%8E%E5%B9%BF%E7%94%B5%E6%80%BB%E5%B1%80%E6%96%97%E6%99%BA%E6%96%97%E5%8B%87/'; } // left arrow key
      if (e.keyCode == '39') { window.location = 'https://nodebe4.github.io/opinion/2018-10-10/%E4%BD%99%E5%A4%A7%E7%AB%A0%E5%85%88%E7%94%9F-%E8%BF%BD%E6%80%9D%E4%BC%9A%E7%BA%AA%E8%A6%81/'; } // right arrow key
      if (e.keyCode == '45') { window.location = 'https://nodebe4.github.io/opinion/2018-10-18/%E6%AF%8F%E5%91%A8%E8%BD%AC%E8%BD%BD-2018%E5%B9%B4%E8%BF%99%E8%BD%AE%E8%82%A1%E7%81%BE%E5%88%B0%E5%BA%95%E6%9C%89%E5%A4%9A%E6%83%A8-%E7%9C%8B%E4%BA%86%E4%BD%A0%E5%B0%B1%E7%9F%A5%E9%81%93%E4%BA%86/'; } // insert key
      if (e.keyCode == '46') { window.location = 'https://nodebe4.github.io/opinion/2018-09-30/%E5%BC%83%E7%94%A8-Chrome-%E6%94%B9%E7%94%A8-Firefox-%E7%9A%84%E5%87%A0%E7%82%B9%E7%90%86%E7%94%B1-%E5%85%B3%E4%BA%8E-Chrome-69-%E9%9A%90%E7%A7%81%E4%B8%91%E9%97%BB%E7%9A%84%E9%9A%8F%E6%83%B3/'; } // delete key
    };
    </script>
    <link rel="stylesheet" type="text/css" href="/opinion/assets/css/fab.css" />

<div class="fab-wrapper">
  <div class="fab-wheel">
    
    
    
    <a class="fab-action fab-action-1" title="上一篇(热键 &#8594;)" href="https://nodebe4.github.io/opinion/2018-10-09/%E7%9C%9F%E4%BA%BA%E7%A7%80%E8%8A%82%E7%9B%AE%E5%A6%82%E4%BD%95%E4%B8%8E%E5%B9%BF%E7%94%B5%E6%80%BB%E5%B1%80%E6%96%97%E6%99%BA%E6%96%97%E5%8B%87/">
      <i>后</i>
    </a>
    
    
    <a class="fab-action fab-action-2" title="下一篇(热键 &#8592;)" href="https://nodebe4.github.io/opinion/2018-10-10/%E4%BD%99%E5%A4%A7%E7%AB%A0%E5%85%88%E7%94%9F-%E8%BF%BD%E6%80%9D%E4%BC%9A%E7%BA%AA%E8%A6%81/">
      <i>前</i>
    </a>
    
    
    <a class="fab-action fab-action-3" title="<编程随想>上一篇(热键 ins)" href="https://nodebe4.github.io/opinion/2018-10-18/%E6%AF%8F%E5%91%A8%E8%BD%AC%E8%BD%BD-2018%E5%B9%B4%E8%BF%99%E8%BD%AE%E8%82%A1%E7%81%BE%E5%88%B0%E5%BA%95%E6%9C%89%E5%A4%9A%E6%83%A8-%E7%9C%8B%E4%BA%86%E4%BD%A0%E5%B0%B1%E7%9F%A5%E9%81%93%E4%BA%86/">
      <i>左</i>
    </a>
    
    
    <a class="fab-action fab-action-4" title="<编程随想>下一篇(热键 del)" href="https://nodebe4.github.io/opinion/2018-09-30/%E5%BC%83%E7%94%A8-Chrome-%E6%94%B9%E7%94%A8-Firefox-%E7%9A%84%E5%87%A0%E7%82%B9%E7%90%86%E7%94%B1-%E5%85%B3%E4%BA%8E-Chrome-69-%E9%9A%90%E7%A7%81%E4%B8%91%E9%97%BB%E7%9A%84%E9%9A%8F%E6%83%B3/">
      <i>右</i>
    </a>
    
  </div>
</div>


  </div>


  

</article>

    </div>

    <div style="z-index:2;">
<script src="/opinion/assets/js/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 56,
  cornerOffset: 20, // px
  id: 'back-to-top',
  backgroundColor: '#ddd',
  textColor: 'red'
})</script>
</div>


    <div class="wrapper-footer" id="footer">
      <div class="container">
        <footer class="footer">
          <img width="200px" src="https://i.imgur.com/HSw56Ez.png" alt="二维码分享本站"/>
<font size=2px>二维码分享本站</font>

<!-- Refer to https://codepen.io/ruandre/pen/howFi -->
<ul class="svg-icon">

  

  

  
  <li><a href="mailto:beauti4@protonmail.com" class="icon-8 email" title="Email"><svg viewBox="0 0 512 512"><path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://github.com/NodeBE4/opinion" class="icon-13 github" title="GitHub"><svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li>
  

  

  

  

  

  
  <li><a href="/opinion/feed.xml" class="icon-21 rss" title="RSS"><svg viewBox="0 0 512 512"><path d="M201.8 347.2c0 20.3-16.5 36.8-36.8 36.8 -20.3 0-36.8-16.5-36.8-36.8s16.5-36.8 36.8-36.8C185.3 310.4 201.8 326.8 201.8 347.2zM128.2 204.7v54.5c68.5 0.7 124 56.3 124.7 124.7h54.5C306.7 285.3 226.9 205.4 128.2 204.7zM128.2 166.6c57.9 0.3 112.3 22.9 153.2 63.9 41 41 63.7 95.5 63.9 153.5h54.5c-0.3-149.9-121.7-271.4-271.6-271.9V166.6L128.2 166.6z"/></svg><!--[if lt IE 9]><em>RSS</em><![endif]--></a></li>
  

  

  

  

  

    
</ul>





<p><span style="color:blue">内容每小时更新一次.</span> Powered by <a href="https://github.com/AWEEKJ/kiko-now">Kiko Now</a> & <a href="https://github.com/gitalk/gitalk">Gitalk</a> & <a href="https://github.com/duty-machine/news">duty-machine</a>, 站务 <a href="https://be4.herokuapp.com">NodeBE4</a>（<span style="color:red">被墙</span>）</p>





        </footer>
      </div>
    </div>

    



  </body>
</html>
